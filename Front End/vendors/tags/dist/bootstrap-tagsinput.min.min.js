!function(j){function i(a,d){this.itemsArray=[],this.$element=j(a),this.$element.hide(),this.isSelect="SELECT"===a.tagName,this.multiple=this.isSelect&&a.hasAttribute("multiple"),this.objectItems=d&&d.itemValue,this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=j('<div class="bootstrap-tagsinput"></div>'),this.$input=j('<input size="'+this.inputSize+'" type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container),this.build(d)}function p(e,d){if("function"!=typeof e[d]){var f=e[d];e[d]=function(b){return b[f]}}}function o(e,d){if("function"!=typeof e[d]){var f=e[d];e[d]=function(){return f}}}function n(b){return b?k.text(b).html():""}function m(e){var d=0;if(document.selection){e.focus();var f=document.selection.createRange();f.moveStart("character",-e.value.length),d=f.text.length}else{(e.selectionStart||"0"==e.selectionStart)&&(d=e.selectionStart)}return d}var l={tagClass:function(){return"label label-info"},itemValue:function(b){return b?b.toString():b},itemText:function(b){return this.itemValue(b)},freeInput:!0,maxTags:void 0,confirmKeys:[13],onTagExists:function(d,c){c.hide().fadeIn()}};i.prototype={constructor:i,add:function(z,y){var x=this;if(!(x.options.maxTags&&x.itemsArray.length>=x.options.maxTags||z!==!1&&!z)){if("object"==typeof z&&!x.objectItems){throw"Can't add objects when itemValue option is not set"}if(!z.toString().match(/^\s*$/)){if(x.isSelect&&!x.multiple&&x.itemsArray.length>0&&x.remove(x.itemsArray[0]),"string"==typeof z&&"INPUT"===this.$element[0].tagName){var w=z.split(",");if(w.length>1){for(var v=0;v<w.length;v++){this.add(w[v],!0)}return y||x.pushVal(),void 0}}var u=x.options.itemValue(z),t=x.options.itemText(z),s=x.options.tagClass(z),r=j.grep(x.itemsArray,function(b){return x.options.itemValue(b)===u})[0];if(r){if(x.options.onTagExists){var q=j(".tag",x.$container).filter(function(){return j(this).data("item")===r});x.options.onTagExists(z,q)}}else{x.itemsArray.push(z);var e=j('<span class="tag '+n(s)+'">'+n(t)+'<span data-role="remove"></span></span>');if(e.data("item",z),x.findInputWrapper().before(e),e.after(" "),x.isSelect&&!j('option[value="'+escape(u)+'"]',x.$element)[0]){var a=j("<option selected>"+n(t)+"</option>");a.data("item",z),a.attr("value",u),x.$element.append(a)}y||x.pushVal(),x.options.maxTags===x.itemsArray.length&&x.$container.addClass("bootstrap-tagsinput-max"),x.$element.trigger(j.Event("itemAdded",{item:z}))}}}},remove:function(a,f){var e=this;e.objectItems&&(a="object"==typeof a?j.grep(e.itemsArray,function(b){return e.options.itemValue(b)==e.options.itemValue(a)})[0]:j.grep(e.itemsArray,function(b){return e.options.itemValue(b)==a})[0]),a&&(j(".tag",e.$container).filter(function(){return j(this).data("item")===a}).remove(),j("option",e.$element).filter(function(){return j(this).data("item")===a}).remove(),e.itemsArray.splice(j.inArray(a,e.itemsArray),1)),f||e.pushVal(),e.options.maxTags>e.itemsArray.length&&e.$container.removeClass("bootstrap-tagsinput-max"),e.$element.trigger(j.Event("itemRemoved",{item:a}))},removeAll:function(){var a=this;for(j(".tag",a.$container).remove(),j("option",a.$element).remove();a.itemsArray.length>0;){a.itemsArray.pop()}a.pushVal(),a.options.maxTags&&!this.isEnabled()&&this.enable()},refresh:function(){var a=this;j(".tag",a.$container).each(function(){var t=j(this),s=t.data("item"),r=a.options.itemValue(s),q=a.options.itemText(s),e=a.options.tagClass(s);if(t.attr("class",null),t.addClass("tag "+n(e)),t.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=n(q),a.isSelect){var b=j("option",a.$element).filter(function(){return j(this).data("item")===s});b.attr("value",r)}})},items:function(){return this.itemsArray},pushVal:function(){var a=this,d=j.map(a.items(),function(b){return a.options.itemValue(b).toString()});a.$element.val(d,!0).trigger("change")},build:function(a){var d=this;d.options=j.extend({},l,a);var c=d.options.typeahead||{};d.objectItems&&(d.options.freeInput=!1),p(d.options,"itemValue"),p(d.options,"itemText"),p(d.options,"tagClass"),d.options.source&&(c.source=d.options.source),c.source&&j.fn.typeahead&&(o(c,"source"),d.$input.typeahead({source:function(e,s){function r(t){for(var f=[],v=0;v<t.length;v++){var u=d.options.itemText(t[v]);q[u]=t[v],f.push(u)}s(f)}this.map={};var q=this.map,h=c.source(e);j.isFunction(h.success)?h.success(r):j.when(h).then(r)},updater:function(b){d.add(this.map[b])},matcher:function(b){return -1!==b.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(b){return b.sort()},highlighter:function(f){var e=new RegExp("("+this.query+")","gi");return f.replace(e,"<strong>$1</strong>")}})),d.$container.on("click",j.proxy(function(){d.$input.focus()},d)),d.$container.on("keydown","input",j.proxy(function(e){var u=j(e.target),t=d.findInputWrapper();switch(e.which){case 8:if(0===m(u[0])){var s=t.prev();s&&d.remove(s.data("item"))}break;case 46:if(0===m(u[0])){var r=t.next();r&&d.remove(r.data("item"))}break;case 37:var q=t.prev();0===u.val().length&&q[0]&&(q.before(t),u.focus());break;case 39:var f=t.next();0===u.val().length&&f[0]&&(f.after(t),u.focus());break;default:d.options.freeInput&&j.inArray(e.which,d.options.confirmKeys)>=0&&(d.add(u.val()),u.val(""),e.preventDefault())}u.attr("size",Math.max(this.inputSize,u.val().length))},d)),d.$container.on("click","[data-role=remove]",j.proxy(function(e){d.remove(j(e.target).closest(".tag").data("item"))},d)),d.options.itemValue===l.itemValue&&("INPUT"===d.$element[0].tagName?d.add(d.$element.val()):j("option",d.$element).each(function(){d.add(j(this).attr("value"),!0)}))},destroy:function(){var b=this;b.$container.off("keypress","input"),b.$container.off("click","[role=remove]"),b.$container.remove(),b.$element.removeData("tagsinput"),b.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var a=this.$input[0],d=this.$container[0];a&&a.parentNode!==d;){a=a.parentNode}return j(a)}},j.fn.tagsinput=function(f,b){var a=[];return this.each(function(){var d=j(this).data("tagsinput");if(d){var c=d[f](b);void 0!==c&&a.push(c)}else{d=new i(this,f),j(this).data("tagsinput",d),a.push(d),"SELECT"===this.tagName&&j("option",j(this)).attr("selected","selected"),j(this).val(j(this).val())}}),"string"==typeof f?a.length>1?a:a[0]:a},j.fn.tagsinput.Constructor=i;var k=j("<div />");j(function(){j("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);