var TypeaheadView=(function(){var e={wrapper:'<span class="twitter-typeahead"></span>',hint:'<input class="tt-hint" type="text" autocomplete="off" spellcheck="off" disabled>',dropdown:'<span class="tt-dropdown-menu"></span>'},d={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"},query:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"}};if(utils.isMsie()){utils.mixin(d.query,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"})}if(utils.isMsie()&&utils.isMsie()<=7){utils.mixin(d.wrapper,{display:"inline",zoom:"1"});utils.mixin(d.query,{marginTop:"-1px"})}function b(h){var g,i,f;utils.bindAll(this);this.$node=a(h.input);this.datasets=h.datasets;this.dir=null;this.eventBus=h.eventBus;g=this.$node.find(".tt-dropdown-menu");i=this.$node.find(".tt-query");f=this.$node.find(".tt-hint");this.dropdownView=new DropdownView({menu:g}).on("suggestionSelected",this._handleSelection).on("cursorMoved",this._clearHint).on("cursorMoved",this._setInputValueToSuggestionUnderCursor).on("cursorRemoved",this._setInputValueToQuery).on("cursorRemoved",this._updateHint).on("suggestionsRendered",this._updateHint).on("opened",this._updateHint).on("closed",this._clearHint).on("opened closed",this._propagateEvent);this.inputView=new InputView({input:i,hint:f}).on("focused",this._openDropdown).on("blured",this._closeDropdown).on("blured",this._setInputValueToQuery).on("enterKeyed tabKeyed",this._handleSelection).on("queryChanged",this._clearHint).on("queryChanged",this._clearSuggestions).on("queryChanged",this._getSuggestions).on("whitespaceChanged",this._updateHint).on("queryChanged whitespaceChanged",this._openDropdown).on("queryChanged whitespaceChanged",this._setLanguageDirection).on("escKeyed",this._closeDropdown).on("escKeyed",this._setInputValueToQuery).on("tabKeyed upKeyed downKeyed",this._managePreventDefault).on("upKeyed downKeyed",this._moveDropdownCursor).on("upKeyed downKeyed",this._openDropdown).on("tabKeyed leftKeyed rightKeyed",this._autocomplete)}utils.mixin(b.prototype,EventTarget,{_managePreventDefault:function(i){var h=i.data,j,f,g=false;switch(i.type){case"tabKeyed":j=this.inputView.getHintValue();f=this.inputView.getInputValue();g=j&&j!==f;break;case"upKeyed":case"downKeyed":g=!h.shiftKey&&!h.ctrlKey&&!h.metaKey;break}g&&h.preventDefault()},_setLanguageDirection:function(){var f=this.inputView.getLanguageDirection();if(f!==this.dir){this.dir=f;this.$node.css("direction",f);this.dropdownView.setLanguageDirection(f)}},_updateHint:function(){var i=this.dropdownView.getFirstSuggestion(),h=i?i.value:null,l=this.dropdownView.isVisible(),k=this.inputView.isOverflow(),g,m,n,f,j;if(h&&l&&!k){g=this.inputView.getInputValue();m=g.replace(/\s{2,}/g," ").replace(/^\s+/g,"");n=utils.escapeRegExChars(m);f=new RegExp("^(?:"+n+")(.*$)","i");j=f.exec(h);this.inputView.setHintValue(g+(j?j[1]:""))}},_clearHint:function(){this.inputView.setHintValue("")},_clearSuggestions:function(){this.dropdownView.clearSuggestions()},_setInputValueToQuery:function(){this.inputView.setInputValue(this.inputView.getQuery())},_setInputValueToSuggestionUnderCursor:function(g){var f=g.data;this.inputView.setInputValue(f.value,true)},_openDropdown:function(){this.dropdownView.open()},_closeDropdown:function(f){this.dropdownView[f.type==="blured"?"closeUnlessMouseIsOverDropdown":"close"]()},_moveDropdownCursor:function(g){var f=g.data;if(!f.shiftKey&&!f.ctrlKey&&!f.metaKey){this.dropdownView[g.type==="upKeyed"?"moveCursorUp":"moveCursorDown"]()}},_handleSelection:function(h){var g=h.type==="suggestionSelected",f=g?h.data:this.dropdownView.getSuggestionUnderCursor();if(f){this.inputView.setInputValue(f.value);g?this.inputView.focus():h.data.preventDefault();g&&utils.isMsie()?utils.defer(this.dropdownView.close):this.dropdownView.close();this.eventBus.trigger("selected",f.datum,f.dataset)}},_getSuggestions:function(){var f=this,g=this.inputView.getQuery();if(utils.isBlankString(g)){return}utils.each(this.datasets,function(h,j){j.getSuggestions(g,function(i){if(g===f.inputView.getQuery()){f.dropdownView.renderSuggestions(j,i)}})})},_autocomplete:function(j){var g,f,i,k,h;if(j.type==="rightKeyed"||j.type==="leftKeyed"){g=this.inputView.isCursorAtEnd();f=this.inputView.getLanguageDirection()==="ltr"?j.type==="leftKeyed":j.type==="rightKeyed";if(!g||f){return}}i=this.inputView.getQuery();k=this.inputView.getHintValue();if(k!==""&&i!==k){h=this.dropdownView.getFirstSuggestion();this.inputView.setInputValue(h.value);this.eventBus.trigger("autocompleted",h.datum,h.dataset)}},_propagateEvent:function(f){this.eventBus.trigger(f.type)},destroy:function(){this.inputView.destroy();this.dropdownView.destroy();c(this.$node);this.$node=null},setQuery:function(f){this.inputView.setQuery(f);this.inputView.setInputValue(f);this._clearHint();this._clearSuggestions();this._getSuggestions()}});return b;function a(f){var h=$(e.wrapper),j=$(e.dropdown),k=$(f),g=$(e.hint);h=h.css(d.wrapper);j=j.css(d.dropdown);g.css(d.hint).css({backgroundAttachment:k.css("background-attachment"),backgroundClip:k.css("background-clip"),backgroundColor:k.css("background-color"),backgroundImage:k.css("background-image"),backgroundOrigin:k.css("background-origin"),backgroundPosition:k.css("background-position"),backgroundRepeat:k.css("background-repeat"),backgroundSize:k.css("background-size")});k.data("ttAttrs",{dir:k.attr("dir"),autocomplete:k.attr("autocomplete"),spellcheck:k.attr("spellcheck"),style:k.attr("style")});k.addClass("tt-query").attr({autocomplete:"off",spellcheck:false}).css(d.query);try{!k.attr("dir")&&k.attr("dir","auto")}catch(i){}return k.wrap(h).parent().prepend(g).append(j)}function c(f){var g=f.find(".tt-query");utils.each(g.data("ttAttrs"),function(h,i){utils.isUndefined(i)?g.removeAttr(h):g.attr(h,i)});g.detach().removeData("ttAttrs").removeClass("tt-query").insertAfter(f);f.remove()}})();