!function(g){function f(b){this.parent=b,this.container,this.loadbar,this.percentageContainer}function j(b){this.toPreload=[],this.parent=b,this.container}function i(b){this.element,this.parent=b}function h(b,a){this.element=b,this.$element=g(b),this.options=a,this.foundUrls=[],this.destroyed=!1,this.imageCounter=0,this.imageDone=0,this.alreadyLoaded=!1,this.preloadContainer=new j(this),this.overlayLoader=new f(this),this.defaultOptions={onComplete:function(){},onLoadComplete:function(){},backgroundColor:"#000",barColor:"#fff",overlayId:"qLoverlay",barHeight:1,percentage:!1,deepSearch:!0,completeAnimation:"fade",minimumTime:500},this.init()}!function(l){function k(a){var d=l.event;return d.target=d.target||d.srcElement||a,d}var p=document.documentElement,o=function(){};p.addEventListener?o=function(e,d,q){e.addEventListener(d,q,!1)}:p.attachEvent&&(o=function(b,q,e){b[q+e]=e.handleEvent?function(){var a=k(b);e.handleEvent.call(e,a)}:function(){var a=k(b);e.call(b,a)},b.attachEvent("on"+q,b[q+e])});var n=function(){};p.removeEventListener?n=function(e,d,q){e.removeEventListener(d,q,!1)}:p.detachEvent&&(n=function(q,e,s){q.detachEvent("on"+e,q[e+s]);try{delete q[e+s]}catch(r){q[e+s]=void 0}});var m={bind:o,unbind:n};"function"==typeof define&&define.amd?define(m):"object"==typeof exports?module.exports=m:l.eventie=m}(this),function(){function l(){}function k(e,d){for(var q=e.length;q--;){if(e[q].listener===d){return q}}return -1}function p(b){return function(){return this[b].apply(this,arguments)}}var o=l.prototype,n=this,m=n.EventEmitter;o.getListeners=function(q){var e,s,r=this._getEvents();if(q instanceof RegExp){e={};for(s in r){r.hasOwnProperty(s)&&q.test(s)&&(e[s]=r[s])}}else{e=r[q]||(r[q]=[])}return e},o.flattenListeners=function(e){var d,q=[];for(d=0;d<e.length;d+=1){q.push(e[d].listener)}return q},o.getListenersAsObject=function(e){var d,q=this.getListeners(e);return q instanceof Array&&(d={},d[e]=q),d||q},o.addListener=function(b,t){var s,r=this.getListenersAsObject(b),q="object"==typeof t;for(s in r){r.hasOwnProperty(s)&&-1===k(r[s],t)&&r[s].push(q?t:{listener:t,once:!1})}return this},o.on=p("addListener"),o.addOnceListener=function(d,c){return this.addListener(d,{listener:c,once:!0})},o.once=p("addOnceListener"),o.defineEvent=function(b){return this.getListeners(b),this},o.defineEvents=function(d){for(var c=0;c<d.length;c+=1){this.defineEvent(d[c])}return this},o.removeListener=function(b,t){var s,r,q=this.getListenersAsObject(b);for(r in q){q.hasOwnProperty(r)&&(s=k(q[r],t),-1!==s&&q[r].splice(s,1))}return this},o.off=p("removeListener"),o.addListeners=function(d,c){return this.manipulateListeners(!1,d,c)},o.removeListeners=function(d,c){return this.manipulateListeners(!0,d,c)},o.manipulateListeners=function(r,q,w){var v,u,t=r?this.removeListener:this.addListener,s=r?this.removeListeners:this.addListeners;if("object"!=typeof q||q instanceof RegExp){for(v=w.length;v--;){t.call(this,q,w[v])}}else{for(v in q){q.hasOwnProperty(v)&&(u=q[v])&&("function"==typeof u?t.call(this,v,u):s.call(this,v,u))}}return this},o.removeEvent=function(q){var e,s=typeof q,r=this._getEvents();if("string"===s){delete r[q]}else{if(q instanceof RegExp){for(e in r){r.hasOwnProperty(e)&&q.test(e)&&delete r[e]}}else{delete this._events}}return this},o.removeAllListeners=p("removeEvent"),o.emitEvent=function(r,q){var w,v,u,t,s=this.getListenersAsObject(r);for(u in s){if(s.hasOwnProperty(u)){for(v=s[u].length;v--;){w=s[u][v],w.once===!0&&this.removeListener(r,w.listener),t=w.listener.apply(this,q||[]),t===this._getOnceReturnValue()&&this.removeListener(r,w.listener)}}}return this},o.trigger=p("emitEvent"),o.emit=function(d){var c=Array.prototype.slice.call(arguments,1);return this.emitEvent(d,c)},o.setOnceReturnValue=function(b){return this._onceReturnValue=b,this},o._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},o._getEvents=function(){return this._events||(this._events={})},l.noConflict=function(){return n.EventEmitter=m,l},"function"==typeof define&&define.amd?define(function(){return l}):"object"==typeof module&&module.exports?module.exports=l:this.EventEmitter=l}.call(this),function(d,c){"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(b,a){return c(d,b,a)}):"object"==typeof exports?module.exports=c(d,require("eventEmitter"),require("eventie")):d.imagesLoaded=c(d,d.EventEmitter,d.eventie)}(this,function(B,A,z){function y(e,d){for(var k in d){e[k]=d[k]}return e}function x(b){return"[object Array]"===p.call(b)}function w(k){var e=[];if(x(k)){e=k}else{if("number"==typeof k.length){for(var m=0,l=k.length;l>m;m++){e.push(k[m])}}else{e.push(k)}}return e}function v(k,d,m){if(!(this instanceof v)){return new v(k,d)}"string"==typeof k&&(k=document.querySelectorAll(k)),this.elements=w(k),this.options=y({},this.options),"function"==typeof d?m=d:y(this.options,d),m&&this.on("always",m),this.getImages(),s&&(this.jqDeferred=new s.Deferred);var l=this;setTimeout(function(){l.check()})}function u(b){this.img=b}function t(b){this.src=b,o[b]=this}var s=B.jQuery,r=B.console,q="undefined"!=typeof r,p=Object.prototype.toString;v.prototype=new A,v.prototype.options={},v.prototype.getImages=function(){this.images=[];for(var l=0,k=this.elements.length;k>l;l++){var E=this.elements[l];"IMG"===E.nodeName&&this.addImage(E);for(var D=E.querySelectorAll("img"),C=0,n=D.length;n>C;C++){var m=D[C];this.addImage(m)}}},v.prototype.addImage=function(d){var c=new u(d);this.images.push(c)},v.prototype.check=function(){function l(b){return k.options.debug&&q,k.progress(b),D++,D===C&&k.complete(),!0}var k=this,D=0,C=this.images.length;if(this.hasAnyBroken=!1,!C){return this.complete(),void 0}for(var n=0;C>n;n++){var m=this.images[n];m.on("confirm",l),m.check()}},v.prototype.progress=function(d){this.hasAnyBroken=this.hasAnyBroken||!d.isLoaded;var c=this;setTimeout(function(){c.emit("progress",c,d),c.jqDeferred&&c.jqDeferred.notify&&c.jqDeferred.notify(c,d)})},v.prototype.complete=function(){var d=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var c=this;setTimeout(function(){if(c.emit(d,c),c.emit("always",c),c.jqDeferred){var a=c.hasAnyBroken?"reject":"resolve";c.jqDeferred[a](c)}})},s&&(s.fn.imagesLoaded=function(e,d){var k=new v(this,e,d);return k.jqDeferred.promise(s(this))}),u.prototype=new A,u.prototype.check=function(){var d=o[this.img.src]||new t(this.img.src);if(d.isConfirmed){return this.confirm(d.isLoaded,"cached was confirmed"),void 0}if(this.img.complete&&void 0!==this.img.naturalWidth){return this.confirm(0!==this.img.naturalWidth,"naturalWidth"),void 0}var c=this;d.on("confirm",function(b,e){return c.confirm(b.isLoaded,e),!0}),d.check()},u.prototype.confirm=function(d,c){this.isLoaded=d,this.emit("confirm",this,c)};var o={};return t.prototype=new A,t.prototype.check=function(){if(!this.isChecked){var b=new Image;z.bind(b,"load",this),z.bind(b,"error",this),b.src=this.src,this.isChecked=!0}},t.prototype.handleEvent=function(d){var c="on"+d.type;this[c]&&this[c](d)},t.prototype.onload=function(b){this.confirm(!0,"onload"),this.unbindProxyEvents(b)},t.prototype.onerror=function(b){this.confirm(!1,"onerror"),this.unbindProxyEvents(b)},t.prototype.confirm=function(d,c){this.isConfirmed=!0,this.isLoaded=d,this.emit("confirm",this,c)},t.prototype.unbindProxyEvents=function(b){z.unbind(b.target,"load",this),z.unbind(b.target,"error",this)},v}),f.prototype.createOverlay=function(){var a="absolute";if("body"==this.parent.element.tagName.toLowerCase()){a="fixed"}else{var d=this.parent.$element.css("position");("fixed"!=d||"absolute"!=d)&&this.parent.$element.css("position","relative")}this.container=g("<div id='"+this.parent.options.overlayId+"'></div>").css({width:"100%",height:"100%",backgroundColor:this.parent.options.backgroundColor,backgroundPosition:"fixed",position:a,zIndex:666999,top:0,left:0}).appendTo(this.parent.$element),this.loadbar=g("<div id='qLbar'></div>").css({height:this.parent.options.barHeight+"px",marginTop:"-"+this.parent.options.barHeight/2+"px",backgroundColor:this.parent.options.barColor,width:"0%",position:"absolute",top:"50%"}).appendTo(this.container),1==this.parent.options.percentage&&(this.percentageContainer=g("<div id='qLpercentage'></div>").text("0%").css({height:"40px",width:"100px",position:"absolute",fontSize:"3em",top:"50%",left:"50%",marginTop:"-"+(59+this.parent.options.barHeight)+"px",textAlign:"center",marginLeft:"-50px",color:this.parent.options.barColor}).appendTo(this.container)),this.parent.preloadContainer.toPreload.length&&1!=this.parent.alreadyLoaded||this.parent.destroyContainers()},f.prototype.updatePercentage=function(b){this.loadbar.stop().animate({width:b+"%",minWidth:b+"%"},200),1==this.parent.options.percentage&&this.percentageContainer.text(Math.ceil(b)+"%")},j.prototype.create=function(){this.container=g("<div></div>").appendTo("body").css({display:"none",width:0,height:0,overflow:"hidden"}),this.processQueue()},j.prototype.processQueue=function(){for(var b=0;this.toPreload.length>b;b++){this.parent.destroyed||this.preloadImage(this.toPreload[b])}},j.prototype.addImage=function(b){this.toPreload.push(b)},j.prototype.preloadImage=function(d){var c=new i;c.addToPreloader(this,d),c.bindLoadEvent()},i.prototype.addToPreloader=function(a,d){this.element=g("<img />").attr("src",d),this.element.appendTo(a.container),this.parent=a.parent},i.prototype.bindLoadEvent=function(){this.parent.imageCounter++,this.element[0].ref=this,new imagesLoaded(this.element,function(b){b.elements[0].ref.completeLoading()})},i.prototype.completeLoading=function(){this.parent.imageDone++;var b=100*(this.parent.imageDone/this.parent.imageCounter);this.parent.overlayLoader.updatePercentage(b),(this.parent.imageDone==this.parent.imageCounter||b>=100)&&this.parent.endLoader()},h.prototype.init=function(){if(this.options=g.extend({},this.defaultOptions,this.options),this.findImageInElement(this.element),1==this.options.deepSearch){for(var a=this.$element.find("*:not(script)"),d=0;d<a.length;d++){this.findImageInElement(a[d])}}this.preloadContainer.create(),this.overlayLoader.createOverlay()},h.prototype.findImageInElement=function(a){var p="",o=g(a),n="normal";if("none"!=o.css("background-image")?(p=o.css("background-image"),n="background"):"undefined"!=typeof o.attr("src")&&"img"==a.nodeName.toLowerCase()&&(p=o.attr("src")),!this.hasGradient(p)){p=this.stripUrl(p);for(var m=p.split(", "),l=0;l<m.length;l++){if(this.validUrl(m[l])&&this.urlIsNew(m[l])){var k="";if(this.isIE()||this.isOpera()){k="?rand="+Math.random(),this.preloadContainer.addImage(m[l]+k)}else{if("background"==n){this.preloadContainer.addImage(m[l]+k)}else{var d=new i(this);d.element=o,d.bindLoadEvent()}}this.foundUrls.push(m[l])}}}},h.prototype.hasGradient=function(b){return -1==b.indexOf("gradient")?!1:!0},h.prototype.stripUrl=function(b){return b=b.replace(/url\(\"/g,""),b=b.replace(/url\(/g,""),b=b.replace(/\"\)/g,""),b=b.replace(/\)/g,"")},h.prototype.isIE=function(){return navigator.userAgent.match(/msie/i)},h.prototype.isOpera=function(){return navigator.userAgent.match(/Opera/i)},h.prototype.validUrl=function(b){return b.length>0&&!b.match(/^(data:)/i)?!0:!1},h.prototype.urlIsNew=function(b){return -1==this.foundUrls.indexOf(b)?!0:!1},h.prototype.destroyContainers=function(){this.destroyed=!0,this.preloadContainer.container.remove(),this.overlayLoader.container.remove()},h.prototype.endLoader=function(){this.destroyed=!0,this.onLoadComplete()},h.prototype.onLoadComplete=function(){if(this.options.onLoadComplete(),"grow"==this.options.completeAnimation){var a=this.options.minimumTime;this.overlayLoader.loadbar[0].parent=this,this.overlayLoader.loadbar.stop().animate({width:"100%"},a,function(){g(this).animate({top:"0%",width:"100%",height:"100%"},500,function(){this.parent.overlayLoader.container[0].parent=this.parent,this.parent.overlayLoader.container.fadeOut(500,function(){this.parent.destroyContainers(),this.parent.options.onComplete()})})})}else{var a=this.options.minimumTime;this.overlayLoader.container[0].parent=this,this.overlayLoader.container.fadeOut(a,function(){this.parent.destroyContainers(),this.parent.options.onComplete()})}},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var d=this.length>>>0,k=Number(arguments[1])||0;for(k=0>k?Math.ceil(k):Math.floor(k),0>k&&(k+=d);d>k;k++){if(k in this&&this[k]===e){return k}}return -1}),g.fn.queryLoader2=function(b){return this.each(function(){new h(this,b)})}}(jQuery);