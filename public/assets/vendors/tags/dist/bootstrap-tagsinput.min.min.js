(function(n){var j={tagClass:function(a){return"label label-info"},itemValue:function(a){return a?a.toString():a},itemText:function(a){return this.itemValue(a)},freeInput:true,maxTags:undefined,confirmKeys:[13],onTagExists:function(a,b){b.hide().fadeIn()}};function o(a,b){this.itemsArray=[];this.$element=n(a);this.$element.hide();this.isSelect=(a.tagName==="SELECT");this.multiple=(this.isSelect&&a.hasAttribute("multiple"));this.objectItems=b&&b.itemValue;this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=n('<div class="bootstrap-tagsinput"></div>');this.$input=n('<input size="'+this.inputSize+'" type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.after(this.$container);this.build(b)}o.prototype={constructor:o,add:function(x,b){var w=this;if(w.options.maxTags&&w.itemsArray.length>=w.options.maxTags){return}if(x!==false&&!x){return}if(typeof x==="object"&&!w.objectItems){throw ("Can't add objects when itemValue option is not set")}if(x.toString().match(/^\s*$/)){return}if(w.isSelect&&!w.multiple&&w.itemsArray.length>0){w.remove(w.itemsArray[0])}if(typeof x==="string"&&this.$element[0].tagName==="INPUT"){var a=x.split(",");if(a.length>1){for(var d=0;d<a.length;d++){this.add(a[d],true)}if(!b){w.pushVal()}return}}var g=w.options.itemValue(x),y=w.options.itemText(x),e=w.options.tagClass(x);var h=n.grep(w.itemsArray,function(q){return w.options.itemValue(q)===g})[0];if(h){if(w.options.onTagExists){var f=n(".tag",w.$container).filter(function(){return n(this).data("item")===h});w.options.onTagExists(x,f)}return}w.itemsArray.push(x);var c=n('<span class="tag '+m(e)+'">'+m(y)+'<span data-role="remove"></span></span>');c.data("item",x);w.findInputWrapper().before(c);c.after(" ");if(w.isSelect&&!n('option[value="'+escape(g)+'"]',w.$element)[0]){var v=n("<option selected>"+m(y)+"</option>");v.data("item",x);v.attr("value",g);w.$element.append(v)}if(!b){w.pushVal()}if(w.options.maxTags===w.itemsArray.length){w.$container.addClass("bootstrap-tagsinput-max")}w.$element.trigger(n.Event("itemAdded",{item:x}))},remove:function(b,a){var c=this;if(c.objectItems){if(typeof b==="object"){b=n.grep(c.itemsArray,function(d){return c.options.itemValue(d)==c.options.itemValue(b)})[0]}else{b=n.grep(c.itemsArray,function(d){return c.options.itemValue(d)==b})[0]}}if(b){n(".tag",c.$container).filter(function(){return n(this).data("item")===b}).remove();n("option",c.$element).filter(function(){return n(this).data("item")===b}).remove();c.itemsArray.splice(n.inArray(b,c.itemsArray),1)}if(!a){c.pushVal()}if(c.options.maxTags>c.itemsArray.length){c.$container.removeClass("bootstrap-tagsinput-max")}c.$element.trigger(n.Event("itemRemoved",{item:b}))},removeAll:function(){var a=this;n(".tag",a.$container).remove();n("option",a.$element).remove();while(a.itemsArray.length>0){a.itemsArray.pop()}a.pushVal();if(a.options.maxTags&&!this.isEnabled()){this.enable()}},refresh:function(){var a=this;n(".tag",a.$container).each(function(){var d=n(this),b=d.data("item"),g=a.options.itemValue(b),e=a.options.itemText(b),f=a.options.tagClass(b);d.attr("class",null);d.addClass("tag "+m(f));d.contents().filter(function(){return this.nodeType==3})[0].nodeValue=m(e);if(a.isSelect){var c=n("option",a.$element).filter(function(){return n(this).data("item")===b});c.attr("value",g)}})},items:function(){return this.itemsArray},pushVal:function(){var b=this,a=n.map(b.items(),function(c){return b.options.itemValue(c).toString()});b.$element.val(a,true).trigger("change")},build:function(b){var c=this;c.options=n.extend({},j,b);var a=c.options.typeahead||{};if(c.objectItems){c.options.freeInput=false}p(c.options,"itemValue");p(c.options,"itemText");p(c.options,"tagClass");if(c.options.source){a.source=c.options.source}if(a.source&&n.fn.typeahead){l(a,"source");c.$input.typeahead({source:function(h,f){function e(x){var v=[];for(var w=0;w<x.length;w++){var u=c.options.itemText(x[w]);g[u]=x[w];v.push(u)}f(v)}this.map={};var g=this.map,d=a.source(h);if(n.isFunction(d.success)){d.success(e)}else{n.when(d).then(e)}},updater:function(d){c.add(this.map[d])},matcher:function(d){return(d.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1)},sorter:function(d){return d.sort()},highlighter:function(d){var e=new RegExp("("+this.query+")","gi");return d.replace(e,"<strong>$1</strong>")}})}c.$container.on("click",n.proxy(function(d){c.$input.focus()},c));c.$container.on("keydown","input",n.proxy(function(g){var f=n(g.target),t=c.findInputWrapper();switch(g.which){case 8:if(k(f[0])===0){var h=t.prev();if(h){c.remove(h.data("item"))}}break;case 46:if(k(f[0])===0){var d=t.next();if(d){c.remove(d.data("item"))}}break;case 37:var e=t.prev();if(f.val().length===0&&e[0]){e.before(t);f.focus()}break;case 39:var s=t.next();if(f.val().length===0&&s[0]){s.after(t);f.focus()}break;default:if(c.options.freeInput&&n.inArray(g.which,c.options.confirmKeys)>=0){c.add(f.val());f.val("");g.preventDefault()}}f.attr("size",Math.max(this.inputSize,f.val().length))},c));c.$container.on("click","[data-role=remove]",n.proxy(function(d){c.remove(n(d.target).closest(".tag").data("item"))},c));if(c.options.itemValue===j.itemValue){if(c.$element[0].tagName==="INPUT"){c.add(c.$element.val())}else{n("option",c.$element).each(function(){c.add(n(this).attr("value"),true)})}}},destroy:function(){var a=this;a.$container.off("keypress","input");a.$container.off("click","[role=remove]");a.$container.remove();a.$element.removeData("tagsinput");a.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var a=this.$input[0],b=this.$container[0];while(a&&a.parentNode!==b){a=a.parentNode}return n(a)}};n.fn.tagsinput=function(b,c){var a=[];this.each(function(){var d=n(this).data("tagsinput");if(!d){d=new o(this,b);n(this).data("tagsinput",d);a.push(d);if(this.tagName==="SELECT"){n("option",n(this)).attr("selected","selected")}n(this).val(n(this).val())}else{var e=d[b](c);if(e!==undefined){a.push(e)}}});if(typeof b=="string"){return a.length>1?a:a[0]}else{return a}};n.fn.tagsinput.Constructor=o;function p(b,a){if(typeof b[a]!=="function"){var c=b[a];b[a]=function(d){return d[c]}}}function l(c,b){if(typeof c[b]!=="function"){var a=c[b];c[b]=function(){return a}}}var i=n("<div />");function m(a){if(a){return i.text(a).html()}else{return""}}function k(b){var a=0;if(document.selection){b.focus();var c=document.selection.createRange();c.moveStart("character",-b.value.length);a=c.text.length}else{if(b.selectionStart||b.selectionStart=="0"){a=b.selectionStart}}return(a)}n(function(){n("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);