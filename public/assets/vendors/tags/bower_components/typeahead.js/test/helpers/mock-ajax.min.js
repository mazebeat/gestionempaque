var ajaxRequests=[];function mostRecentAjaxRequest(){if(ajaxRequests.length>0){return ajaxRequests[ajaxRequests.length-1]}else{return null}}function clearAjaxRequests(){ajaxRequests=[]}function FakeXMLHttpRequest(){var a=Object.extend||$.extend;a(this,{requestHeaders:{},open:function(){this.method=arguments[0];this.url=arguments[1];this.readyState=1},setRequestHeader:function(c,b){this.requestHeaders[c]=b},abort:function(){this.readyState=0},readyState:0,onreadystatechange:function(b){},status:null,send:function(b){this.params=b;this.readyState=2},getResponseHeader:function(b){return this.responseHeaders[b]},getAllResponseHeaders:function(){var c=[];for(var b in this.responseHeaders){if(this.responseHeaders.hasOwnProperty(b)){c.push(b+": "+this.responseHeaders[b])}}return c.join("\r\n")},responseText:null,response:function(b){this.status=b.status;this.responseText=b.responseText||"";this.readyState=4;this.responseHeaders=b.responseHeaders||{"Content-type":b.contentType||"application/json"};this.onreadystatechange()},responseTimeout:function(){this.readyState=4;jasmine.Clock.tick(jQuery.ajaxSettings.timeout||30000);this.onreadystatechange("timeout")}});return this}jasmine.Ajax={isInstalled:function(){return jasmine.Ajax.installed==true},assertInstalled:function(){if(!jasmine.Ajax.isInstalled()){throw new Error("Mock ajax is not installed, use jasmine.Ajax.useMock()")}},useMock:function(){if(!jasmine.Ajax.isInstalled()){var a=jasmine.getEnv().currentSpec;a.after(jasmine.Ajax.uninstallMock);jasmine.Ajax.installMock()}},installMock:function(){if(typeof jQuery!="undefined"){jasmine.Ajax.installJquery()}else{if(typeof Prototype!="undefined"){jasmine.Ajax.installPrototype()}else{throw new Error("jasmine.Ajax currently only supports jQuery and Prototype")}}jasmine.Ajax.installed=true},installJquery:function(){jasmine.Ajax.mode="jQuery";jasmine.Ajax.real=jQuery.ajaxSettings.xhr;jQuery.ajaxSettings.xhr=jasmine.Ajax.jQueryMock},installPrototype:function(){jasmine.Ajax.mode="Prototype";jasmine.Ajax.real=Ajax.getTransport;Ajax.getTransport=jasmine.Ajax.prototypeMock},uninstallMock:function(){jasmine.Ajax.assertInstalled();if(jasmine.Ajax.mode=="jQuery"){jQuery.ajaxSettings.xhr=jasmine.Ajax.real}else{if(jasmine.Ajax.mode=="Prototype"){Ajax.getTransport=jasmine.Ajax.real}}jasmine.Ajax.reset()},reset:function(){jasmine.Ajax.installed=false;jasmine.Ajax.mode=null;jasmine.Ajax.real=null},jQueryMock:function(){var a=new FakeXMLHttpRequest();ajaxRequests.push(a);return a},prototypeMock:function(){return new FakeXMLHttpRequest()},installed:false,mode:null};if(typeof Prototype!="undefined"&&Ajax&&Ajax.Request){Ajax.Request.prototype.originalRequest=Ajax.Request.prototype.request;Ajax.Request.prototype.request=function(a){this.originalRequest(a);ajaxRequests.push(this)};Ajax.Request.prototype.response=function(a){return this.transport.response(a)}};