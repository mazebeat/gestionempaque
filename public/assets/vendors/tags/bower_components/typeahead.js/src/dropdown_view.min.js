var DropdownView=(function(){var c={suggestionsList:'<span class="tt-suggestions"></span>'},b={suggestionsList:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"}};function d(e){utils.bindAll(this);this.isOpen=false;this.isEmpty=true;this.isMouseOverDropdown=false;this.$menu=$(e.menu).on("mouseenter.tt",this._handleMouseenter).on("mouseleave.tt",this._handleMouseleave).on("click.tt",".tt-suggestion",this._handleSelection).on("mouseover.tt",".tt-suggestion",this._handleMouseover)}utils.mixin(d.prototype,EventTarget,{_handleMouseenter:function(){this.isMouseOverDropdown=true},_handleMouseleave:function(){this.isMouseOverDropdown=false},_handleMouseover:function(f){var e=$(f.currentTarget);this._getSuggestions().removeClass("tt-is-under-cursor");e.addClass("tt-is-under-cursor")},_handleSelection:function(f){var e=$(f.currentTarget);this.trigger("suggestionSelected",a(e))},_show:function(){this.$menu.css("display","block")},_hide:function(){this.$menu.hide()},_moveCursor:function(g){var i,f,e,h;if(!this.isVisible()){return}i=this._getSuggestions();f=i.filter(".tt-is-under-cursor");f.removeClass("tt-is-under-cursor");e=i.index(f)+g;e=(e+1)%(i.length+1)-1;if(e===-1){this.trigger("cursorRemoved");return}else{if(e<-1){e=i.length-1}}h=i.eq(e).addClass("tt-is-under-cursor");this._ensureVisibility(h);this.trigger("cursorMoved",a(h))},_getSuggestions:function(){return this.$menu.find(".tt-suggestions > .tt-suggestion")},_ensureVisibility:function(h){var i=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),f=this.$menu.scrollTop(),e=h.position().top,g=e+h.outerHeight(true);if(e<0){this.$menu.scrollTop(f+e)}else{if(i<g){this.$menu.scrollTop(f+(g-i))}}},destroy:function(){this.$menu.off(".tt");this.$menu=null},isVisible:function(){return this.isOpen&&!this.isEmpty},closeUnlessMouseIsOverDropdown:function(){if(!this.isMouseOverDropdown){this.close()}},close:function(){if(this.isOpen){this.isOpen=false;this.isMouseOverDropdown=false;this._hide();this.$menu.find(".tt-suggestions > .tt-suggestion").removeClass("tt-is-under-cursor");this.trigger("closed")}},open:function(){if(!this.isOpen){this.isOpen=true;!this.isEmpty&&this._show();this.trigger("opened")}},setLanguageDirection:function(e){var f={left:"0",right:"auto"},g={left:"auto",right:" 0"};e==="ltr"?this.$menu.css(f):this.$menu.css(g)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(+1)},getSuggestionUnderCursor:function(){var e=this._getSuggestions().filter(".tt-is-under-cursor").first();return e.length>0?a(e):null},getFirstSuggestion:function(){var e=this._getSuggestions().first();return e.length>0?a(e):null},renderSuggestions:function(h,i){var e="tt-dataset-"+h.name,f='<div class="tt-suggestion">%body</div>',l,k,m=this.$menu.find("."+e),g,j,n;if(m.length===0){k=$(c.suggestionsList).css(b.suggestionsList);m=$("<div></div>").addClass(e).append(h.header).append(k).append(h.footer).appendTo(this.$menu)}if(i.length>0){this.isEmpty=false;this.isOpen&&this._show();g=document.createElement("div");j=document.createDocumentFragment();utils.each(i,function(p,o){o.dataset=h.name;l=h.template(o.datum);g.innerHTML=f.replace("%body",l);n=$(g.firstChild).css(b.suggestion).data("suggestion",o);n.children().each(function(){$(this).css(b.suggestionChild)});j.appendChild(n[0])});m.show().find(".tt-suggestions").html(j)}else{this.clearSuggestions(h.name)}this.trigger("suggestionsRendered")},clearSuggestions:function(g){var e=g?this.$menu.find(".tt-dataset-"+g):this.$menu.find('[class^="tt-dataset-"]'),f=e.find(".tt-suggestions");e.hide();f.empty();if(this._getSuggestions().length===0){this.isEmpty=true;this._hide()}}});return d;function a(e){return e.data("suggestion")}})();