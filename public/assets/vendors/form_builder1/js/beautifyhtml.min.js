(function(){function a(s,e,n,f){var x,q,o,h,i,w;e=e||{};q=e.indent_size||4;o=e.indent_char||" ";i=e.brace_style||"collapse";h=e.max_char===0?Infinity:e.max_char||250;w=e.unformatted||["a","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"];function d(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",parentcount:1,parent1:""};this.tag_type="";this.token_text=this.last_token=this.last_text=this.token_type="";this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(z,t){for(var y=0;y<t.length;y++){if(z===t[y]){return true}}return false}};this.get_content=function(){var t="",z=[],A=false;while(this.input.charAt(this.pos)!=="<"){if(this.pos>=this.input.length){return z.length?z.join(""):["","TK_EOF"]}t=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(t,this.Utils.whitespace)){if(z.length){A=true}this.line_char_count--;continue}else{if(A){if(this.line_char_count>=this.max_char){z.push("\n");for(var y=0;y<this.indent_level;y++){z.push(this.indent_string)}this.line_char_count=0}else{z.push(" ");this.line_char_count++}A=false}}z.push(t)}return z.length?z.join(""):""};this.get_contents_to=function(z){if(this.pos===this.input.length){return["","TK_EOF"]}var t="";var A="";var B=new RegExp("</"+z+"\\s*>","igm");B.lastIndex=this.pos;var y=B.exec(this.input);var C=y?y.index:this.input.length;if(this.pos<C){A=this.input.substring(this.pos,C);this.pos=C}return A};this.record_tag=function(t){if(this.tags[t+"count"]){this.tags[t+"count"]++;this.tags[t+this.tags[t+"count"]]=this.indent_level}else{this.tags[t+"count"]=1;this.tags[t+this.tags[t+"count"]]=this.indent_level}this.tags[t+this.tags[t+"count"]+"parent"]=this.tags.parent;this.tags.parent=t+this.tags[t+"count"]};this.retrieve_tag=function(t){if(this.tags[t+"count"]){var y=this.tags.parent;while(y){if(t+this.tags[t+"count"]===y){break}y=this.tags[y+"parent"]}if(y){this.indent_level=this.tags[t+this.tags[t+"count"]];this.tags.parent=this.tags[y+"parent"]}delete this.tags[t+this.tags[t+"count"]+"parent"];delete this.tags[t+this.tags[t+"count"]];if(this.tags[t+"count"]===1){delete this.tags[t+"count"]}else{this.tags[t+"count"]--}}};this.get_tag=function(H){var C="",E=[],D="",y=false,G,B,z=this.pos,t=this.line_char_count;H=H!==undefined?H:false;do{if(this.pos>=this.input.length){if(H){this.pos=z;this.line_char_count=t}return E.length?E.join(""):["","TK_EOF"]}C=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(C,this.Utils.whitespace)){y=true;this.line_char_count--;continue}if(C==="'"||C==='"'){if(!E[1]||E[1]!=="!"){C+=this.get_unformatted(C);y=true}}if(C==="="){y=false}if(E.length&&E[E.length-1]!=="="&&C!==">"&&y){if(this.line_char_count>=this.max_char){this.print_newline(false,E);this.line_char_count=0}else{E.push(" ");this.line_char_count++}y=false}if(C==="<"){G=this.pos-1}E.push(C)}while(C!==">");var I=E.join("");var A;if(I.indexOf(" ")!==-1){A=I.indexOf(" ")}else{A=I.indexOf(">")}var F=I.substring(1,A).toLowerCase();if(I.charAt(I.length-2)==="/"||this.Utils.in_array(F,this.Utils.single_token)){if(!H){this.tag_type="SINGLE"}}else{if(F==="script"){if(!H){this.record_tag(F);this.tag_type="SCRIPT"}}else{if(F==="style"){if(!H){this.record_tag(F);this.tag_type="STYLE"}}else{if(this.is_unformatted(F,w)){D=this.get_unformatted("</"+F+">",I);E.push(D);if(G>0&&this.Utils.in_array(this.input.charAt(G-1),this.Utils.whitespace)){E.splice(0,0,this.input.charAt(G-1))}B=this.pos-1;if(this.Utils.in_array(this.input.charAt(B+1),this.Utils.whitespace)){E.push(this.input.charAt(B+1))}this.tag_type="SINGLE"}else{if(F.charAt(0)==="!"){if(F.indexOf("[if")!==-1){if(I.indexOf("!IE")!==-1){D=this.get_unformatted("-->",I);E.push(D)}if(!H){this.tag_type="START"}}else{if(F.indexOf("[endif")!==-1){this.tag_type="END";this.unindent()}else{if(F.indexOf("[cdata[")!==-1){D=this.get_unformatted("]]>",I);E.push(D);if(!H){this.tag_type="SINGLE"}}else{D=this.get_unformatted("-->",I);E.push(D);this.tag_type="SINGLE"}}}}else{if(!H){if(F.charAt(0)==="/"){this.retrieve_tag(F.substring(1));this.tag_type="END"}else{this.record_tag(F);this.tag_type="START"}if(this.Utils.in_array(F,this.Utils.extra_liners)){this.print_newline(true,this.output)}}}}}}}if(H){this.pos=z;this.line_char_count=t}return E.join("")};this.get_unformatted=function(y,z){if(z&&z.toLowerCase().indexOf(y)!==-1){return""}var t="";var A="";var B=true;do{if(this.pos>=this.input.length){return A}t=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(t,this.Utils.whitespace)){if(!B){this.line_char_count--;continue}if(t==="\n"||t==="\r"){A+="\n";this.line_char_count=0;continue}}A+=t;this.line_char_count++;B=true}while(A.toLowerCase().indexOf(y)===-1);return A};this.get_token=function(){var t;if(this.last_token==="TK_TAG_SCRIPT"||this.last_token==="TK_TAG_STYLE"){var y=this.last_token.substr(7);t=this.get_contents_to(y);if(typeof t!=="string"){return t}return[t,"TK_"+y]}if(this.current_mode==="CONTENT"){t=this.get_content();if(typeof t!=="string"){return t}else{return[t,"TK_CONTENT"]}}if(this.current_mode==="TAG"){t=this.get_tag();if(typeof t!=="string"){return t}else{var z="TK_TAG_"+this.tag_type;return[t,z]}}};this.get_full_indent=function(t){t=this.indent_level+t||0;if(t<1){return""}return Array(t+1).join(this.indent_string)};this.is_unformatted=function(z,y){if(!this.Utils.in_array(z,y)){return false}if(z.toLowerCase()!=="a"||!this.Utils.in_array("a",y)){return true}var A=this.get_tag(true);var t=(A||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);if(!t||this.Utils.in_array(t,y)){return true}else{return false}};this.printer=function(A,z,t,C,B){this.input=A||"";this.output=[];this.indent_character=z;this.indent_string="";this.indent_size=t;this.brace_style=B;this.indent_level=0;this.max_char=C;this.line_char_count=0;for(var y=0;y<this.indent_size;y++){this.indent_string+=this.indent_character}this.print_newline=function(F,D){this.line_char_count=0;if(!D||!D.length){return}if(!F){while(this.Utils.in_array(D[D.length-1],this.Utils.whitespace)){D.pop()}}D.push("\n");for(var E=0;E<this.indent_level;E++){D.push(this.indent_string)}};this.print_token=function(D){this.output.push(D)};this.indent=function(){this.indent_level++};this.unindent=function(){if(this.indent_level>0){this.indent_level--}}};return this}x=new d();x.printer(s,o,q,h,i);while(true){var k=x.get_token();x.token_text=k[0];x.token_type=k[1];if(x.token_type==="TK_EOF"){break}switch(x.token_type){case"TK_TAG_START":x.print_newline(false,x.output);x.print_token(x.token_text);x.indent();x.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":x.print_newline(false,x.output);x.print_token(x.token_text);x.current_mode="CONTENT";break;case"TK_TAG_END":if(x.last_token==="TK_CONTENT"&&x.last_text===""){var v=x.token_text.match(/\w+/)[0];var m=x.output[x.output.length-1].match(/<\s*(\w+)/);if(m===null||m[1]!==v){x.print_newline(true,x.output)}}x.print_token(x.token_text);x.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var c=x.token_text.match(/^\s*<([a-z]+)/i);if(!c||!x.Utils.in_array(c[1],w)){x.print_newline(false,x.output)}x.print_token(x.token_text);x.current_mode="CONTENT";break;case"TK_CONTENT":if(x.token_text!==""){x.print_token(x.token_text)}x.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(x.token_text!==""){x.output.push("\n");var l=x.token_text,r,j=1;if(x.token_type==="TK_SCRIPT"){r=typeof n==="function"&&n}else{if(x.token_type==="TK_STYLE"){r=typeof f==="function"&&f}}if(e.indent_scripts==="keep"){j=0}else{if(e.indent_scripts==="separate"){j=-x.indent_level}}var b=x.get_full_indent(j);if(r){l=r(l.replace(/^\s*/,b),e)}else{var g=l.match(/^\s*/)[0];var p=g.match(/[^\n\r]*$/)[0].split(x.indent_string).length-1;var u=x.get_full_indent(j-p);l=l.replace(/^\s*/,b).replace(/\r\n|\r|\n/g,"\n"+u).replace(/\s*$/,"")}if(l){x.print_token(l);x.print_newline(true,x.output)}}x.current_mode="TAG";break}x.last_token=x.token_type;x.last_text=x.token_text}return x.output.join("")}window.html_beautify=function(c,b){return a(c,b,window.js_beautify,window.css_beautify)}}());