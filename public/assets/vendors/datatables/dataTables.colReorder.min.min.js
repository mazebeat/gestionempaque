/*!
 ColReorder 1.1.1
 Â©2010-2014 SpryMedia Ltd - datatables.net/license
*/
(function(f,d,c){function a(g){for(var j=[],h=0,i=g.length;h<i;h++){j[g[h]]=h}return j}function b(g,i,h){i=g.splice(i,1)[0];g.splice(h,0,i)}function e(g,j,h){for(var i=[],l=0,k=g.childNodes.length;l<k;l++){1==g.childNodes[l].nodeType&&i.push(g.childNodes[l])}j=i[j];null!==h?g.insertBefore(j,i[h]):g.appendChild(j)}$.fn.dataTableExt.oApi.fnColReorder=function(u,r,v){var q=$.fn.dataTable.Api?!0:!1,t,s,p,i,n=u.aoColumns.length,o;if(r!=v){if(0>r||r>=n){this.oApi._fnLog(u,1,"ColReorder 'from' index is out of bounds: "+r)}else{if(0>v||v>=n){this.oApi._fnLog(u,1,"ColReorder 'to' index is out of bounds: "+v)}else{p=[];t=0;for(s=n;t<s;t++){p[t]=t}b(p,r,v);var m=a(p);t=0;for(s=u.aaSorting.length;t<s;t++){u.aaSorting[t][0]=m[u.aaSorting[t][0]]}if(null!==u.aaSortingFixed){t=0;for(s=u.aaSortingFixed.length;t<s;t++){u.aaSortingFixed[t][0]=m[u.aaSortingFixed[t][0]]}}t=0;for(s=n;t<s;t++){o=u.aoColumns[t];p=0;for(i=o.aDataSort.length;p<i;p++){o.aDataSort[p]=m[o.aDataSort[p]]}q&&(o.idx=m[o.idx])}q&&$.each(u.aLastSort,function(g,h){u.aLastSort[g].src=m[h.src]});t=0;for(s=n;t<s;t++){o=u.aoColumns[t],"number"==typeof o.mData&&(o.mData=m[o.mData],u.oApi._fnColumnOptions(u,t,{}))}if(u.aoColumns[r].bVisible){i=this.oApi._fnColumnIndexToVisible(u,r);o=null;for(t=v<r?v:v+1;null===o&&t<n;){o=this.oApi._fnColumnIndexToVisible(u,t),t++}p=u.nTHead.getElementsByTagName("tr");t=0;for(s=p.length;t<s;t++){e(p[t],i,o)}if(null!==u.nTFoot){p=u.nTFoot.getElementsByTagName("tr");t=0;for(s=p.length;t<s;t++){e(p[t],i,o)}}t=0;for(s=u.aoData.length;t<s;t++){null!==u.aoData[t].nTr&&e(u.aoData[t].nTr,i,o)}}b(u.aoColumns,r,v);b(u.aoPreSearchCols,r,v);t=0;for(s=u.aoData.length;t<s;t++){p=u.aoData[t],q?(p.anCells&&b(p.anCells,r,v),"dom"!==p.src&&$.isArray(p._aData)&&b(p._aData,r,v)):($.isArray(p._aData)&&b(p._aData,r,v),b(p._anHidden,r,v))}t=0;for(s=u.aoHeader.length;t<s;t++){b(u.aoHeader[t],r,v)}if(null!==u.aoFooter){t=0;for(s=u.aoFooter.length;t<s;t++){b(u.aoFooter[t],r,v)}}q&&(new $.fn.dataTable.Api(u)).rows().invalidate();t=0;for(s=n;t<s;t++){$(u.aoColumns[t].nTh).off("click.DT"),this.oApi._fnSortAttachListener(u,u.aoColumns[t].nTh,t)}$(u.oInstance).trigger("column-reorder",[u,{iFrom:r,iTo:v,aiInvertMapping:m}])}}}};f=function(g){var h=function(i,j){var k;g.fn.dataTable.Api?k=(new g.fn.dataTable.Api(i)).settings()[0]:i.fnSettings?k=i.fnSettings():"string"===typeof i?g.fn.dataTable.fnIsDataTable(g(i)[0])&&(k=g(i).eq(0).dataTable().fnSettings()):i.nodeName&&"table"===i.nodeName.toLowerCase()?g.fn.dataTable.fnIsDataTable(i.nodeName)&&(k=g(i.nodeName).dataTable().fnSettings()):i instanceof jQuery?g.fn.dataTable.fnIsDataTable(i[0])&&(k=i.eq(0).dataTable().fnSettings()):k=i;g.fn.dataTable.camelToHungarian&&g.fn.dataTable.camelToHungarian(h.defaults,j||{});this.s={dt:null,init:g.extend(!0,{},h.defaults,j),fixed:0,fixedRight:0,dropCallback:null,mouse:{startX:-1,startY:-1,offsetX:-1,offsetY:-1,target:-1,targetIndex:-1,fromIndex:-1},aoTargets:[]};this.dom={drag:null,pointer:null};this.s.dt=k.oInstance.fnSettings();this.s.dt._colReorder=this;this._fnConstruct();k.oApi._fnCallbackReg(k,"aoDestroyCallback",g.proxy(this._fnDestroy,this),"ColReorder");return this};h.prototype={fnReset:function(){for(var j=[],i=0,k=this.s.dt.aoColumns.length;i<k;i++){j.push(this.s.dt.aoColumns[i]._ColReorder_iOrigCol)}this._fnOrderColumns(j);return this},fnGetCurrentOrder:function(){return this.fnOrder()},fnOrder:function(j){if(j===c){for(var j=[],i=0,k=this.s.dt.aoColumns.length;i<k;i++){j.push(this.s.dt.aoColumns[i]._ColReorder_iOrigCol)}return j}this._fnOrderColumns(a(j));return this},_fnConstruct:function(){var j=this,i=this.s.dt.aoColumns.length,m;this.s.init.iFixedColumns&&(this.s.fixed=this.s.init.iFixedColumns);this.s.fixedRight=this.s.init.iFixedColumnsRight?this.s.init.iFixedColumnsRight:0;this.s.init.fnReorderCallback&&(this.s.dropCallback=this.s.init.fnReorderCallback);for(m=0;m<i;m++){m>this.s.fixed-1&&m<i-this.s.fixedRight&&this._fnMouseListener(m,this.s.dt.aoColumns[m].nTh),this.s.dt.aoColumns[m]._ColReorder_iOrigCol=m}this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(o,n){j._fnStateSave.call(j,n)},"ColReorder_State");var l=null;this.s.init.aiOrder&&(l=this.s.init.aiOrder.slice());this.s.dt.oLoadedState&&("undefined"!=typeof this.s.dt.oLoadedState.ColReorder&&this.s.dt.oLoadedState.ColReorder.length==this.s.dt.aoColumns.length)&&(l=this.s.dt.oLoadedState.ColReorder);if(l){if(j.s.dt._bInitComplete){i=a(l),j._fnOrderColumns.call(j,i)}else{var k=!1;this.s.dt.aoDrawCallback.push({fn:function(){if(!j.s.dt._bInitComplete&&!k){k=true;var n=a(l);j._fnOrderColumns.call(j,n)}},sName:"ColReorder_Pre"})}}else{this._fnSetColumnIndexes()}},_fnOrderColumns:function(i){if(i.length!=this.s.dt.aoColumns.length){this.s.dt.oInstance.oApi._fnLog(this.s.dt,1,"ColReorder - array reorder does not match known number of columns. Skipping.")}else{for(var j=0,l=i.length;j<l;j++){var k=g.inArray(j,i);j!=k&&(b(i,k,j),this.s.dt.oInstance.fnColReorder(k,j))}(""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY)&&this.s.dt.oInstance.fnAdjustColumnSizing();this.s.dt.oInstance.oApi._fnSaveState(this.s.dt);this._fnSetColumnIndexes()}},_fnStateSave:function(i){var k,n,m,j=this.s.dt;for(k=0;k<i.aaSorting.length;k++){i.aaSorting[k][0]=j.aoColumns[i.aaSorting[k][0]]._ColReorder_iOrigCol}var l=g.extend(!0,[],i.aoSearchCols);i.ColReorder=[];k=0;for(n=j.aoColumns.length;k<n;k++){m=j.aoColumns[k]._ColReorder_iOrigCol,i.aoSearchCols[m]=l[k],i.abVisCols[m]=j.aoColumns[k].bVisible,i.ColReorder.push(m)}},_fnMouseListener:function(i,j){var k=this;g(j).on("mousedown.ColReorder",function(l){l.preventDefault();k._fnMouseDown.call(k,l,j)})},_fnMouseDown:function(i,j){var m=this,l=g(i.target).closest("th, td").offset(),k=parseInt(g(j).attr("data-column-index"),10);k!==c&&(this.s.mouse.startX=i.pageX,this.s.mouse.startY=i.pageY,this.s.mouse.offsetX=i.pageX-l.left,this.s.mouse.offsetY=i.pageY-l.top,this.s.mouse.target=this.s.dt.aoColumns[k].nTh,this.s.mouse.targetIndex=k,this.s.mouse.fromIndex=k,this._fnRegions(),g(d).on("mousemove.ColReorder",function(n){m._fnMouseMove.call(m,n)}).on("mouseup.ColReorder",function(n){m._fnMouseUp.call(m,n)}))},_fnMouseMove:function(j){if(null===this.dom.drag){if(5>Math.pow(Math.pow(j.pageX-this.s.mouse.startX,2)+Math.pow(j.pageY-this.s.mouse.startY,2),0.5)){return}this._fnCreateDragNode()}this.dom.drag.css({left:j.pageX-this.s.mouse.offsetX,top:j.pageY-this.s.mouse.offsetY});for(var i=!1,m=this.s.mouse.toIndex,l=1,k=this.s.aoTargets.length;l<k;l++){if(j.pageX<this.s.aoTargets[l-1].x+(this.s.aoTargets[l].x-this.s.aoTargets[l-1].x)/2){this.dom.pointer.css("left",this.s.aoTargets[l-1].x);this.s.mouse.toIndex=this.s.aoTargets[l-1].to;i=!0;break}}i||(this.dom.pointer.css("left",this.s.aoTargets[this.s.aoTargets.length-1].x),this.s.mouse.toIndex=this.s.aoTargets[this.s.aoTargets.length-1].to);this.s.init.bRealtime&&m!==this.s.mouse.toIndex&&(this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex),this.s.mouse.fromIndex=this.s.mouse.toIndex,this._fnRegions())},_fnMouseUp:function(){g(d).off("mousemove.ColReorder mouseup.ColReorder");null!==this.dom.drag&&(this.dom.drag.remove(),this.dom.pointer.remove(),this.dom.drag=null,this.dom.pointer=null,this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex),this._fnSetColumnIndexes(),(""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY)&&this.s.dt.oInstance.fnAdjustColumnSizing(),null!==this.s.dropCallback&&this.s.dropCallback.call(this),this.s.dt.oInstance.oApi._fnSaveState(this.s.dt))},_fnRegions:function(){var i=this.s.dt.aoColumns;this.s.aoTargets.splice(0,this.s.aoTargets.length);this.s.aoTargets.push({x:g(this.s.dt.nTable).offset().left,to:0});for(var j=0,l=0,k=i.length;l<k;l++){l!=this.s.mouse.fromIndex&&j++,i[l].bVisible&&this.s.aoTargets.push({x:g(i[l].nTh).offset().left+g(i[l].nTh).outerWidth(),to:j})}0!==this.s.fixedRight&&this.s.aoTargets.splice(this.s.aoTargets.length-this.s.fixedRight);0!==this.s.fixed&&this.s.aoTargets.splice(0,this.s.fixed)},_fnCreateDragNode:function(){var j=""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY,l=this.s.dt.aoColumns[this.s.mouse.targetIndex].nTh,o=l.parentNode,n=o.parentNode,m=n.parentNode,k=g(l).clone();this.dom.drag=g(m.cloneNode(!1)).addClass("DTCR_clonedTable").append(n.cloneNode(!1).appendChild(o.cloneNode(!1).appendChild(k[0]))).css({position:"absolute",top:0,left:0,width:g(l).outerWidth(),height:g(l).outerHeight()}).appendTo("body");this.dom.pointer=g("<div></div>").addClass("DTCR_pointer").css({position:"absolute",top:j?g("div.dataTables_scroll",this.s.dt.nTableWrapper).offset().top:g(this.s.dt.nTable).offset().top,height:j?g("div.dataTables_scroll",this.s.dt.nTableWrapper).height():g(this.s.dt.nTable).height()}).appendTo("body")},_fnDestroy:function(){var i,j;i=0;for(j=this.s.dt.aoDrawCallback.length;i<j;i++){if("ColReorder_Pre"===this.s.dt.aoDrawCallback[i].sName){this.s.dt.aoDrawCallback.splice(i,1);break}}g(this.s.dt.nTHead).find("*").off(".ColReorder");g.each(this.s.dt.aoColumns,function(k,l){g(l.nTh).removeAttr("data-column-index")});this.s=this.s.dt._colReorder=null},_fnSetColumnIndexes:function(){g.each(this.s.dt.aoColumns,function(i,j){g(j.nTh).attr("data-column-index",i)})}};h.defaults={aiOrder:null,bRealtime:!1,iFixedColumns:0,iFixedColumnsRight:0,fnReorderCallback:null};h.version="1.1.1";g.fn.dataTable.ColReorder=h;g.fn.DataTable.ColReorder=h;"function"==typeof g.fn.dataTable&&"function"==typeof g.fn.dataTableExt.fnVersionCheck&&g.fn.dataTableExt.fnVersionCheck("1.9.3")?g.fn.dataTableExt.aoFeatures.push({fnInit:function(j){var i=j.oInstance;j._colReorder?i.oApi._fnLog(j,1,"ColReorder attempted to initialise twice. Ignoring second"):(i=j.oInit,new h(j,i.colReorder||i.oColReorder||{}));return null},cFeature:"R",sFeature:"ColReorder"}):alert("Warning: ColReorder requires DataTables 1.9.3 or greater - www.datatables.net/download");g.fn.dataTable.Api&&(g.fn.dataTable.Api.register("colReorder.reset()",function(){return this.iterator("table",function(i){i._colReorder.fnReset()})}),g.fn.dataTable.Api.register("colReorder.order()",function(i){return i?this.iterator("table",function(j){j._colReorder.fnOrder(i)}):this.context.length?this.context[0]._colReorder.fnOrder():null}));return h};"function"===typeof define&&define.amd?define("datatables-colreorder",["jquery","datatables"],f):jQuery&&!jQuery.fn.dataTable.ColReorder&&f(jQuery,jQuery.fn.dataTable)})(window,document);