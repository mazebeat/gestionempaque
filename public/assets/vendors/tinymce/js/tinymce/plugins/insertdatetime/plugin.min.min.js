tinymce.PluginManager.add("insertdatetime",function(h){function k(e,l){function a(o,i){if(o=""+o,o.length<i){for(var p=0;p<i-o.length;p++){o="0"+o}}return o}return l=l||new Date,e=e.replace("%D","%m/%d/%Y"),e=e.replace("%r","%I:%M:%S %p"),e=e.replace("%Y",""+l.getFullYear()),e=e.replace("%y",""+l.getYear()),e=e.replace("%m",a(l.getMonth()+1,2)),e=e.replace("%d",a(l.getDate(),2)),e=e.replace("%H",""+a(l.getHours(),2)),e=e.replace("%M",""+a(l.getMinutes(),2)),e=e.replace("%S",""+a(l.getSeconds(),2)),e=e.replace("%I",""+((l.getHours()+11)%12+1)),e=e.replace("%p",""+(l.getHours()<12?"AM":"PM")),e=e.replace("%B",""+h.translate(m[l.getMonth()])),e=e.replace("%b",""+h.translate(c[l.getMonth()])),e=e.replace("%A",""+h.translate(b[l.getDay()])),e=e.replace("%a",""+h.translate(j[l.getDay()])),e=e.replace("%%","%")}function d(p){var l=k(p);if(h.settings.insertdatetime_element){var e;e=/%[HMSIp]/.test(p)?k("%Y-%m-%dT%H:%M"):k("%Y-%m-%d"),l='<time datetime="'+e+'">'+l+"</time>";var o=h.dom.getParent(h.selection.getStart(),"time");if(o){return h.dom.setOuterHTML(o,l),void 0}}h.insertContent(l)}var g,j="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),b="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),c="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),m="January February March April May June July August September October November December".split(" "),f=[];h.addCommand("mceInsertDate",function(){d(h.getParam("insertdatetime_dateformat",h.translate("%Y-%m-%d")))}),h.addCommand("mceInsertTime",function(){d(h.getParam("insertdatetime_timeformat",h.translate("%H:%M:%S")))}),h.addButton("inserttime",{type:"splitbutton",title:"Insert time",onclick:function(){d(g||"%H:%M:%S")},menu:f}),tinymce.each(h.settings.insertdatetime_formats||["%H:%M:%S","%Y-%m-%d","%I:%M:%S %p","%D"],function(a){f.push({text:k(a),onclick:function(){g=a,d(a)}})}),h.addMenuItem("insertdatetime",{icon:"date",text:"Insert date/time",menu:f,context:"insert"})});