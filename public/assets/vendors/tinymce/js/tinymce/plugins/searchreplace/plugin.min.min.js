!function(){function b(C,H,v,y,F){function j(f,d){if(d=d||0,!f[0]){throw"findAndReplaceDOMText cannot handle zero-length matches"}var g=f.index;if(d>0){var c=f[d];if(!c){throw"Invalid capture group"}g+=f[0].indexOf(c),f[0]=c}return[g,g+f[0].length,[f[0]]]}function q(d){var c;if(3===d.nodeType){return d.data}if(B[d.nodeName]){return""}if(c="",(w[d.nodeName]||z[d.nodeName])&&(c+="\n"),d=d.firstChild){do{c+=q(d)}while(d=d.nextSibling)}return c}function E(J,O,h){var p,M,f,g,L=[],P=0,K=J,m=O.shift(),N=0;J:for(;;){if((w[K.nodeName]||z[K.nodeName])&&P++,3===K.nodeType&&(!M&&K.length+P>=m[1]?(M=K,g=m[1]-P):p&&L.push(K),!p&&K.length+P>m[0]&&(p=K,f=m[0]-P),P+=K.length),p&&M){if(K=h({startNode:p,startNodeIndex:f,endNode:M,endNodeIndex:g,innerNodes:L,match:m[2],matchIndex:N}),P-=M.length-g,p=null,M=null,L=[],m=O.shift(),N++,!m){break}}else{if(!B[K.nodeName]&&K.firstChild){K=K.firstChild;continue}if(K.nextSibling){K=K.nextSibling;continue}}for(;;){if(K.nextSibling){K=K.nextSibling;break}if(K.parentNode===J){break J}K=K.parentNode}}}function I(d){var c;if("function"!=typeof d){var f=d.nodeType?d:G.createElement(d);c=function(l,h){var g=f.cloneNode(!1);return g.setAttribute("data-mce-index",h),l&&g.appendChild(G.createTextNode(l)),g}}else{c=d}return function(R){var K,N,U,t=R.startNode,J=R.endNode,T=R.matchIndex;if(t===J){var W=t;U=W.parentNode,R.startNodeIndex>0&&(K=G.createTextNode(W.data.substring(0,R.startNodeIndex)),U.insertBefore(K,W));var S=c(R.match[0],T);return U.insertBefore(S,W),R.endNodeIndex<W.length&&(N=G.createTextNode(W.data.substring(R.endNodeIndex)),U.insertBefore(N,W)),W.parentNode.removeChild(W),S}K=G.createTextNode(t.data.substring(0,R.startNodeIndex)),N=G.createTextNode(J.data.substring(R.endNodeIndex));for(var M=c(t.data.substring(R.startNodeIndex),T),L=[],Q=0,O=R.innerNodes.length;O>Q;++Q){var u=R.innerNodes[Q],P=c(u.data,T);u.parentNode.replaceChild(P,u),L.push(P)}var V=c(J.data.substring(0,R.endNodeIndex),T);return U=t.parentNode,U.insertBefore(K,t),U.insertBefore(M,t),U.removeChild(t),U=J.parentNode,U.insertBefore(V,J),U.insertBefore(N,J),U.removeChild(J),V}}var D,x,G,w,B,z,k=[],A=0;if(G=H.ownerDocument,w=F.getBlockElements(),B=F.getWhiteSpaceElements(),z=F.getShortEndedElements(),x=q(H)){if(C.global){for(;D=C.exec(x);){k.push(j(D,y))}}else{D=x.match(C),k.push(j(D,y))}return k.length&&(A=k.length,E(H,k,I(v))),A}}function a(f){function l(){var c=tinymce.ui.Factory.create({type:"window",layout:"flex",pack:"center",align:"center",onClose:function(){f.focus(),j=!1,k.unmarkAllMatches()},buttons:[{text:"Find",onclick:function(){c.find("form")[0].submit()}},{text:"Replace",disabled:!0,onclick:function(){k.replace(c.find("#replace").value())||c.statusbar.items().slice(1).disabled(!0)}},{text:"Replace all",disabled:!0,onclick:function(){k.replaceAll(c.find("#replace").value()),c.statusbar.items().slice(1).disabled(!0)}},{type:"spacer",flex:1},{text:"Prev",disabled:!0,onclick:function(){k.prev()}},{text:"Next",disabled:!0,onclick:function(){k.next()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,onsubmit:function(q){var v,p,m,s,u;return q.preventDefault(),m=c.find("#case").checked(),u=c.find("#words").checked(),s=c.find("#find").value(),s.length?(s=s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),s=u?"\\b"+s+"\\b":s,p=new RegExp(s,m?"g":"gi"),v=k.markAllMatches(p),v?k.first():tinymce.ui.MessageBox.alert("Could not find the specified string."),c.statusbar.items().slice(1).disabled(0===v),void 0):(k.unmarkAllMatches(),c.statusbar.items().slice(1).disabled(!0),void 0)},items:[{type:"textbox",name:"find",size:40,label:"Find",value:f.selection.getNode().src},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}}).renderTo().reflow();j=!0}function e(i){var c=i.parentNode;c.insertBefore(i.firstChild,i),i.parentNode.removeChild(i)}function d(u,x){function p(){var c,n;for(c=x?f.getBody()[u?"firstChild":"lastChild"]:w[u?"endContainer":"startContainer"],n=new tinymce.dom.TreeWalker(c,f.getBody());c=n.current();){if(1==c.nodeType&&"SPAN"==c.nodeName&&null!==c.getAttribute("data-mce-index")){for(q=c.getAttribute("data-mce-index"),m=c.firstChild;c=n.current();){if(1==c.nodeType&&"SPAN"==c.nodeName&&null!==c.getAttribute("data-mce-index")){if(c.getAttribute("data-mce-index")!==q){return}t=c.firstChild}n[u?"next":"prev"]()}}n[u?"next":"prev"]()}}var m,t,v=f.selection,w=v.getRng(!0),q=-1;return u=u!==!1,p(),m&&t&&(f.focus(),u?(w.setStart(m,0),w.setEnd(t,t.length)):(w.setStart(t,0),w.setEnd(m,m.length)),v.scrollIntoView(m.parentNode),v.setRng(w)),q}function h(c){c.parentNode.removeChild(c)}var j,k=this,g=-1;k.init=function(c){c.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Ctrl+F",onclick:l,separator:"before",context:"edit"}),c.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Ctrl+F",onclick:l}),c.addCommand("SearchReplace",l),c.shortcuts.add("Ctrl+F","",l)},k.markAllMatches=function(o){var m,c;return c=f.dom.create("span",{"class":"mce-match-marker","data-mce-bogus":1}),m=f.getBody(),k.unmarkAllMatches(m),b(o,m,c,!1,f.schema)},k.first=function(){return g=d(!0,!0),-1!==g},k.next=function(){return g=d(!0),-1!==g},k.prev=function(){return g=d(!1),-1!==g},k.replace=function(v,p,i){var x,w,r,y,q,t;if(-1===g&&(g=d(p)),t=d(p),r=f.getBody(),w=tinymce.toArray(r.getElementsByTagName("span")),w.length){for(x=0;x<w.length;x++){var s=w[x].getAttribute("data-mce-index");if(null!==s&&s.length&&(y=q=w[x].getAttribute("data-mce-index"),i||y===g)){for(v.length?(w[x].firstChild.nodeValue=v,e(w[x])):h(w[x]);w[++x];){if(y=w[x].getAttribute("data-mce-index"),null!==s&&s.length){if(y!==q){x--;break}h(w[x])}}}}}return -1==t&&(t=d(p,!0)),g=t,i&&f.selection.setCursorLocation(f.getBody(),0),f.undoManager.add(),-1!==g},k.replaceAll=function(c){k.replace(c,!0,!0)},k.unmarkAllMatches=function(){var i,m,c;for(c=f.getBody(),m=c.getElementsByTagName("span"),i=m.length;i--;){c=m[i],c.getAttribute("data-mce-index")&&e(c)}},f.on("beforeaddundo keydown",function(c){return j?(c.preventDefault(),!1):void 0})}tinymce.PluginManager.add("searchreplace",a)}();