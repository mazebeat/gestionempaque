tinymce.PluginManager.add("template",function(f){function d(){function e(l){var i=l.control.value();i.url?tinymce.util.XHR.send({url:i.url,success:function(m){a=m,k.find("iframe")[0].html(m)}}):(a=i.content,k.find("iframe")[0].html(i.content)),k.find("#description")[0].text(l.control.value().description)}var k,a,j=[];return f.settings.templates?(tinymce.each(f.settings.templates,function(i){j.push({selected:!j.length,text:i.title,value:{url:i.url,content:i.content,description:i.description}})}),k=f.windowManager.open({title:"Insert template",body:[{type:"container",label:"Templates",items:{type:"listbox",name:"template",values:j,onselect:e}},{type:"label",name:"description",label:"Description",text:"Â "},{type:"iframe",minWidth:600,minHeight:400,border:1}],onsubmit:function(){b(!1,a)}}),k.find("listbox")[0].fire("select"),void 0):(f.windowManager.alert("No templates defined"),void 0)}function h(m,s){function k(i,a){if(i=""+i,i.length<a){for(var l=0;l<a-i.length;l++){i="0"+i}}return i}var j="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),q="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),p="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),e="January February March April May June July August September October November December".split(" ");return s=s||new Date,m=m.replace("%D","%m/%d/%Y"),m=m.replace("%r","%I:%M:%S %p"),m=m.replace("%Y",""+s.getFullYear()),m=m.replace("%y",""+s.getYear()),m=m.replace("%m",k(s.getMonth()+1,2)),m=m.replace("%d",k(s.getDate(),2)),m=m.replace("%H",""+k(s.getHours(),2)),m=m.replace("%M",""+k(s.getMinutes(),2)),m=m.replace("%S",""+k(s.getSeconds(),2)),m=m.replace("%I",""+((s.getHours()+11)%12+1)),m=m.replace("%p",""+(s.getHours()<12?"AM":"PM")),m=m.replace("%B",""+f.translate(e[s.getMonth()])),m=m.replace("%b",""+f.translate(p[s.getMonth()])),m=m.replace("%A",""+f.translate(q[s.getDay()])),m=m.replace("%a",""+f.translate(j[s.getDay()])),m=m.replace("%%","%")}function c(e){var j=f.dom,a=f.getParam("template_replace_values");g(j.select("*",e),function(i){g(a,function(l,k){j.hasClass(i,k)&&"function"==typeof a[k]&&a[k](i)})})}function b(k,i){function n(l,a){return new RegExp("\\b"+a+"\\b","g").test(l.className)}var e,o,m=f.dom,j=f.selection.getContent();g(f.getParam("template_replace_values"),function(l,a){"function"!=typeof l&&(i=i.replace(new RegExp("\\{\\$"+a+"\\}","g"),l))}),e=m.create("div",null,i),o=m.select(".mceTmpl",e),o&&o.length>0&&(e=m.create("div",null),e.appendChild(o[0].cloneNode(!0))),g(m.select("*",e),function(a){n(a,f.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))&&(a.innerHTML=h(f.getParam("template_cdate_format",f.getLang("template.cdate_format")))),n(a,f.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(a.innerHTML=h(f.getParam("template_mdate_format",f.getLang("template.mdate_format")))),n(a,f.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))&&(a.innerHTML=j)}),c(e),f.execCommand("mceInsertContent",!1,e.innerHTML),f.addVisual()}var g=tinymce.each;f.addCommand("mceInsertTemplate",b),f.addButton("template",{title:"Insert template",onclick:d}),f.addMenuItem("template",{text:"Insert template",onclick:d,context:"insert"}),f.on("PreProcess",function(i){var e=f.dom;g(e.select("div",i.node),function(a){e.hasClass(a,"mceTmpl")&&(g(e.select("*",a),function(j){e.hasClass(j,f.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(j.innerHTML=h(f.getParam("template_mdate_format",f.getLang("template.mdate_format"))))}),c(a))})})});