tinymce.PluginManager.add("lists",function(b){var a=this;b.on("init",function(){function A(d){function c(l){var h,m,g;m=d[l?"startContainer":"endContainer"],g=d[l?"startOffset":"endOffset"],1==m.nodeType&&(h=K.create("span",{"data-mce-type":"bookmark"}),m.hasChildNodes()?(g=Math.min(g,m.childNodes.length-1),m.insertBefore(h,m.childNodes[g])):m.appendChild(h),m=h,g=0),f[l?"startContainer":"endContainer"]=m,f[l?"startOffset":"endOffset"]=g}var f={};return c(!0),d.collapsed||c(),f}function E(d){function f(y){function m(l){for(var i=l.parentNode.firstChild,o=0;i;){if(i==l){return o}(1!=i.nodeType||"bookmark"!=i.getAttribute("data-mce-type"))&&o++,i=i.nextSibling}return -1}var u,h,v;if(u=v=d[y?"startContainer":"endContainer"],h=d[y?"startOffset":"endOffset"],u){if(1==u.nodeType){if(u.parentNode==b.getBody()){var p,g=b.settings.forced_root_block;g?(p=K.create(g),(!tinymce.Env.ie||tinymce.Env.ie>10)&&p.appendChild(K.create("br",{"data-mce-bogus":"true"})),u.parentNode.insertBefore(p,u),u=p,h=0):(p=K.create("br"),u.parentNode.insertBefore(p,u),u=u.parentNode,h=m(p))}else{y?(h=m(u),u=u.parentNode):(h=m(u),u=u.parentNode)}K.remove(v)}d[y?"startContainer":"endContainer"]=u,d[y?"startOffset":"endOffset"]=h}}f(!0),f();var c=K.createRng();c.setStart(d.startContainer,d.startOffset),d.endContainer&&c.setEnd(d.endContainer,d.endOffset),t.setRng(c)}function w(c){return c&&/^(OL|UL)$/.test(c.nodeName)}function L(c){return c.parentNode.firstChild==c}function z(c){return c.parentNode.lastChild==c}function q(c){return c&&!!b.schema.getTextBlockElements()[c.nodeName]}function D(d,g){var c,f;if(b.settings.forced_root_block&&(g=g||b.settings.forced_root_block),f=g?K.create(g):K.createFragment(),d){for(;c=d.firstChild;){f.appendChild(c)}}return b.settings.forced_root_block||f.appendChild(K.create("br")),f.hasChildNodes()||tinymce.Env.ie&&!(tinymce.Env.ie>10)||(f.innerHTML='<br data-mce-bogus="1">'),f}function J(){return tinymce.grep(t.getSelectedBlocks(),function(c){return"LI"==c.nodeName})}function I(){return tinymce.grep(t.getSelectedBlocks(),q)}function k(h,f,l){var d,g,c=K.select('span[data-mce-type="bookmark"]',h);l=l||D(f),d=K.createRng(),d.setStartAfter(f),d.setEndAfter(h),g=d.extractContents(),K.isEmpty(g)||K.insertAfter(g,h),K.isEmpty(l)||K.insertAfter(l,h),K.isEmpty(f.parentNode)&&(tinymce.each(c,function(i){f.parentNode.parentNode.insertBefore(i,f.parentNode)}),K.remove(f.parentNode)),K.remove(f)}function B(d){var c,f;if(c=d.nextSibling,c&&w(c)&&c.nodeName==d.nodeName){for(;f=c.firstChild;){d.appendChild(f)}K.remove(c)}if(c=d.previousSibling,c&&w(c)&&c.nodeName==d.nodeName){for(;f=c.firstChild;){d.insertBefore(f,d.firstChild)}K.remove(c)}}function H(c){tinymce.each(tinymce.grep(K.select("ol,ul",c)),function(f){var d,g=f.parentNode;"LI"==g.nodeName&&g.firstChild==f&&(d=g.previousSibling,d&&"LI"==d.nodeName&&(d.appendChild(f),K.isEmpty(g)&&K.remove(g))),w(g)&&(d=g.previousSibling,d&&"LI"==d.nodeName&&d.appendChild(f))})}function x(){var d,c=A(t.getRng(!0));return tinymce.each(J(),function(g){var h,f;return h=g.previousSibling,h&&"UL"==h.nodeName?(h.appendChild(g),void 0):h&&"LI"==h.nodeName&&w(h.lastChild)?(h.lastChild.appendChild(g),void 0):(h=g.nextSibling,h&&"UL"==h.nodeName?(h.insertBefore(g,h.firstChild),void 0):(h&&"LI"==h.nodeName&&w(g.lastChild)||(h=g.previousSibling,h&&"LI"==h.nodeName&&(f=K.create(g.parentNode.nodeName),h.appendChild(f),f.appendChild(g)),d=!0),void 0))}),E(c),d}function F(){function f(g){K.isEmpty(g)&&K.remove(g)}var c,d=A(t.getRng(!0));return tinymce.each(J(),function(m){var g,h=m.parentNode,l=h.parentNode;if(L(m)&&z(m)){if("LI"==l.nodeName){K.insertAfter(m,l),f(l)}else{if(!w(l)){return}K.remove(h,!0)}}else{if(L(m)){if("LI"==l.nodeName){K.insertAfter(m,l),g=K.create("LI"),g.appendChild(h),K.insertAfter(g,m),f(l)}else{if(!w(l)){return}l.insertBefore(m,h)}}else{if(z(m)){if("LI"==l.nodeName){K.insertAfter(m,l)}else{if(!w(l)){return}K.insertAfter(m,h)}}else{if("LI"==l.nodeName){h=l,g=D(m,"LI")}else{if(!w(l)){return}g=D(m,"LI")}k(h,m,g),H(h.parentNode)}}}c=!0}),E(d),c}function G(g){function f(){function p(v){var C,l,y=b.getBody();for(C=h[v?"startContainer":"endContainer"],l=h[v?"startOffset":"endOffset"],1==C.nodeType&&(C=C.childNodes[Math.min(l,C.childNodes.length-1)]||C);C.parentNode!=y;){if(q(C)){return C}if(/^(TD|TH)$/.test(C.parentNode.nodeName)){return C}C=C.parentNode}return C}function u(v,r){var y,l=[];if(!q(v)){for(;v&&(y=v[r?"previousSibling":"nextSibling"],!K.isBlock(y)&&y);){v=y}for(;v;){l.push(v),v=v[r?"nextSibling":"previousSibling"]}}return l}var o,s,m=p(!0),c=p();s=u(m,!0),m!=c&&(s=s.concat(u(c).reverse())),tinymce.each(s,function(l){if(!K.isBlock(l)||"BR"==l.nodeName){if(!o||"BR"==l.nodeName){if("BR"==l.nodeName&&(!l.nextSibling||K.isBlock(l.nextSibling)&&"BR"!=l.nextSibling.nodeName)){return K.remove(l),!1}o=K.create("p"),i.push(o),l.parentNode.insertBefore(o,l)}return"BR"!=l.nodeName?o.appendChild(l):K.remove(l),l==c?!1:void 0}})}var h=t.getRng(!0),d=A(h),i=I();f(),tinymce.each(i,function(l){var m,c;c=l.previousSibling,c&&w(c)&&c.nodeName==g?(m=c,l=K.rename(l,"LI"),c.appendChild(l)):(m=K.create(g),l.parentNode.insertBefore(m,l),m.appendChild(l),l=K.rename(l,"LI")),B(m)}),E(d)}function j(){var c=A(t.getRng(!0));tinymce.each(J(),function(f){var d,g;for(d=f;d;d=d.parentNode){w(d)&&(g=d)}k(g,f)}),E(c)}function e(f){var c=K.getParent(t.getStart(),"OL,UL");if(c){if(c.nodeName==f){j(f)}else{var d=A(t.getRng(!0));B(K.rename(c,f)),E(d)}}else{G(f)}}var K=b.dom,t=b.selection;a.backspaceDelete=function(i){function g(p,l){var s=p.startContainer,c=p.startOffset;if(3==s.nodeType&&(l?c<s.data.length:c>0)){return s}for(var o=new tinymce.dom.TreeWalker(p.startContainer);s=o[l?"next":"prev"]();){if(3==s.nodeType&&s.data.length>0){return s}}}function f(p,o){var r,l,c=p.parentNode;for(w(o.lastChild)&&(l=o.lastChild),r=o.lastChild,r&&"BR"==r.nodeName&&p.hasChildNodes()&&K.remove(r);r=p.firstChild;){o.appendChild(r)}l&&o.appendChild(l),K.remove(p),K.isEmpty(c)&&K.remove(c)}if(t.isCollapsed()){var m=K.getParent(t.getStart(),"LI");if(m){var h=t.getRng(!0),d=K.getParent(g(h,i),"LI");if(d&&d!=m){var n=A(h);return i?f(d,m):f(m,d),E(n),!0}if(!d&&!i&&j(m.parentNode.nodeName)){return !0}}}},b.addCommand("Indent",function(){return x()?void 0:!0}),b.addCommand("Outdent",function(){return F()?void 0:!0}),b.addCommand("InsertUnorderedList",function(){e("UL")}),b.addCommand("InsertOrderedList",function(){e("OL")})}),b.on("keydown",function(c){c.keyCode==tinymce.util.VK.BACKSPACE?a.backspaceDelete()&&c.preventDefault():c.keyCode==tinymce.util.VK.DELETE&&a.backspaceDelete(!0)&&c.preventDefault()})});