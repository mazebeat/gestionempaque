tinymce.PluginManager.add("visualchars",function(c){function b(m){var g,k,e,f,h,p,j=c.getBody(),i=c.selection;if(a=!a,c.fire("VisualChars",{state:a}),m&&(p=i.getBookmark()),a){for(k=[],tinymce.walk(j,function(l){3==l.nodeType&&l.nodeValue&&-1!=l.nodeValue.indexOf("Â ")&&k.push(l)},"childNodes"),e=0;e<k.length;e++){for(f=k[e].nodeValue,f=f.replace(/(\u00a0)/g,'<span data-mce-bogus="1" class="mce-nbsp">$1</span>'),h=c.dom.create("div",null,f);g=h.lastChild;){c.dom.insertAfter(g,k[e])}c.dom.remove(k[e])}}else{for(k=c.dom.select("span.mce-nbsp",j),e=k.length-1;e>=0;e--){c.dom.remove(k[e],1)}}i.moveToBookmark(p)}function d(){var e=this;c.on("VisualChars",function(f){e.active(f.state)})}var a;c.addCommand("mceVisualChars",b),c.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:d}),c.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:d,selectable:!0,context:"view",prependToContext:!0}),c.on("beforegetcontent",function(f){a&&"raw"!=f.format&&!f.draft&&(a=!0,b(!1))})});