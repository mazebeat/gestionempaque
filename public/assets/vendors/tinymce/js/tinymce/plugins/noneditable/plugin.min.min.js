tinymce.PluginManager.add("noneditable",function(j){function p(){function C(i){var a;if(1===i.nodeType){if(a=i.getAttribute(q),a&&"inherit"!==a){return a}if(a=i.contentEditable,"inherit"!==a){return a}}return null}function r(a){for(var i;a;){if(i=C(a)){return"false"===i?a:null}a=a.parentNode}}function w(a){for(;a;){if(a.id===x){return a}a=a.parentNode}}function e(i){var a;if(i){for(a=new b(i,i),i=a.current();i;i=a.next()){if(3===i.nodeType){return i}}}}function A(D,t){var u,l;return"false"===C(D)&&s.isBlock(D)?(y.select(D),void 0):(l=s.createRng(),"true"===C(D)&&(D.firstChild||D.appendChild(j.getDoc().createTextNode("Â ")),D=D.firstChild,t=!0),u=s.create("span",{id:x,"data-mce-bogus":!0},c),t?D.parentNode.insertBefore(u,D):s.insertAfter(u,D),l.setStart(u.firstChild,1),l.collapse(!0),y.setRng(l),u)}function v(u){var l,D,i,o;if(u){l=y.getRng(!0),l.setStartBefore(u),l.setEndBefore(u),D=e(u),D&&D.nodeValue.charAt(0)==c&&(D=D.deleteData(0,1)),s.remove(u,!0),y.setRng(l)}else{for(i=w(y.getStart());(u=s.get(x))&&u!==o;){i!==u&&(D=e(u),D&&D.nodeValue.charAt(0)==c&&(D=D.deleteData(0,1)),s.remove(u,!0)),o=u}}}function z(){function n(I,L){var G,K,F,E,H;if(G=D.startContainer,K=D.startOffset,3==G.nodeType){if(H=G.nodeValue.length,K>0&&H>K||(L?K==H:0===K)){return}}else{if(!(K<G.childNodes.length)){return L?null:I}var J=!L&&K>0?K-1:K;G=G.childNodes[J],G.hasChildNodes()&&(G=G.firstChild)}for(F=new b(G,I);E=F[L?"prev":"next"]();){if(3===E.nodeType&&E.nodeValue.length>0){return}if("true"===C(E)){return E}}return I}var a,u,l,D,t;v(),l=y.isCollapsed(),a=r(y.getStart()),u=r(y.getEnd()),(a||u)&&(D=y.getRng(!0),l?(a=a||u,(t=n(a,!0))?A(t,!0):(t=n(a,!1))?A(t,!1):y.select(a)):(D=y.getRng(!0),a&&D.setStartBefore(a),u&&D.setEndAfter(u),y.setRng(D)))}function B(n){function H(o,a){for(;o=o[a?"previousSibling":"nextSibling"];){if(3!==o.nodeType||o.nodeValue.length>0){return o}}}function L(o,a){y.select(o),y.collapse(a)}function K(R){function N(o){for(var a=P;a;){if(a===o){return}a=a.parentNode}s.remove(o),z()}function Q(){var o,u,a=j.schema.getNonEmptyElements();for(u=new tinymce.dom.TreeWalker(P,j.getBody());(o=R?u.prev():u.next())&&!a[o.nodeName.toLowerCase()]&&!(3===o.nodeType&&tinymce.trim(o.nodeValue).length>0);){if("false"===C(o)){return N(o),!0}}return r(o)?!0:!1}var M,P,S,O;if(y.isCollapsed()){if(M=y.getRng(!0),P=M.startContainer,S=M.startOffset,P=w(P)||P,O=r(P)){return N(O),!1}if(3==P.nodeType&&(R?S>0:S<P.nodeValue.length)){return !0}if(1==P.nodeType&&(P=P.childNodes[S]||P),Q()){return !1}}return !0}var D,l,t,F,J=n.keyCode;if(t=y.getStart(),F=y.getEnd(),D=r(t)||r(F),D&&(112>J||J>124)&&J!=k.DELETE&&J!=k.BACKSPACE){if((tinymce.isMac?n.metaKey:n.ctrlKey)&&(67==J||88==J||86==J)){return}if(n.preventDefault(),J==k.LEFT||J==k.RIGHT){var E=J==k.LEFT;if(j.dom.isBlock(D)){var G=E?D.previousSibling:D.nextSibling,I=new b(G,G),i=E?I.prev():I.next();L(i,!E)}else{L(D,E)}}}else{if(J==k.LEFT||J==k.RIGHT||J==k.BACKSPACE||J==k.DELETE){if(l=w(t)){if(J==k.LEFT||J==k.BACKSPACE){if(D=H(l,!0),D&&"false"===C(D)){if(n.preventDefault(),J!=k.LEFT){return s.remove(D),void 0}L(D,!0)}else{v(l)}}if(J==k.RIGHT||J==k.DELETE){if(D=H(l),D&&"false"===C(D)){if(n.preventDefault(),J!=k.RIGHT){return s.remove(D),void 0}L(D,!1)}else{v(l)}}}if((J==k.BACKSPACE||J==k.DELETE)&&!K(J==k.BACKSPACE)){return n.preventDefault(),!1}}}}var s=j.dom,y=j.selection,x="mce_noneditablecaret",c="";j.on("mousedown",function(l){var a=j.selection.getNode();"false"===C(a)&&a==l.target&&z()}),j.on("mouseup keyup",z),j.on("keydown",B)}function f(c){var l=m.length,a=c.content,e=tinymce.trim(d);if("raw"!=c.format){for(;l--;){a=a.replace(m[l],function(i){var s=arguments,r=s[s.length-2];return r>0&&'"'==a.charAt(r-1)?i:'<span class="'+e+'" data-mce-content="'+j.dom.encode(s[0])+'">'+j.dom.encode("string"==typeof s[1]?s[1]:s[0])+"</span>"})}c.content=a}}var h,d,m,b=tinymce.dom.TreeWalker,g="contenteditable",q="data-mce-"+g,k=tinymce.util.VK;h=" "+tinymce.trim(j.getParam("noneditable_editable_class","mceEditable"))+" ",d=" "+tinymce.trim(j.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",m=j.getParam("noneditable_regexp"),m&&!m.length&&(m=[m]),j.on("PreInit",function(){p(),m&&j.on("BeforeSetContent",f),j.parser.addAttributeFilter("class",function(l){for(var i,o,c=l.length;c--;){o=l[c],i=" "+o.attr("class")+" ",-1!==i.indexOf(h)?o.attr(q,"true"):-1!==i.indexOf(d)&&o.attr(q,"false")}}),j.serializer.addAttributeFilter(q,function(c){for(var a,i=c.length;i--;){a=c[i],m&&a.attr("data-mce-content")?(a.name="#text",a.type=3,a.raw=!0,a.value=a.attr("data-mce-content")):(a.attr(g,null),a.attr(q,null))}}),j.parser.addAttributeFilter(g,function(c){for(var a,i=c.length;i--;){a=c[i],a.attr(q,a.attr(g)),a.attr(g,null)}})})});