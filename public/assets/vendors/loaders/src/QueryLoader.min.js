function QueryLoader2(b,a){this.element=b;this.$element=$(b);this.options=a;this.foundUrls=[];this.destroyed=false;this.imageCounter=0;this.imageDone=0;this.alreadyLoaded=false;this.preloadContainer=new PreloadContainer(this);this.overlayLoader=new OverlayLoader(this);this.defaultOptions={onComplete:function(){},onLoadComplete:function(){},backgroundColor:"#000",barColor:"#fff",overlayId:"qLoverlay",barHeight:1,percentage:false,deepSearch:true,completeAnimation:"fade",minimumTime:500};this.init()}QueryLoader2.prototype.init=function(){console.log("Initialising QueryLoader2 for",this.element);console.log("Setting the options");this.options=$.extend({},this.defaultOptions,this.options);console.log("Looking for images in",this.element);var a=this.findImageInElement(this.element);if(this.options.deepSearch==true){console.log("Deep searching for images in",this.element);var c=this.$element.find("*:not(script)");for(var b=0;b<c.length;b++){this.findImageInElement(c[b])}}this.preloadContainer.create();this.overlayLoader.createOverlay()};QueryLoader2.prototype.findImageInElement=function(d){var b="";var h=$(d);var e="normal";if(h.css("background-image")!="none"){b=h.css("background-image");e="background"}else{if(typeof(h.attr("src"))!="undefined"&&d.nodeName.toLowerCase()=="img"){b=h.attr("src")}}if(!this.hasGradient(b)){b=this.stripUrl(b);var g=b.split(", ");for(var c=0;c<g.length;c++){if(this.validUrl(g[c])&&this.urlIsNew(g[c])){console.log("Found "+g[c]);var a="";if(this.isIE()||this.isOpera()){a="?rand="+Math.random();this.preloadContainer.addImage(g[c]+a)}else{if(e=="background"){this.preloadContainer.addImage(g[c]+a)}else{var f=new PreloadImage(this);f.element=h;f.bindLoadEvent()}}this.foundUrls.push(g[c])}}}};QueryLoader2.prototype.hasGradient=function(a){if(a.indexOf("gradient")==-1){return false}else{return true}};QueryLoader2.prototype.stripUrl=function(a){a=a.replace(/url\(\"/g,"");a=a.replace(/url\(/g,"");a=a.replace(/\"\)/g,"");a=a.replace(/\)/g,"");return a};QueryLoader2.prototype.isIE=function(){return navigator.userAgent.match(/msie/i)};QueryLoader2.prototype.isOpera=function(){return navigator.userAgent.match(/Opera/i)};QueryLoader2.prototype.validUrl=function(a){if(a.length>0&&!a.match(/^(data:)/i)){return true}else{return false}};QueryLoader2.prototype.urlIsNew=function(a){if(this.foundUrls.indexOf(a)==-1){return true}else{return false}};QueryLoader2.prototype.destroyContainers=function(){this.destroyed=true;this.preloadContainer.container.remove();this.overlayLoader.container.remove()};QueryLoader2.prototype.endLoader=function(){console.log("Done preloading");this.destroyed=true;this.onLoadComplete()};QueryLoader2.prototype.onLoadComplete=function(){this.options.onLoadComplete();if(this.options.completeAnimation=="grow"){var a=this.options.minimumTime;this.overlayLoader.loadbar[0].parent=this;this.overlayLoader.loadbar.stop().animate({width:"100%"},a,function(){$(this).animate({top:"0%",width:"100%",height:"100%"},500,function(){this.parent.overlayLoader.container[0].parent=this.parent;this.parent.overlayLoader.container.fadeOut(500,function(){this.parent.destroyContainers();this.parent.options.onComplete()})})})}else{var a=this.options.minimumTime;this.overlayLoader.container[0].parent=this;this.overlayLoader.container.fadeOut(a,function(){this.parent.destroyContainers();this.parent.options.onComplete()})}};