(function(){chai.should();describe("Dropzone",function(){var b,a;b=function(){return{status:Dropzone.ADDED,accepted:true,name:"test file name",size:123456,type:"text/html"}};a=null;beforeEach(function(){return a=sinon.useFakeXMLHttpRequest()});describe("static functions",function(){describe("Dropzone.createElement()",function(){var c;c=Dropzone.createElement('<div class="test"><span>Hallo</span></div>');it("should properly create an element from a string",function(){return c.tagName.should.equal("DIV")});it("should properly add the correct class",function(){return c.classList.contains("test").should.be.ok});it("should properly create child elements",function(){return c.querySelector("span").tagName.should.equal("SPAN")});return it("should always return only one element",function(){c=Dropzone.createElement("<div></div><span></span>");return c.tagName.should.equal("DIV")})});describe("Dropzone.elementInside()",function(){var e,d,c;c=Dropzone.createElement('<div id="test"><div class="child1"><div class="child2"></div></div></div>');document.body.appendChild(c);e=c.querySelector(".child1");d=c.querySelector(".child2");after(function(){return document.body.removeChild(c)});it("should return yes if elements are the same",function(){return Dropzone.elementInside(c,c).should.be.ok});it("should return yes if element is direct child",function(){return Dropzone.elementInside(e,c).should.be.ok});it("should return yes if element is some child",function(){Dropzone.elementInside(d,c).should.be.ok;return Dropzone.elementInside(d,document.body).should.be.ok});return it("should return no unless element is some child",function(){Dropzone.elementInside(c,e).should.not.be.ok;return Dropzone.elementInside(document.body,e).should.not.be.ok})});describe("Dropzone.optionsForElement()",function(){var c,d;d={url:"/some/url",method:"put"};before(function(){return Dropzone.options.testElement=d});after(function(){return delete Dropzone.options.testElement});c=document.createElement("div");it("should take options set in Dropzone.options from camelized id",function(){c.id="test-element";return Dropzone.optionsForElement(c).should.equal(d)});it("should return undefined if no options set",function(){c.id="test-element2";return expect(Dropzone.optionsForElement(c)).to.equal(void 0)});it("should return undefined and not throw if it's a form with an input element of the name 'id'",function(){c=Dropzone.createElement('<form><input name="id" /</form>');return expect(Dropzone.optionsForElement(c)).to.equal(void 0)});return it("should ignore input fields with the name='id'",function(){c=Dropzone.createElement('<form id="test-element"><input type="hidden" name="id" value="fooo" /></form>');return Dropzone.optionsForElement(c).should.equal(d)})});describe("Dropzone.forElement()",function(){var c,d;d=document.createElement("div");d.id="some-test-element";c=null;before(function(){document.body.appendChild(d);return c=new Dropzone(d,{url:"/test"})});after(function(){c.disable();return document.body.removeChild(d)});it("should throw an exception if no dropzone attached",function(){return expect(function(){return Dropzone.forElement(document.createElement("div"))}).to["throw"]("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.")});it("should accept css selectors",function(){return expect(Dropzone.forElement("#some-test-element")).to.equal(c)});return it("should accept native elements",function(){return expect(Dropzone.forElement(d)).to.equal(c)})});describe("Dropzone.discover()",function(){var e,d,c;e=document.createElement("div");e.className="dropzone";d=e.cloneNode();c=e.cloneNode();e.id="test-element-1";d.id="test-element-2";c.id="test-element-3";describe("specific options",function(){before(function(){Dropzone.options.testElement1={url:"test-url"};Dropzone.options.testElement2=false;document.body.appendChild(e);document.body.appendChild(d);return Dropzone.discover()});after(function(){document.body.removeChild(e);return document.body.removeChild(d)});it("should find elements with a .dropzone class",function(){return e.dropzone.should.be.ok});return it("should not create dropzones with disabled options",function(){return expect(d.dropzone).to.not.be.ok})});return describe("Dropzone.autoDiscover",function(){before(function(){Dropzone.options.testElement3={url:"test-url"};return document.body.appendChild(c)});after(function(){return document.body.removeChild(c)});it("should create dropzones even if Dropzone.autoDiscover == false",function(){Dropzone.autoDiscover=false;Dropzone.discover();return expect(c.dropzone).to.be.ok});return it("should not automatically be called if Dropzone.autoDiscover == false",function(){Dropzone.autoDiscover=false;Dropzone.discover=function(){return expect(false).to.be.ok};return Dropzone._autoDiscoverFunction()})})});describe("Dropzone.isValidFile()",function(){it("should return true if called without acceptedFiles",function(){return Dropzone.isValidFile({type:"some/type"},null).should.be.ok});it("should properly validate if called with concrete mime types",function(){var c;c="text/html,image/jpeg,application/json";Dropzone.isValidFile({type:"text/html"},c).should.be.ok;Dropzone.isValidFile({type:"image/jpeg"},c).should.be.ok;Dropzone.isValidFile({type:"application/json"},c).should.be.ok;return Dropzone.isValidFile({type:"image/bmp"},c).should.not.be.ok});it("should properly validate if called with base mime types",function(){var c;c="text/*,image/*,application/*";Dropzone.isValidFile({type:"text/html"},c).should.be.ok;Dropzone.isValidFile({type:"image/jpeg"},c).should.be.ok;Dropzone.isValidFile({type:"application/json"},c).should.be.ok;Dropzone.isValidFile({type:"image/bmp"},c).should.be.ok;return Dropzone.isValidFile({type:"some/type"},c).should.not.be.ok});it("should properly validate if called with mixed mime types",function(){var c;c="text/*,image/jpeg,application/*";Dropzone.isValidFile({type:"text/html"},c).should.be.ok;Dropzone.isValidFile({type:"image/jpeg"},c).should.be.ok;Dropzone.isValidFile({type:"image/bmp"},c).should.not.be.ok;Dropzone.isValidFile({type:"application/json"},c).should.be.ok;return Dropzone.isValidFile({type:"some/type"},c).should.not.be.ok});it("should properly validate even with spaces in between",function(){var c;c="text/html ,   image/jpeg, application/json";Dropzone.isValidFile({type:"text/html"},c).should.be.ok;return Dropzone.isValidFile({type:"image/jpeg"},c).should.be.ok});return it("should properly validate extensions",function(){var c;c="text/html ,    image/jpeg, .pdf  ,.png";Dropzone.isValidFile({name:"somxsfsd",type:"text/html"},c).should.be.ok;Dropzone.isValidFile({name:"somesdfsdf",type:"image/jpeg"},c).should.be.ok;Dropzone.isValidFile({name:"somesdfadfadf",type:"application/json"},c).should.not.be.ok;Dropzone.isValidFile({name:"some-file file.pdf",type:"random/type"},c).should.be.ok;Dropzone.isValidFile({name:"some-file.pdf file.gif",type:"random/type"},c).should.not.be.ok;return Dropzone.isValidFile({name:"some-file file.png",type:"random/type"},c).should.be.ok})});return describe("Dropzone.confirm",function(){beforeEach(function(){return sinon.stub(window,"confirm")});afterEach(function(){return window.confirm.restore()});it("should forward to window.confirm and call the callbacks accordingly",function(){var d,c;d=c=false;window.confirm.returns(true);Dropzone.confirm("test question",(function(){return d=true}),(function(){return c=true}));window.confirm.args[0][0].should.equal("test question");d.should.equal(true);c.should.equal(false);d=c=false;window.confirm.returns(false);Dropzone.confirm("test question 2",(function(){return d=true}),(function(){return c=true}));window.confirm.args[1][0].should.equal("test question 2");d.should.equal(false);return c.should.equal(true)});return it("should not error if rejected is not provided",function(){var d,c;d=c=false;window.confirm.returns(false);Dropzone.confirm("test question",(function(){return d=true}));window.confirm.args[0][0].should.equal("test question");d.should.equal(false);return c.should.equal(false)})})});describe("Dropzone.getElement() / getElements()",function(){var c;c=[];beforeEach(function(){c=[];c.push(Dropzone.createElement('<div class="tmptest"></div>'));c.push(Dropzone.createElement('<div id="tmptest1" class="random"></div>'));c.push(Dropzone.createElement('<div class="random div"></div>'));return c.forEach(function(d){return document.body.appendChild(d)})});afterEach(function(){return c.forEach(function(d){return document.body.removeChild(d)})});describe(".getElement()",function(){it("should accept a string",function(){var d;d=Dropzone.getElement(".tmptest");d.should.equal(c[0]);d=Dropzone.getElement("#tmptest1");return d.should.equal(c[1])});it("should accept a node",function(){var d;d=Dropzone.getElement(c[2]);return d.should.equal(c[2])});return it("should fail if invalid selector",function(){var d;d="Invalid `clickable` option provided. Please provide a CSS selector or a plain HTML element.";expect(function(){return Dropzone.getElement("lblasdlfsfl","clickable")}).to["throw"](d);expect(function(){return Dropzone.getElement({lblasdlfsfl:"lblasdlfsfl"},"clickable")}).to["throw"](d);return expect(function(){return Dropzone.getElement(["lblasdlfsfl"],"clickable")}).to["throw"](d)})});return describe(".getElements()",function(){it("should accept a list of strings",function(){var d;d=Dropzone.getElements([".tmptest","#tmptest1"]);return d.should.eql([c[0],c[1]])});it("should accept a list of nodes",function(){var d;d=Dropzone.getElements([c[0],c[2]]);return d.should.eql([c[0],c[2]])});it("should accept a mixed list",function(){var d;d=Dropzone.getElements(["#tmptest1",c[2]]);return d.should.eql([c[1],c[2]])});it("should accept a string selector",function(){var d;d=Dropzone.getElements(".random");return d.should.eql([c[1],c[2]])});it("should accept a single node",function(){var d;d=Dropzone.getElements(c[1]);return d.should.eql([c[1]])});return it("should fail if invalid selector",function(){var d;d="Invalid `clickable` option provided. Please provide a CSS selector, a plain HTML element or a list of those.";expect(function(){return Dropzone.getElements("lblasdlfsfl","clickable")}).to["throw"](d);return expect(function(){return Dropzone.getElements(["lblasdlfsfl"],"clickable")}).to["throw"](d)})})});describe("constructor()",function(){var c;c=null;afterEach(function(){if(c!=null){return c.destroy()}});it("should throw an exception if the element is invalid",function(){return expect(function(){return c=new Dropzone("#invalid-element")}).to["throw"]("Invalid dropzone element.")});it("should throw an exception if assigned twice to the same element",function(){var d;d=document.createElement("div");c=new Dropzone(d,{url:"url"});return expect(function(){return new Dropzone(d,{url:"url"})}).to["throw"]("Dropzone already attached.")});it("should throw an exception if both acceptedFiles and acceptedMimeTypes are specified",function(){var d;d=document.createElement("div");return expect(function(){return c=new Dropzone(d,{url:"test",acceptedFiles:"param",acceptedMimeTypes:"types"})}).to["throw"]("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.")});it("should set itself as element.dropzone",function(){var d;d=document.createElement("div");c=new Dropzone(d,{url:"url"});return d.dropzone.should.equal(c)});it("should add itself to Dropzone.instances",function(){var d;d=document.createElement("div");c=new Dropzone(d,{url:"url"});return Dropzone.instances[Dropzone.instances.length-1].should.equal(c)});it("should use the action attribute not the element with the name action",function(){var d;d=Dropzone.createElement('<form action="real-action"><input type="hidden" name="action" value="wrong-action" /></form>');c=new Dropzone(d);return c.options.url.should.equal("real-action")});return describe("options",function(){var d,e;d=null;e=null;beforeEach(function(){d=document.createElement("div");d.id="test-element";e=document.createElement("div");e.id="test-element2";return Dropzone.options.testElement={url:"/some/url",parallelUploads:10}});afterEach(function(){return delete Dropzone.options.testElement});it("should take the options set in Dropzone.options",function(){c=new Dropzone(d);c.options.url.should.equal("/some/url");return c.options.parallelUploads.should.equal(10)});it("should prefer passed options over Dropzone.options",function(){c=new Dropzone(d,{url:"/some/other/url"});return c.options.url.should.equal("/some/other/url")});it("should take the default options if nothing set in Dropzone.options",function(){c=new Dropzone(e,{url:"/some/url"});return c.options.parallelUploads.should.equal(2)});it("should call the fallback function if forceFallback == true",function(f){return c=new Dropzone(d,{url:"/some/other/url",forceFallback:true,fallback:function(){return f()}})});it("should set acceptedFiles if deprecated acceptedMimetypes option has been passed",function(){c=new Dropzone(d,{url:"/some/other/url",acceptedMimeTypes:"my/type"});return c.options.acceptedFiles.should.equal("my/type")});return describe("options.clickable",function(){var f;f=null;c=null;beforeEach(function(){f=document.createElement("div");f.className="some-clickable";return document.body.appendChild(f)});afterEach(function(){document.body.removeChild(f);if(c!=null){return c.destroy}});it("should use the default element if clickable == true",function(){c=new Dropzone(d,{clickable:true});return c.clickableElements.should.eql([c.element])});it("should lookup the element if clickable is a CSS selector",function(){c=new Dropzone(d,{clickable:".some-clickable"});return c.clickableElements.should.eql([f])});it("should simply use the provided element",function(){c=new Dropzone(d,{clickable:f});return c.clickableElements.should.eql([f])});it("should accept multiple clickable elements",function(){c=new Dropzone(d,{clickable:[document.body,".some-clickable"]});return c.clickableElements.should.eql([document.body,f])});return it("should throw an exception if the element is invalid",function(){return expect(function(){return c=new Dropzone(d,{clickable:".some-invalid-clickable"})}).to["throw"]("Invalid `clickable` option provided. Please provide a CSS selector, a plain HTML element or a list of those.")})})})});describe("init()",function(){describe("clickable",function(){var d,f,e,c;f={"using acceptedFiles":new Dropzone(Dropzone.createElement('<form action="/"></form>'),{clickable:true,acceptedFiles:"audio/*,video/*"}),"using acceptedMimeTypes":new Dropzone(Dropzone.createElement('<form action="/"></form>'),{clickable:true,acceptedMimeTypes:"audio/*,video/*"})};it("should not add an accept attribute if no acceptParameter",function(){var g;g=new Dropzone(Dropzone.createElement('<form action="/"></form>'),{clickable:true,acceptParameter:null,acceptedMimeTypes:null});return g.hiddenFileInput.hasAttribute("accept").should.be["false"]});c=[];for(e in f){d=f[e];c.push(describe(e,function(){return(function(g){it("should create a hidden file input if clickable",function(){g.hiddenFileInput.should.be.ok;return g.hiddenFileInput.tagName.should.equal("INPUT")});it("should use the acceptParameter",function(){return g.hiddenFileInput.getAttribute("accept").should.equal("audio/*,video/*")});return it("should create a new input element when something is selected to reset the input field",function(){var l,k,j,m,h;h=[];for(j=m=0;m<=3;j=++m){k=g.hiddenFileInput;l=document.createEvent("HTMLEvents");l.initEvent("change",true,true);k.dispatchEvent(l);g.hiddenFileInput.should.not.equal(k);h.push(Dropzone.elementInside(k,document).should.not.be.ok)}return h})})(d)}))}return c});it("should create a .dz-message element",function(){var c,d;d=Dropzone.createElement('<form class="dropzone" action="/"></form>');c=new Dropzone(d,{clickable:true,acceptParameter:null,acceptedMimeTypes:null});return d.querySelector(".dz-message").should.be["instanceof"](Element)});return it("should not create a .dz-message element if there already is one",function(){var c,d,e;d=Dropzone.createElement('<form class="dropzone" action="/"></form>');e=Dropzone.createElement('<div class="dz-message">TEST</div>');d.appendChild(e);c=new Dropzone(d,{clickable:true,acceptParameter:null,acceptedMimeTypes:null});d.querySelector(".dz-message").should.equal(e);return d.querySelectorAll(".dz-message").length.should.equal(1)})});describe("options",function(){var c,d;d=null;c=null;beforeEach(function(){d=Dropzone.createElement("<div></div>");return c=new Dropzone(d,{maxFilesize:4,url:"url",acceptedMimeTypes:"audio/*,image/png",maxFiles:3})});return describe("file specific",function(){var e;e=null;beforeEach(function(){e={name:"test name",size:2*1024*1024,width:200,height:100};return c.options.addedfile.call(c,e)});describe(".addedFile()",function(){return it("should properly create the previewElement",function(){e.previewElement.should.be["instanceof"](Element);e.previewElement.querySelector("[data-dz-name]").innerHTML.should.eql("test name");return e.previewElement.querySelector("[data-dz-size]").innerHTML.should.eql("<strong>2</strong> MiB")})});describe(".error()",function(){it("should properly insert the error",function(){c.options.error.call(c,e,"test message");return e.previewElement.querySelector("[data-dz-errormessage]").innerHTML.should.eql("test message")});return it("should properly insert the error when provided with an object containing the error",function(){c.options.error.call(c,e,{error:"test message"});return e.previewElement.querySelector("[data-dz-errormessage]").innerHTML.should.eql("test message")})});describe(".thumbnail()",function(){return it("should properly insert the error",function(){var g,f;f="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";c.options.thumbnail.call(c,e,f);g=e.previewElement.querySelector("[data-dz-thumbnail]");g.src.should.eql(f);return g.alt.should.eql("test name")})});describe(".uploadprogress()",function(){return it("should properly set the width",function(){c.options.uploadprogress.call(c,e,0);e.previewElement.querySelector("[data-dz-uploadprogress]").style.width.should.eql("0%");c.options.uploadprogress.call(c,e,80);e.previewElement.querySelector("[data-dz-uploadprogress]").style.width.should.eql("80%");c.options.uploadprogress.call(c,e,90);e.previewElement.querySelector("[data-dz-uploadprogress]").style.width.should.eql("90%");c.options.uploadprogress.call(c,e,100);return e.previewElement.querySelector("[data-dz-uploadprogress]").style.width.should.eql("100%")})});return describe(".resize()",function(){describe("with default thumbnail settings",function(){return it("should properly return target dimensions",function(){var f;f=c.options.resize.call(c,e);f.optWidth.should.eql(100);return f.optHeight.should.eql(100)})});return describe("with null thumbnail settings",function(){return it("should properly return target dimensions",function(){var j,m,k,f,l,h,g;f=[[null,null],[null,150],[150,null]];g=[];for(j=l=0,h=f.length;l<h;j=++l){k=f[j];c.options.thumbnailWidth=k[0];c.options.thumbnailHeight=k[1];m=c.options.resize.call(c,e);if(j===0){m.optWidth.should.eql(200);m.optHeight.should.eql(100)}if(j===1){m.optWidth.should.eql(300);m.optHeight.should.eql(150)}if(j===2){m.optWidth.should.eql(150);g.push(m.optHeight.should.eql(75))}else{g.push(void 0)}}return g})})})})});describe("instance",function(){var c,d,e;d=null;c=null;e=null;beforeEach(function(){e=[];a.onCreate=function(f){return e.push(f)};d=Dropzone.createElement("<div></div>");document.body.appendChild(d);return c=new Dropzone(d,{maxFilesize:4,maxFiles:100,url:"url",acceptedMimeTypes:"audio/*,image/png",uploadprogress:function(){}})});afterEach(function(){document.body.removeChild(d);c.destroy();return a.restore()});describe(".accept()",function(){it("should pass if the filesize is OK",function(){return c.accept({size:2*1024*1024,type:"audio/mp3"},function(f){return expect(f).to.be.undefined})});it("shouldn't pass if the filesize is too big",function(){return c.accept({size:10*1024*1024,type:"audio/mp3"},function(f){return f.should.eql("File is too big (10MiB). Max filesize: 4MiB.")})});it("should properly accept files which mime types are listed in acceptedFiles",function(){c.accept({type:"audio/mp3"},function(f){return expect(f).to.be.undefined});c.accept({type:"image/png"},function(f){return expect(f).to.be.undefined});return c.accept({type:"audio/wav"},function(f){return expect(f).to.be.undefined})});it("should properly reject files when the mime type isn't listed in acceptedFiles",function(){return c.accept({type:"image/jpeg"},function(f){return f.should.eql("You can't upload files of this type.")})});it("should fail if maxFiles has been exceeded and call the event maxfilesexceeded",function(){var g,f;sinon.stub(c,"getAcceptedFiles");f={type:"audio/mp3"};c.getAcceptedFiles.returns({length:99});c.options.dictMaxFilesExceeded="You can only upload {{maxFiles}} files.";g=false;c.on("maxfilesexceeded",function(h){h.should.equal(f);return g=true});c.accept(f,function(h){return expect(h).to.be.undefined});g.should.not.be.ok;c.getAcceptedFiles.returns({length:100});c.accept(f,function(h){return expect(h).to.equal("You can only upload 100 files.")});g.should.be.ok;return c.getAcceptedFiles.restore()});return it("should properly handle if maxFiles is 0",function(){var g,f;f={type:"audio/mp3"};c.options.maxFiles=0;g=false;c.on("maxfilesexceeded",function(h){h.should.equal(f);return g=true});c.accept(f,function(h){return expect(h).to.equal("You can not upload any more files.")});return g.should.be.ok})});describe(".removeFile()",function(){return it("should abort uploading if file is currently being uploaded",function(f){var g;g=b();c.uploadFile=function(h){};c.accept=function(i,h){return h()};sinon.stub(c,"cancelUpload");c.addFile(g);return setTimeout(function(){g.status.should.equal(Dropzone.UPLOADING);c.getUploadingFiles()[0].should.equal(g);c.cancelUpload.callCount.should.equal(0);c.removeFile(g);c.cancelUpload.callCount.should.equal(1);return f()},10)})});describe(".cancelUpload()",function(){it("should properly cancel upload if file currently uploading",function(f){var g;g=b();c.accept=function(i,h){return h()};c.addFile(g);return setTimeout(function(){g.status.should.equal(Dropzone.UPLOADING);c.getUploadingFiles()[0].should.equal(g);c.cancelUpload(g);g.status.should.equal(Dropzone.CANCELED);c.getUploadingFiles().length.should.equal(0);c.getQueuedFiles().length.should.equal(0);return f()},10)});it("should properly cancel the upload if file is not yet uploading",function(){var f;f=b();c.accept=function(h,g){return g()};c.options.parallelUploads=0;c.addFile(f);f.status.should.equal(Dropzone.QUEUED);c.getQueuedFiles()[0].should.equal(f);c.cancelUpload(f);f.status.should.equal(Dropzone.CANCELED);c.getQueuedFiles().length.should.equal(0);return c.getUploadingFiles().length.should.equal(0)});it("should call processQueue()",function(f){var g;g=b();c.accept=function(i,h){return h()};c.options.parallelUploads=0;sinon.spy(c,"processQueue");c.addFile(g);return setTimeout(function(){c.processQueue.callCount.should.equal(1);c.cancelUpload(g);c.processQueue.callCount.should.equal(2);return f()},10)});return it("should properly cancel all files with the same XHR if uploadMultiple is true",function(h){var g,f,i;g=b();f=b();i=b();c.accept=function(k,j){return j()};c.options.uploadMultiple=true;c.options.parallelUploads=3;sinon.spy(c,"processFiles");c.addFile(g);c.addFile(f);c.addFile(i);return setTimeout(function(){var j;c.processFiles.callCount.should.equal(1);sinon.spy(g.xhr,"abort");c.cancelUpload(g);expect((g.xhr===(j=f.xhr)&&j===i.xhr)).to.be.ok;g.status.should.equal(Dropzone.CANCELED);f.status.should.equal(Dropzone.CANCELED);i.status.should.equal(Dropzone.CANCELED);g.xhr.abort.callCount.should.equal(1);return h()},10)})});describe(".disable()",function(){return it("should properly cancel all pending uploads",function(f){c.accept=function(h,g){return g()};c.options.parallelUploads=1;c.addFile(b());c.addFile(b());return setTimeout(function(){c.getUploadingFiles().length.should.equal(1);c.getQueuedFiles().length.should.equal(1);c.files.length.should.equal(2);sinon.spy(e[0],"abort");e[0].abort.callCount.should.equal(0);c.disable();e[0].abort.callCount.should.equal(1);c.getUploadingFiles().length.should.equal(0);c.getQueuedFiles().length.should.equal(0);c.files.length.should.equal(2);c.files[0].status.should.equal(Dropzone.CANCELED);c.files[1].status.should.equal(Dropzone.CANCELED);return f()},10)})});describe(".destroy()",function(){it("should properly cancel all pending uploads and remove all file references",function(f){c.accept=function(h,g){return g()};c.options.parallelUploads=1;c.addFile(b());c.addFile(b());return setTimeout(function(){c.getUploadingFiles().length.should.equal(1);c.getQueuedFiles().length.should.equal(1);c.files.length.should.equal(2);sinon.spy(c,"disable");c.destroy();c.disable.callCount.should.equal(1);d.should.not.have.property("dropzone");return f()},10)});it("should be able to create instance of dropzone on the same element after destroy",function(){c.destroy();return(function(){return new Dropzone(d,{maxFilesize:4,url:"url",acceptedMimeTypes:"audio/*,image/png",uploadprogress:function(){}})}).should.not["throw"](Error)});return it("should remove itself from Dropzone.instances",function(){(Dropzone.instances.indexOf(c)!==-1).should.be.ok;c.destroy();return(Dropzone.instances.indexOf(c)===-1).should.be.ok})});describe(".filesize()",function(){return it("should convert to KiloBytes, etc.. not KibiBytes",function(){c.filesize(2*1024*1024).should.eql("<strong>2</strong> MiB");c.filesize(2*1000*1000*1000).should.eql("<strong>1.9</strong> GiB");return c.filesize(2*1024*1024*1024).should.eql("<strong>2</strong> GiB")})});describe("._updateMaxFilesReachedClass()",function(){it("should properly add the dz-max-files-reached class",function(){c.getAcceptedFiles=function(){return{length:10}};c.options.maxFiles=10;c.element.classList.contains("dz-max-files-reached").should.not.be.ok;c._updateMaxFilesReachedClass();return c.element.classList.contains("dz-max-files-reached").should.be.ok});it("should fire the 'maxfilesreached' event when appropriate",function(){var f;f=sinon.spy();c.on("maxfilesreached",function(){return f()});c.getAcceptedFiles=function(){return{length:9}};c.options.maxFiles=10;c._updateMaxFilesReachedClass();f.should.not.have.been.called;c.getAcceptedFiles=function(){return{length:10}};c._updateMaxFilesReachedClass();f.should.have.been.called;c.getAcceptedFiles=function(){return{length:11}};c._updateMaxFilesReachedClass();return f.should.have.been.calledOnce});return it("should properly remove the dz-max-files-reached class",function(){c.getAcceptedFiles=function(){return{length:10}};c.options.maxFiles=10;c.element.classList.contains("dz-max-files-reached").should.not.be.ok;c._updateMaxFilesReachedClass();c.element.classList.contains("dz-max-files-reached").should.be.ok;c.getAcceptedFiles=function(){return{length:9}};c._updateMaxFilesReachedClass();return c.element.classList.contains("dz-max-files-reached").should.not.be.ok})});return describe("events",function(){return describe("progress updates",function(){return it("should properly emit a totaluploadprogress event",function(f){var g,h;c.files=[{size:1990,accepted:true,status:Dropzone.UPLOADING,upload:{progress:20,total:2000,bytesSent:400}},{size:1990,accepted:true,status:Dropzone.UPLOADING,upload:{progress:10,total:2000,bytesSent:200}}];h=0;c.on("totaluploadprogress",function(i){i.should.equal(g);if(++h===3){return f()}});g=15;c.emit("uploadprogress",{});g=97.5;c.files[0].upload.bytesSent=2000;c.files[1].upload.bytesSent=1900;c.emit("uploadprogress",{});g=100;c.files[0].upload.bytesSent=2000;c.files[1].upload.bytesSent=2000;c.emit("uploadprogress",{});c.files[0].status=Dropzone.CANCELED;return c.files[1].status=Dropzone.CANCELED})})})});describe("helper function",function(){var c,d;d=null;c=null;beforeEach(function(){d=Dropzone.createElement("<div></div>");return c=new Dropzone(d,{url:"url"})});describe("getExistingFallback()",function(){it("should return undefined if no fallback",function(){return expect(c.getExistingFallback()).to.equal(void 0)});it("should only return the fallback element if it contains exactly fallback",function(){d.appendChild(Dropzone.createElement('<form class="fallbacks"></form>'));d.appendChild(Dropzone.createElement('<form class="sfallback"></form>'));return expect(c.getExistingFallback()).to.equal(void 0)});it("should return divs as fallback",function(){var e;e=Dropzone.createElement('<form class=" abc fallback test "></form>');d.appendChild(e);return e.should.equal(c.getExistingFallback())});return it("should return forms as fallback",function(){var e;e=Dropzone.createElement('<div class=" abc fallback test "></div>');d.appendChild(e);return e.should.equal(c.getExistingFallback())})});describe("getFallbackForm()",function(){it("should use the paramName without [0] if uploadMultiple is false",function(){var f,e;c.options.uploadMultiple=false;c.options.paramName="myFile";f=c.getFallbackForm();e=f.querySelector("input[type=file]");return e.name.should.equal("myFile")});return it("should properly add [0] to the file name if uploadMultiple is true",function(){var f,e;c.options.uploadMultiple=true;c.options.paramName="myFile";f=c.getFallbackForm();e=f.querySelector("input[type=file]");return e.name.should.equal("myFile[0]")})});describe("getAcceptedFiles() / getRejectedFiles()",function(){var f,e,h,g;f=e=h=g=null;beforeEach(function(){f=b();e=b();h=b();g=b();c.options.accept=function(j,i){if(j===f||j===h){return i()}else{return i("error")}};c.addFile(f);c.addFile(e);c.addFile(h);return c.addFile(g)});it("getAcceptedFiles() should only return accepted files",function(){return c.getAcceptedFiles().should.eql([f,h])});return it("getRejectedFiles() should only return rejected files",function(){return c.getRejectedFiles().should.eql([e,g])})});describe("getQueuedFiles()",function(){return it("should return all files with the status Dropzone.QUEUED",function(){var f,e,h,g;f=b();e=b();h=b();g=b();c.options.accept=function(j,i){return j.done=i};c.addFile(f);c.addFile(e);c.addFile(h);c.addFile(g);c.getQueuedFiles().should.eql([]);f.done();h.done();c.getQueuedFiles().should.eql([f,h]);f.status.should.equal(Dropzone.QUEUED);h.status.should.equal(Dropzone.QUEUED);e.status.should.equal(Dropzone.ADDED);return g.status.should.equal(Dropzone.ADDED)})});describe("getUploadingFiles()",function(){return it("should return all files with the status Dropzone.UPLOADING",function(g){var f,e,i,h;f=b();e=b();i=b();h=b();c.options.accept=function(j,k){return j.done=k};c.uploadFile=function(){};c.addFile(f);c.addFile(e);c.addFile(i);c.addFile(h);c.getUploadingFiles().should.eql([]);f.done();i.done();return setTimeout((function(){c.getUploadingFiles().should.eql([f,i]);f.status.should.equal(Dropzone.UPLOADING);i.status.should.equal(Dropzone.UPLOADING);e.status.should.equal(Dropzone.ADDED);h.status.should.equal(Dropzone.ADDED);return g()}),10)})});describe("getActiveFiles()",function(){return it("should return all files with the status Dropzone.UPLOADING or Dropzone.QUEUED",function(g){var f,e,i,h;f=b();e=b();i=b();h=b();c.options.accept=function(j,k){return j.done=k};c.uploadFile=function(){};c.options.parallelUploads=2;c.addFile(f);c.addFile(e);c.addFile(i);c.addFile(h);c.getActiveFiles().should.eql([]);f.done();i.done();h.done();return setTimeout((function(){c.getActiveFiles().should.eql([f,i,h]);f.status.should.equal(Dropzone.UPLOADING);i.status.should.equal(Dropzone.UPLOADING);e.status.should.equal(Dropzone.ADDED);h.status.should.equal(Dropzone.QUEUED);return g()}),10)})});return describe("getFilesWithStatus()",function(){return it("should return all files with provided status",function(){var f,e,h,g;f=b();e=b();h=b();g=b();c.options.accept=function(i,j){return i.done=j};c.uploadFile=function(){};c.addFile(f);c.addFile(e);c.addFile(h);c.addFile(g);c.getFilesWithStatus(Dropzone.ADDED).should.eql([f,e,h,g]);f.status=Dropzone.UPLOADING;h.status=Dropzone.QUEUED;g.status=Dropzone.QUEUED;c.getFilesWithStatus(Dropzone.ADDED).should.eql([e]);c.getFilesWithStatus(Dropzone.UPLOADING).should.eql([f]);return c.getFilesWithStatus(Dropzone.QUEUED).should.eql([h,g])})})});return describe("file handling",function(){var c,d;d=null;c=null;beforeEach(function(){var e;d=b();e=Dropzone.createElement("<div></div>");return c=new Dropzone(e,{url:"/the/url"})});afterEach(function(){return c.destroy()});describe("addFile()",function(){it("should properly set the status of the file",function(){var e;e=null;c.accept=function(g,f){return e=f};c.processFile=function(){};c.uploadFile=function(){};c.addFile(d);d.status.should.eql(Dropzone.ADDED);e();d.status.should.eql(Dropzone.QUEUED);d=b();c.addFile(d);d.status.should.eql(Dropzone.ADDED);e("error");return d.status.should.eql(Dropzone.ERROR)});it("should properly set the status of the file if autoProcessQueue is false and not call processQueue",function(f){var e;e=null;c.options.autoProcessQueue=false;c.accept=function(h,g){return e=g};c.processFile=function(){};c.uploadFile=function(){};c.addFile(d);sinon.stub(c,"processQueue");d.status.should.eql(Dropzone.ADDED);e();d.status.should.eql(Dropzone.QUEUED);c.processQueue.callCount.should.equal(0);return setTimeout((function(){c.processQueue.callCount.should.equal(0);return f()}),10)});it("should not add the file to the queue if autoQueue is false",function(){var e;e=null;c.options.autoQueue=false;c.accept=function(g,f){return e=f};c.processFile=function(){};c.uploadFile=function(){};c.addFile(d);d.status.should.eql(Dropzone.ADDED);e();return d.status.should.eql(Dropzone.ADDED)});it("should create a remove link if configured to do so",function(){c.options.addRemoveLinks=true;c.processFile=function(){};c.uploadFile=function(){};sinon.stub(c,"processQueue");c.addFile(d);return c.files[0].previewElement.querySelector("a[data-dz-remove].dz-remove").should.be.ok});it("should attach an event handler to data-dz-remove links",function(){var h,g,f,e;c.options.previewTemplate='<div class="dz-preview dz-file-preview">\n  <div class="dz-details">\n    <div class="dz-filename"><span data-dz-name></span></div>\n    <div class="dz-size" data-dz-size></div>\n    <img data-dz-thumbnail />\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-success-mark"><span>✔</span></div>\n  <div class="dz-error-mark"><span>✘</span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <a class="link1" data-dz-remove></a>\n  <a class="link2" data-dz-remove></a>\n</div>';sinon.stub(c,"processQueue");c.addFile(d);g=c.files[0];f=g.previewElement.querySelector("a[data-dz-remove].link1");e=g.previewElement.querySelector("a[data-dz-remove].link2");sinon.stub(c,"removeFile");h=document.createEvent("HTMLEvents");h.initEvent("click",true,true);f.dispatchEvent(h);c.removeFile.callCount.should.eql(1);h=document.createEvent("HTMLEvents");h.initEvent("click",true,true);e.dispatchEvent(h);return c.removeFile.callCount.should.eql(2)});return describe("thumbnails",function(){return it("should properly queue the thumbnail creation",function(h){var j,i,f,g,e,k;f=null;c.accept=function(m,l){return f=l};c.processFile=function(){};c.uploadFile=function(){};g=b();e=b();k=b();g.type="image/jpg";e.type="image/jpg";k.type="image/jpg";c.on("thumbnail",function(){return console.log("HII")});i=j=null;c.createThumbnail=function(l,m){i=l;return j=m};sinon.spy(c,"createThumbnail");c.addFile(g);c.addFile(e);c.addFile(k);c.files.length.should.eql(3);return setTimeout((function(){c.createThumbnail.callCount.should.eql(1);g.should.equal(i);j();c.createThumbnail.callCount.should.eql(2);e.should.equal(i);j();c.createThumbnail.callCount.should.eql(3);k.should.equal(i);return h()}),10)})})});describe("enqueueFile()",function(){it("should be wrapped by enqueueFiles()",function(){var f,e,g;sinon.stub(c,"enqueueFile");f=b();e=b();g=b();c.enqueueFiles([f,e,g]);c.enqueueFile.callCount.should.equal(3);c.enqueueFile.args[0][0].should.equal(f);c.enqueueFile.args[1][0].should.equal(e);return c.enqueueFile.args[2][0].should.equal(g)});it("should fail if the file has already been processed",function(){d.status=Dropzone.ERROR;expect((function(){return c.enqueueFile(d)})).to["throw"]("This file can't be queued because it has already been processed or was rejected.");d.status=Dropzone.COMPLETE;expect((function(){return c.enqueueFile(d)})).to["throw"]("This file can't be queued because it has already been processed or was rejected.");d.status=Dropzone.UPLOADING;return expect((function(){return c.enqueueFile(d)})).to["throw"]("This file can't be queued because it has already been processed or was rejected.")});return it("should set the status to QUEUED and call processQueue asynchronously if everything's ok",function(e){d.status=Dropzone.ADDED;sinon.stub(c,"processQueue");c.processQueue.callCount.should.equal(0);c.enqueueFile(d);d.status.should.equal(Dropzone.QUEUED);c.processQueue.callCount.should.equal(0);return setTimeout(function(){c.processQueue.callCount.should.equal(1);return e()},10)})});describe("uploadFiles()",function(){var e;e=null;beforeEach(function(){e=[];return a.onCreate=function(f){return e.push(f)}});afterEach(function(){return a.restore()});it("should be wrapped by uploadFile()",function(){sinon.stub(c,"uploadFiles");c.uploadFile(d);c.uploadFiles.callCount.should.equal(1);return c.uploadFiles.calledWith([d]).should.be.ok});it("should ignore the onreadystate callback if readyState != 4",function(f){c.addFile(d);return setTimeout(function(){d.status.should.eql(Dropzone.UPLOADING);e[0].status=200;e[0].readyState=3;e[0].onload();d.status.should.eql(Dropzone.UPLOADING);e[0].readyState=4;e[0].onload();d.status.should.eql(Dropzone.SUCCESS);return f()},10)});it("should emit error and errormultiple when response was not OK",function(h){var g,j,i,f;c.options.uploadMultiple=true;i=false;f=false;g=false;j=false;c.on("error",function(){return i=true});c.on("errormultiple",function(){return f=true});c.on("complete",function(){return g=true});c.on("completemultiple",function(){return j=true});c.addFile(d);return setTimeout(function(){d.status.should.eql(Dropzone.UPLOADING);e[0].status=400;e[0].readyState=4;e[0].onload();expect((((true===i&&i===f)&&f===g)&&g===j)).to.be.ok;return h()},10)});it("should include hidden files in the form and unchecked checkboxes and radiobuttons should be excluded",function(g){var h,i,f;h=Dropzone.createElement('<form action="/the/url">\n  <input type="hidden" name="test" value="hidden" />\n  <input type="checkbox" name="unchecked" value="1" />\n  <input type="checkbox" name="checked" value="value1" checked="checked" />\n  <input type="radio" value="radiovalue1" name="radio1" />\n  <input type="radio" value="radiovalue2" name="radio1" checked="checked" />\n  <select name="select"><option value="1">1</option><option value="2" selected>2</option></select>\n</form>');c=new Dropzone(h,{url:"/the/url"});i=null;c.on("sending",function(j,l,k){i=k;return sinon.spy(k,"append")});f=b();c.addFile(f);return setTimeout(function(){i.append.callCount.should.equal(5);i.append.args[0][0].should.eql("test");i.append.args[0][1].should.eql("hidden");i.append.args[1][0].should.eql("checked");i.append.args[1][1].should.eql("value1");i.append.args[2][0].should.eql("radio1");i.append.args[2][1].should.eql("radiovalue2");i.append.args[3][0].should.eql("select");i.append.args[3][1].should.eql("2");i.append.args[4][0].should.eql("file");i.append.args[4][1].should.equal(f);return g()},10)});it("should all values of a select that has the multiple attribute",function(g){var h,i,f;h=Dropzone.createElement('<form action="/the/url">\n  <select name="select" multiple>\n    <option value="value1">1</option>\n    <option value="value2" selected>2</option>\n    <option value="value3">3</option>\n    <option value="value4" selected>4</option>\n  </select>\n</form>');c=new Dropzone(h,{url:"/the/url"});i=null;c.on("sending",function(j,l,k){i=k;return sinon.spy(k,"append")});f=b();c.addFile(f);return setTimeout(function(){i.append.callCount.should.equal(3);i.append.args[0][0].should.eql("select");i.append.args[0][1].should.eql("value2");i.append.args[1][0].should.eql("select");i.append.args[1][1].should.eql("value4");i.append.args[2][0].should.eql("file");i.append.args[2][1].should.equal(f);return g()},10)});describe("settings()",function(){it("should correctly set `withCredentials` on the xhr object",function(){c.uploadFile(d);e.length.should.eql(1);e[0].withCredentials.should.eql(false);c.options.withCredentials=true;c.uploadFile(d);e.length.should.eql(2);return e[1].withCredentials.should.eql(true)});it("should correctly override headers on the xhr object",function(){c.options.headers={"Foo-Header":"foobar"};c.uploadFile(d);return e[0].requestHeaders["Foo-Header"].should.eql("foobar")});it("should properly use the paramName without [n] as file upload if uploadMultiple is false",function(h){var j,g,f,i;c.options.uploadMultiple=false;c.options.paramName="myName";j=[];i=0;c.on("sending",function(l,m,k){i++;j.push(k);return sinon.spy(k,"append")});g=b();f=b();c.addFile(g);c.addFile(f);return setTimeout(function(){i.should.equal(2);j.length.should.equal(2);j[0].append.callCount.should.equal(1);j[1].append.callCount.should.equal(1);j[0].append.args[0][0].should.eql("myName");j[0].append.args[0][0].should.eql("myName");return h()},10)});return it("should properly use the paramName with [n] as file upload if uploadMultiple is true",function(h){var k,g,f,i,j;c.options.uploadMultiple=true;c.options.paramName="myName";k=null;j=0;i=0;c.on("sending",function(l,n,m){return i++});c.on("sendingmultiple",function(m,n,l){j++;k=l;return sinon.spy(l,"append")});g=b();f=b();c.addFile(g);c.addFile(f);return setTimeout(function(){i.should.equal(2);j.should.equal(1);c.uploadFiles([g,f]);k.append.callCount.should.equal(2);k.append.args[0][0].should.eql("myName[0]");k.append.args[1][0].should.eql("myName[1]");return h()},10)})});return describe("should properly set status of file",function(){return it("should correctly set `withCredentials` on the xhr object",function(f){c.addFile(d);return setTimeout(function(){d.status.should.eql(Dropzone.UPLOADING);e.length.should.equal(1);e[0].status=400;e[0].readyState=4;e[0].onload();d.status.should.eql(Dropzone.ERROR);d=b();c.addFile(d);return setTimeout(function(){d.status.should.eql(Dropzone.UPLOADING);e.length.should.equal(2);e[1].status=200;e[1].readyState=4;e[1].onload();d.status.should.eql(Dropzone.SUCCESS);return f()},10)},10)})})});return describe("complete file",function(){return it("should properly emit the queuecomplete event when the complete queue is finished",function(g){var h,f,e,i;f=b();e=b();i=b();f.status=Dropzone.ADDED;e.status=Dropzone.ADDED;i.status=Dropzone.ADDED;f.name="mock1";e.name="mock2";i.name="mock3";c.uploadFiles=function(j){return setTimeout(((function(k){return function(){return k._finished(j,null,null)}})(this)),1)};h=0;c.on("complete",function(j){return h++});c.on("queuecomplete",function(){h.should.equal(3);return g()});c.addFile(f);c.addFile(e);return c.addFile(i)})})})})}).call(this);