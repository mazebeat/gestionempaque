(function(I,P){function N(d,f){return parseInt(d.css(f),10)||0}function L(d){return"border-box"===d.css(h)}function G(d){return L(d)?N(d,"height"):d[0].offsetHeight?d.height():0}function E(d){return N(d,"paddingTop")+N(d,"paddingBottom")+N(d,"borderTopWidth")+N(d,"borderBottomWidth")}function e(g,m,f){var k=0,l=function(){o(k);var p=f||this,n=c.call(arguments);k=b(function(){g.apply(p,n)},m)};l.cancel=function(){o(k)};return l}var o=I.clearTimeout,j="autogrow-measure-"+(""+Math.random()).replace(/[^0-9]/g,""),c=[].slice,a={}.hasOwnProperty,b=I.setTimeout,K=function(){return{define:function(g,n,d,m){g=P[g];var k=g[n],l=null;k?l=k[d]:k=g[n]={};k[d]="set"===d?function(f,p,r){var q;l&&(q=l(f,p,r));return m(f,p,r)||q}:function(f,p){var r,q;l&&(r=l(f,p));q=m(f,p);return null===q?r:q}},GETTER:"get",SETTER:"set",ATTR:"attrHooks",PROP:"propHooks",VAL:"valHooks"}}(),h=function(){for(var f=["boxSizing","mozBoxSizing","webkitBoxSizing"],g=document.createElement("div").style,d=0;d<f.length;++d){if(f[d] in g){return f[d]}}return f[0]}(),H={left:-999999,padding:0,height:1,border:"none",overflow:"hidden",position:"absolute",mozBoxSizing:"content-box",webkitBoxSizing:"content-box",boxSizing:"content-box",pointerEvents:"none"},M="fontWeight fontFamily fontStyle fontSize wordWrap lineHeight wordSpacing letterSpacing textIndent textTransform".split(" "),F=function(){function d(){this.counter=0;this.textarea=P("<textarea>",{tabIndex:-1}).css(H).addClass(j).appendTo("body")}var f=d.prototype;f.isUsedBy=function(g){return P(g).data("autogrow-instance")._measurement===this.textarea};f.isValid=function(){return 0<this.counter};f.useBy=function(g){this.isUsedBy(g)||(this.counter++,P(g).data("autogrow-instance")._measurement=this.textarea)};f.deuseBy=function(g){if(!this.isValid()){return !0}if(!this.isUsedBy(g)){return !1}this.counter--;P(g).data("autogrow-instance")._measurement=null;return this.isValid()?!1:(this.textarea.remove(),this.textarea=null,!0)};return d}(),J={cache:{},hashFor:function(f){for(var k="",d=0,g=M.length;d<g;++d){k+=f.css(M[d])}return k},applyTo:function(f){var k=this.hashFor(f),d=this.cache,g=d[k];g&&g.isValid()||(d[k]=g=new F);g.useBy(f[0])},removeFrom:function(g){var m=this.hashFor(g),f=this.cache,k=f[m];if(k&&k.isUsedBy(g[0])){k.deuseBy(g[0])&&delete f[m]}else{for(var l in f){a.call(f,l)&&(k=f[l],k.deuseBy(g[0])&&delete f[l])}}}},i=function(){function d(g){this._elem=P(g);this._measurement=null;this._baseHeight=-1;this._additionalHeight=this._lastHeight=0;this._oninput=e(this._oninput,13,this);this._elem.on("cut.autogrow input.autogrow paste.autogrow mouseup.autogrow keydown.autogrow keyup.autogrow keypress.autogrow",this._oninput);this._elem.on("destroy.autogrow",P.proxy(this.destroy,this))}var f=d.prototype;f._oninput=function(){if(0>=this._baseHeight){var g=this._elem,k=g[0],m=k.value,l=k.style.height;k.style.height="";k.value="";g=G(g);k.style.height=l;k.value=m;this._baseHeight=g;L(this._elem)?this._additionalHeight=E(this._elem):this._additionalHeight=0}0<this._baseHeight&&(k=this._measureHeight(),k=Math.max(this._baseHeight,k)+this._additionalHeight,k!==this._lastHeight&&(this._lastHeight=k,this._elem.css("height",k)))};f._measureHeight=function(){this._measurement.css("width",L(this._elem)?N(this._elem,"width"):this._elem[0].offsetWidth?this._elem.width():0).val(this._elem.val()+"ＭＭＭＭ");return this._measurement.prop("scrollHeight")|0};f._refresh=function(){null!=this._measurement&&J.removeFrom(this._elem);J.applyTo(this._elem);for(var g=0;g<M.length;++g){this._measurement.css(M[g],this._elem.css(M[g]))}L(this._elem)?this._additionalHeight=E(this._elem):this._additionalHeight=0;this._baseHeight=-1;this._lastHeight=G(this._elem)};f.refresh=function(){this._refresh()};f.destroy=function(){J.removeFrom(this._elem);this._oninput.cancel();this._elem.removeData("autogrow-instance");this._elem.off(".autogrow");this._elem=null};K.define(K.VAL,"textarea",K.SETTER,function(g,k){if(P.data(g,"autogrow-instance")){return g.value=k,this._oninput(),!0}});return d}(),D=P.fn.autogrow,O;O=P.fn.autogrow=function(d){var f=[].slice.call(arguments,1);return this.filter("textarea").each(function(){var g=P(this),k=g.data("autogrow-instance");g.hasClass(j)||(k||(g.data("autogrow-instance",k=new i(this)),k.refresh()),"string"===typeof d&&("_"!==d.charAt(0)&&"function"===typeof k[d])&&k[d].apply(k,f))})};O.Constructor=i;O.noConflict=function(){P.fn.autogrow=D;return O};O.refresh=function(){P("textarea[data-autogrow]").autogrow()};P(O.refresh);P.ajaxPrefilter(function(f,g,d){(d.complete||d.always)(O.refresh)})})(this,this.jQuery);