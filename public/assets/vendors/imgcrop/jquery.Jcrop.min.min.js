(function(b){b.Jcrop=function(bz,a8){var aU=b.extend({},b.Jcrop.defaults),a1,aV=navigator.userAgent.toLowerCase(),a7=/msie/.test(aV),aX=/msie [1-6]\./.test(aV);function bq(c){return Math.round(c)+"px"}function a4(c){return aU.baseClass+"-"+c}function a2(){return b.fx.step.hasOwnProperty("backgroundColor")}function a0(d){var c=b(d).offset();return[c.left,c.top]}function aY(c){return[(c.pageX-a1[0]),(c.pageY-a1[1])]}function ba(c){if(typeof(c)!=="object"){c={}}aU=b.extend(aU,c);b.each(["onChange","onSelect","onRelease","onDblClick"],function(e,d){if(typeof(aU[d])!=="function"){aU[d]=function(){}}})}function bx(f,e,c){a1=a0(aC);aG.setCursor(f==="move"?f:f+"-resize");if(f==="move"){return aG.activateHandlers(aD(e),bm,c)}var h=bb.getFixed();var g=bk(f);var d=bb.getCorner(bk(g));bb.setPressed(bb.getCorner(g));bb.setCurrent(d);aG.activateHandlers(aW(f,h),bm,c)}function aW(c,d){return function(e){if(!aU.aspectRatio){switch(c){case"e":e[1]=d.y2;break;case"w":e[1]=d.y2;break;case"n":e[0]=d.x2;break;case"s":e[0]=d.x2;break}}else{switch(c){case"e":e[1]=d.y+1;break;case"w":e[1]=d.y+1;break;case"n":e[0]=d.x+1;break;case"s":e[0]=d.x+1;break}}bb.setCurrent(e);aw.update()}}function aD(c){var d=c;aF.watchKeys();return function(e){bb.moveOffset([e[0]-d[0],e[1]-d[1]]);d=e;aw.update()}}function bk(c){switch(c){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function bB(c){return function(d){if(aU.disabled){return false}if((c==="move")&&!aU.allowMove){return false}a1=a0(aC);bl=true;bx(c,aY(d));d.stopPropagation();d.preventDefault();return false}}function ay(c,f,d){var g=c.width(),e=c.height();if((g>f)&&f>0){g=f;e=(f/c.width())*c.height()}if((e>d)&&d>0){e=d;g=(d/c.height())*c.width()}aM=c.width()/g;by=c.height()/e;c.width(g).height(e)}function a(c){return{x:c.x*aM,y:c.y*by,x2:c.x2*aM,y2:c.y2*by,w:c.w*aM,h:c.h*by}}function bm(c){var d=bb.getFixed();if((d.w>aU.minSelect[0])&&(d.h>aU.minSelect[1])){aw.enableHandles();aw.done()}else{aw.release()}aG.setCursor(aU.allowSelect?"crosshair":"default")}function a3(d){if(aU.disabled){return}if(!aU.allowSelect){return}bl=true;a1=a0(aC);aw.disableHandles();aG.setCursor("crosshair");var c=aY(d);bb.setPressed(c);aw.update();aG.activateHandlers(aH,bm,d.type.substring(0,5)==="touch");aF.watchKeys();d.stopPropagation();d.preventDefault();return false}function aH(c){bb.setCurrent(c);aw.update()}function aZ(){var c=b("<div></div>").addClass(a4("tracker"));if(a7){c.css({opacity:0,backgroundColor:"white"})}return c}if(typeof(bz)!=="object"){bz=b(bz)[0]}if(typeof(a8)!=="object"){a8={}}ba(a8);var bu={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0};var av=b(bz),aR=true;if(bz.tagName=="IMG"){if(av[0].width!=0&&av[0].height!=0){av.width(av[0].width);av.height(av[0].height)}else{var bh=new Image();bh.src=av[0].src;av.width(bh.width);av.height(bh.height)}var aC=av.clone().removeAttr("id").css(bu).show();aC.width(av.width());aC.height(av.height());av.after(aC).hide()}else{aC=av.css(bu).show();aR=false;if(aU.shade===null){aU.shade=true}}ay(aC,aU.boxWidth,aU.boxHeight);var aE=aC.width(),aI=aC.height(),bd=b("<div />").width(aE).height(aI).addClass(a4("holder")).css({position:"relative",backgroundColor:aU.bgColor}).insertAfter(av).append(aC);if(aU.addClass){bd.addClass(aU.addClass)}var aS=b("<div />"),br=b("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),aO=b("<div />").width("100%").height("100%").css("zIndex",320),bc=b("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var c=bb.getFixed();aU.onDblClick.call(bv,c)}).insertBefore(aC).append(br,aO);if(aR){aS=b("<img />").attr("src",aC.attr("src")).css(bu).width(aE).height(aI),br.append(aS)}if(aX){bc.css({overflowY:"hidden"})}var bi=aU.boundary;var bC=aZ().width(aE+(bi*2)).height(aI+(bi*2)).css({position:"absolute",top:bq(-bi),left:bq(-bi),zIndex:290}).mousedown(a3);var aK=aU.bgColor,a9=aU.bgOpacity,be,aN,bn,az,aM,by,bo=true,bl,a6,a5;a1=a0(aC);var aB=(function(){function d(){var g={},k=["touchstart","touchmove","touchend"],i=document.createElement("div"),f;try{for(f=0;f<k.length;f++){var j=k[f];j="on"+j;var h=(j in i);if(!h){i.setAttribute(j,"return;");h=typeof i[j]=="function"}g[k[f]]=h}return g.touchstart&&g.touchend&&g.touchmove}catch(e){return false}}function c(){if((aU.touchSupport===true)||(aU.touchSupport===false)){return aU.touchSupport}else{return d()}}return{createDragger:function(e){return function(f){if(aU.disabled){return false}if((e==="move")&&!aU.allowMove){return false}a1=a0(aC);bl=true;bx(e,aY(aB.cfilter(f)),true);f.stopPropagation();f.preventDefault();return false}},newSelection:function(e){return a3(aB.cfilter(e))},cfilter:function(e){e.pageX=e.originalEvent.changedTouches[0].pageX;e.pageY=e.originalEvent.changedTouches[0].pageY;return e},isSupported:d,support:c()}}());var bb=(function(){var d=0,e=0,f=0,h=0,o,r;function m(s){s=p(s);f=d=s[0];h=e=s[1]}function n(s){s=p(s);o=s[0]-f;r=s[1]-h;f=s[0];h=s[1]}function q(){return[o,r]}function g(s){var t=s[0],u=s[1];if(0>d+t){t-=t+d}if(0>e+u){u-=u+e}if(aI<h+u){u+=aI-(h+u)}if(aE<f+t){t+=aE-(f+t)}d+=t;f+=t;e+=u;h+=u}function l(t){var s=c();switch(t){case"ne":return[s.x2,s.y];case"nw":return[s.x,s.y];case"se":return[s.x2,s.y2];case"sw":return[s.x,s.y2]}}function c(){if(!aU.aspectRatio){return i()}var C=aU.aspectRatio,v=aU.minSize[0]/aM,D=aU.maxSize[0]/aM,s=aU.maxSize[1]/by,B=f-d,t=h-e,A=Math.abs(B),z=Math.abs(t),x=A/z,E,w,u,y;if(D===0){D=aE*10}if(s===0){s=aI*10}if(x<C){w=h;u=z*C;E=B<0?d-u:u+d;if(E<0){E=0;y=Math.abs((E-d)/C);w=t<0?e-y:y+e}else{if(E>aE){E=aE;y=Math.abs((E-d)/C);w=t<0?e-y:y+e}}}else{E=f;y=A/C;w=t<0?e-y:e+y;if(w<0){w=0;u=Math.abs((w-e)*C);E=B<0?d-u:u+d}else{if(w>aI){w=aI;u=Math.abs(w-e)*C;E=B<0?d-u:u+d}}}if(E>d){if(E-d<v){E=d+v}else{if(E-d>D){E=d+D}}if(w>e){w=e+(E-d)/C}else{w=e-(E-d)/C}}else{if(E<d){if(d-E<v){E=d-v}else{if(d-E>D){E=d-D}}if(w>e){w=e+(d-E)/C}else{w=e-(d-E)/C}}}if(E<0){d-=E;E=0}else{if(E>aE){d-=E-aE;E=aE}}if(w<0){e-=w;w=0}else{if(w>aI){e-=w-aI;w=aI}}return j(k(d,e,E,w))}function p(s){if(s[0]<0){s[0]=0}if(s[1]<0){s[1]=0}if(s[0]>aE){s[0]=aE}if(s[1]>aI){s[1]=aI}return[Math.round(s[0]),Math.round(s[1])]}function k(w,u,x,v){var s=w,t=x,y=u,z=v;if(x<w){s=x;t=w}if(v<u){y=v;z=u}return[s,y,t,z]}function i(){var t=f-d,u=h-e,s;if(be&&(Math.abs(t)>be)){f=(t>0)?(d+be):(d-be)}if(aN&&(Math.abs(u)>aN)){h=(u>0)?(e+aN):(e-aN)}if(az/by&&(Math.abs(u)<az/by)){h=(u>0)?(e+az/by):(e-az/by)}if(bn/aM&&(Math.abs(t)<bn/aM)){f=(t>0)?(d+bn/aM):(d-bn/aM)}if(d<0){f-=d;d-=d}if(e<0){h-=e;e-=e}if(f<0){d-=f;f-=f}if(h<0){e-=h;h-=h}if(f>aE){s=f-aE;d-=s;f-=s}if(h>aI){s=h-aI;e-=s;h-=s}if(d>aE){s=d-aI;h-=s;e-=s}if(e>aI){s=e-aI;h-=s;e-=s}return j(k(d,e,f,h))}function j(s){return{x:s[0],y:s[1],x2:s[2],y2:s[3],w:s[2]-s[0],h:s[3]-s[1]}}return{flipCoords:k,setPressed:m,setCurrent:n,getOffset:q,moveOffset:g,getCorner:l,getFixed:c}}());var bA=(function(){var m=false,h=b("<div />").css({position:"absolute",zIndex:240,opacity:0}),n={top:l(),left:l().height(aI),right:l().height(aI),bottom:l()};function f(q,p){n.left.css({height:bq(p)});n.right.css({height:bq(p)})}function c(){return k(bb.getFixed())}function k(p){n.top.css({left:bq(p.x),width:bq(p.w),height:bq(p.y)});n.bottom.css({top:bq(p.y2),left:bq(p.x),width:bq(p.w),height:bq(aI-p.y2)});n.right.css({left:bq(p.x2),width:bq(aE-p.x2)});n.left.css({width:bq(p.x)})}function l(){return b("<div />").css({position:"absolute",backgroundColor:aU.shadeColor||aU.bgColor}).appendTo(h)}function o(){if(!m){m=true;h.insertBefore(aC);c();aw.setBgOpacity(1,0,1);aS.hide();i(aU.shadeColor||aU.bgColor,1);if(aw.isAwake()){d(aU.bgOpacity,1)}else{d(1,1)}}}function i(q,p){bw(e(),q,p)}function g(){if(m){h.remove();aS.show();m=false;if(aw.isAwake()){aw.setBgOpacity(aU.bgOpacity,1,1)}else{aw.setBgOpacity(1,1,1);aw.disableHandles()}bw(bd,0,1)}}function d(p,q){if(m){if(aU.bgFade&&!q){h.animate({opacity:1-p},{queue:false,duration:aU.fadeTime})}else{h.css({opacity:1-p})}}}function j(){aU.shade?o():g();if(aw.isAwake()){d(aU.bgOpacity)}}function e(){return h.children()}return{update:c,updateRaw:k,getShades:e,setBgColor:i,enable:o,disable:g,resize:f,refresh:j,opacity:d}}());var aw=(function(){var w,i=370,A={},f={},s={},o=false;function z(E){var D=b("<div />").css({position:"absolute",opacity:aU.borderOpacity}).addClass(a4(E));br.append(D);return D}function p(F,E){var D=b("<div />").mousedown(bB(F)).css({cursor:F+"-resize",position:"absolute",zIndex:E}).addClass("ord-"+F);if(aB.support){D.bind("touchstart.jcrop",aB.createDragger(F))}aO.append(D);return D}function u(F){var E=aU.handleSize,D=p(F,i++).css({opacity:aU.handleOpacity}).addClass(a4("handle"));if(E){D.width(E).height(E)}return D}function k(D){return p(D,i++).addClass("jcrop-dragbar")}function n(E){var D;for(D=0;D<E.length;D++){s[E[D]]=k(E[D])}}function j(F){var E,D;for(D=0;D<F.length;D++){switch(F[D]){case"n":E="hline";break;case"s":E="hline bottom";break;case"e":E="vline right";break;case"w":E="vline";break}A[F[D]]=z(E)}}function q(E){var D;for(D=0;D<E.length;D++){f[E[D]]=u(E[D])}}function x(E,D){if(!aU.shade){aS.css({top:bq(-D),left:bq(-E)})}bc.css({top:bq(D),left:bq(E)})}function c(E,D){bc.width(Math.round(E)).height(Math.round(D))}function C(){var D=bb.getFixed();bb.setPressed([D.x,D.y]);bb.setCurrent([D.x2,D.y2]);e()}function e(D){if(w){return y(D)}}function y(E){var D=bb.getFixed();c(D.w,D.h);x(D.x,D.y);if(aU.shade){bA.updateRaw(D)}w||d();if(E){aU.onSelect.call(bv,a(D))}else{aU.onChange.call(bv,a(D))}}function t(E,D,F){if(!w&&!D){return}if(aU.bgFade&&!F){aC.animate({opacity:E},{queue:false,duration:aU.fadeTime})}else{aC.css("opacity",E)}}function d(){bc.show();if(aU.shade){bA.opacity(a9)}else{t(a9,true)}w=true}function h(){g();bc.hide();if(aU.shade){bA.opacity(1)}else{t(1)}w=false;aU.onRelease.call(bv)}function v(){if(o){aO.show()}}function m(){o=true;if(aU.allowResize){aO.show();return true}}function g(){o=false;aO.hide()}function l(D){if(D){a6=true;g()}else{a6=false;m()}}function r(){l(false);C()}if(aU.dragEdges&&b.isArray(aU.createDragbars)){n(aU.createDragbars)}if(b.isArray(aU.createHandles)){q(aU.createHandles)}if(aU.drawBorders&&b.isArray(aU.createBorders)){j(aU.createBorders)}b(document).bind("touchstart.jcrop-ios",function(D){if(b(D.currentTarget).hasClass("jcrop-tracker")){D.stopPropagation()}});var B=aZ().mousedown(bB("move")).css({cursor:"move",position:"absolute",zIndex:360});if(aB.support){B.bind("touchstart.jcrop",aB.createDragger("move"))}br.append(B);g();return{updateVisible:e,update:y,release:h,refresh:C,isAwake:function(){return w},setCursor:function(D){B.css("cursor",D)},enableHandles:m,enableOnly:function(){o=true},showHandles:v,disableHandles:g,animMode:l,setBgOpacity:t,done:r}}());var aG=(function(){var d=function(){},m=function(){},c=aU.trackDocument;function f(n){bC.css({zIndex:450});if(n){b(document).bind("touchmove.jcrop",g).bind("touchend.jcrop",j)}else{if(c){b(document).bind("mousemove.jcrop",e).bind("mouseup.jcrop",l)}}}function h(){bC.css({zIndex:290});b(document).unbind(".jcrop")}function e(n){d(aY(n));return false}function l(n){n.preventDefault();n.stopPropagation();if(bl){bl=false;m(aY(n));if(aw.isAwake()){aU.onSelect.call(bv,a(bb.getFixed()))}h();d=function(){};m=function(){}}return false}function k(n,o,p){bl=true;d=n;m=o;f(p);return false}function g(n){d(aY(aB.cfilter(n)));return false}function j(n){return l(aB.cfilter(n))}function i(n){bC.css("cursor",n)}if(!c){bC.mousemove(e).mouseup(l).mouseout(l)}aC.before(bC);return{activateHandlers:k,setCursor:i}}());var aF=(function(){var d=b('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),f=b("<div />").css({position:"absolute",overflow:"hidden"}).append(d);function g(){if(aU.keySupport){d.show();d.focus()}}function c(i){d.hide()}function e(j,k,i){if(aU.allowMove){bb.moveOffset([k,i]);aw.updateVisible(true)}j.preventDefault();j.stopPropagation()}function h(i){if(i.ctrlKey||i.metaKey){return true}a5=i.shiftKey?true:false;var j=a5?10:1;switch(i.keyCode){case 37:e(i,-j,0);break;case 39:e(i,j,0);break;case 38:e(i,0,-j);break;case 40:e(i,0,j);break;case 27:if(aU.allowSelect){aw.release()}break;case 9:return true}return false}if(aU.keySupport){d.keydown(h).blur(c);if(aX||!aU.fixedSupport){d.css({position:"absolute",left:"-20px"});f.append(d).insertBefore(aC)}else{d.insertBefore(aC)}}return{watchKeys:g}}());function bs(c){bd.removeClass().addClass(a4("holder")).addClass(c)}function bj(c,t){var k=c[0]/aM,l=c[1]/by,m=c[2]/aM,n=c[3]/by;if(a6){return}var p=bb.flipCoords(k,l,m,n),e=bb.getFixed(),j=[e.x,e.y,e.x2,e.y2],h=j,i=aU.animationDelay,f=p[0]-j[0],u=p[1]-j[1],g=p[2]-j[2],v=p[3]-j[3],q=0,s=aU.swingSpeed;k=h[0];l=h[1];m=h[2];n=h[3];aw.animMode(true);var o;function r(){window.setTimeout(d,i)}var d=(function(){return function(){q+=(100-q)/s;h[0]=Math.round(k+((q/100)*f));h[1]=Math.round(l+((q/100)*u));h[2]=Math.round(m+((q/100)*g));h[3]=Math.round(n+((q/100)*v));if(q>=99.8){q=100}if(q<100){aL(h);r()}else{aw.done();aw.animMode(false);if(typeof(t)==="function"){t.call(bv)}}}}());r()}function aQ(c){aL([c[0]/aM,c[1]/by,c[2]/aM,c[3]/by]);aU.onSelect.call(bv,a(bb.getFixed()));aw.enableHandles()}function aL(c){bb.setPressed([c[0],c[1]]);bb.setCurrent([c[2],c[3]]);aw.update()}function bt(){return a(bb.getFixed())}function aP(){return bb.getFixed()}function bg(c){ba(c);aJ()}function bf(){aU.disabled=true;aw.disableHandles();aw.setCursor("default");aG.setCursor("default")}function ax(){aU.disabled=false;aJ()}function bp(){aw.done();aG.activateHandlers(null,null)}function aT(){bd.remove();av.show();av.css("visibility","visible");b(bz).removeData("Jcrop")}function aA(d,c){aw.release();bf();var e=new Image();e.onload=function(){var h=e.width;var i=e.height;var g=aU.boxWidth;var f=aU.boxHeight;aC.width(h).height(i);aC.attr("src",d);aS.attr("src",d);ay(aC,g,f);aE=aC.width();aI=aC.height();aS.width(aE).height(aI);bC.width(aE+(bi*2)).height(aI+(bi*2));bd.width(aE).height(aI);bA.resize(aE,aI);ax();if(typeof(c)==="function"){c.call(bv)}};e.src=d}function bw(c,f,e){var d=f||aU.bgColor;if(aU.bgFade&&a2()&&aU.fadeTime&&!e){c.animate({backgroundColor:d},{queue:false,duration:aU.fadeTime})}else{c.css("backgroundColor",d)}}function aJ(c){if(aU.allowResize){if(c){aw.enableOnly()}else{aw.enableHandles()}}else{aw.disableHandles()}aG.setCursor(aU.allowSelect?"crosshair":"default");aw.setCursor(aU.allowMove?"move":"default");if(aU.hasOwnProperty("trueSize")){aM=aU.trueSize[0]/aE;by=aU.trueSize[1]/aI}if(aU.hasOwnProperty("setSelect")){aQ(aU.setSelect);aw.done();delete (aU.setSelect)}bA.refresh();if(aU.bgColor!=aK){bw(aU.shade?bA.getShades():bd,aU.shade?(aU.shadeColor||aU.bgColor):aU.bgColor);aK=aU.bgColor}if(a9!=aU.bgOpacity){a9=aU.bgOpacity;if(aU.shade){bA.refresh()}else{aw.setBgOpacity(a9)}}be=aU.maxSize[0]||0;aN=aU.maxSize[1]||0;bn=aU.minSize[0]||0;az=aU.minSize[1]||0;if(aU.hasOwnProperty("outerImage")){aC.attr("src",aU.outerImage);delete (aU.outerImage)}aw.refresh()}if(aB.support){bC.bind("touchstart.jcrop",aB.newSelection)}aO.hide();aJ(true);var bv={setImage:aA,animateTo:bj,setSelect:aQ,setOptions:bg,tellSelect:bt,tellScaled:aP,setClass:bs,disable:bf,enable:ax,cancel:bp,release:aw.release,destroy:aT,focus:aF.watchKeys,getBounds:function(){return[aE*aM,aI*by]},getWidgetSize:function(){return[aE,aI]},getScaleFactor:function(){return[aM,by]},getOptions:function(){return aU},ui:{holder:bd,selection:bc}};if(a7){bd.bind("selectstart",function(){return false})}av.data("Jcrop",bv);return bv};b.fn.Jcrop=function(a,e){var f;this.each(function(){if(b(this).data("Jcrop")){if(a==="api"){return b(this).data("Jcrop")}else{b(this).data("Jcrop").setOptions(a)}}else{if(this.tagName=="IMG"){b.Jcrop.Loader(this,function(){b(this).css({display:"block",visibility:"hidden"});f=b.Jcrop(this,a);if(b.isFunction(e)){e.call(f)}})}else{b(this).css({display:"block",visibility:"hidden"});f=b.Jcrop(this,a);if(b.isFunction(e)){e.call(f)}}}});return this};b.Jcrop.Loader=function(i,h,l){var k=b(i),a=k[0];function j(){if(a.complete){k.unbind(".jcloader");if(b.isFunction(h)){h.call(a)}}else{window.setTimeout(j,50)}}k.bind("load.jcloader",j).bind("error.jcloader",function(c){k.unbind(".jcloader");if(b.isFunction(l)){l.call(a)}});if(a.complete&&b.isFunction(h)){k.unbind(".jcloader");h.call(a)}};b.Jcrop.defaults={allowSelect:true,allowMove:true,allowResize:true,trackDocument:true,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:false,borderOpacity:0.4,handleOpacity:0.5,handleSize:null,aspectRatio:0,keySupport:true,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:true,dragEdges:true,fixedSupport:true,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery));