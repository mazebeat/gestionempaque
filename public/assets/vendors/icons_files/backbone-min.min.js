(function(){var ac=this;var aq=ac.Backbone;var am=[];var ae=am.push;var ad=am.slice;var ah=am.splice;var av;if(typeof exports!=="undefined"){av=exports}else{av=ac.Backbone={}}av.VERSION="1.0.0";var an=ac._;if(!an&&typeof require!=="undefined"){an=require("underscore")}av.$=ac.jQuery||ac.Zepto||ac.ender||ac.$;av.noConflict=function(){ac.Backbone=aq;return this};av.emulateHTTP=false;av.emulateJSON=false;var ag=av.Events={on:function(b,d,a){if(!aj(this,"on",b,[d,a])||!d){return this}this._events||(this._events={});var c=this._events[b]||(this._events[b]=[]);c.push({callback:d,context:a,ctx:a||this});return this},once:function(b,f,a){if(!aj(this,"once",b,[f,a])||!f){return this}var d=this;var c=an.once(function(){d.off(b,c);f.apply(this,arguments)});c._callback=f;return this.on(b,c,a)},off:function(v,k,h){var b,w,g,m,d,p,l,j;if(!this._events||!aj(this,"off",v,[k,h])){return this}if(!v&&!k&&!h){this._events={};return this}m=v?[v]:an.keys(this._events);for(d=0,p=m.length;d<p;d++){v=m[d];if(g=this._events[v]){this._events[v]=b=[];if(k||h){for(l=0,j=g.length;l<j;l++){w=g[l];if(k&&k!==w.callback&&k!==w.callback._callback||h&&h!==w.context){b.push(w)}}}if(!b.length){delete this._events[v]}}}return this},trigger:function(b){if(!this._events){return this}var d=ad.call(arguments,1);if(!aj(this,"trigger",b,d)){return this}var a=this._events[b];var c=this._events.all;if(a){at(a,d)}if(c){at(c,arguments)}return this},stopListening:function(b,f,a){var d=this._listeners;if(!d){return this}var c=!f&&!a;if(typeof f==="object"){a=this}if(b){(d={})[b._listenerId]=b}for(var g in d){d[g].off(f,a,this);if(c){delete this._listeners[g]}}return this}};var ab=/\s+/;var aj=function(d,k,c,j){if(!c){return true}if(typeof c==="object"){for(var g in c){d[k].apply(d,[g,c[g]].concat(j))}return false}if(ab.test(c)){var l=c.split(ab);for(var b=0,f=l.length;b<f;b++){d[k].apply(d,[l[b]].concat(j))}return false}return true};var at=function(d,k){var c,j=-1,g=d.length,l=k[0],b=k[1],f=k[2];switch(k.length){case 0:while(++j<g){(c=d[j]).callback.call(c.ctx)}return;case 1:while(++j<g){(c=d[j]).callback.call(c.ctx,l)}return;case 2:while(++j<g){(c=d[j]).callback.call(c.ctx,l,b)}return;case 3:while(++j<g){(c=d[j]).callback.call(c.ctx,l,b,f)}return;default:while(++j<g){(c=d[j]).callback.apply(c.ctx,k)}}};var ap={listenTo:"on",listenToOnce:"once"};an.each(ap,function(a,b){ag[b]=function(g,c,f){var d=this._listeners||(this._listeners={});var h=g._listenerId||(g._listenerId=an.uniqueId("l"));d[h]=g;if(typeof c==="object"){f=this}g[a](c,f,this);return this}});ag.bind=ag.on;ag.unbind=ag.off;an.extend(av,ag);var ar=av.Model=function(b,d){var a;var c=b||{};d||(d={});this.cid=an.uniqueId("c");this.attributes={};an.extend(this,an.pick(d,af));if(d.parse){c=this.parse(c,d)||{}}if(a=an.result(this,"defaults")){c=an.defaults({},c,a)}this.set(c,d);this.changed={};this.initialize.apply(this,arguments)};var af=["url","urlRoot","collection"];an.extend(ar.prototype,ag,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return an.clone(this.attributes)},sync:function(){return av.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return an.escape(this.get(a))},has:function(a){return this.get(a)!=null},set:function(A,p,k){var b,C,h,x,g,y,j,w;if(A==null){return this}if(typeof A==="object"){C=A;k=p}else{(C={})[A]=p}k||(k={});if(!this._validate(C,k)){return false}h=k.unset;g=k.silent;x=[];y=this._changing;this._changing=true;if(!y){this._previousAttributes=an.clone(this.attributes);this.changed={}}w=this.attributes,j=this._previousAttributes;if(this.idAttribute in C){this.id=C[this.idAttribute]}for(b in C){p=C[b];if(!an.isEqual(w[b],p)){x.push(b)}if(!an.isEqual(j[b],p)){this.changed[b]=p}else{delete this.changed[b]}h?delete w[b]:w[b]=p}if(!g){if(x.length){this._pending=true}for(var m=0,v=x.length;m<v;m++){this.trigger("change:"+x[m],this,w[x[m]],k)}}if(y){return this}if(!g){while(this._pending){this._pending=false;this.trigger("change",this,k)}}this._pending=false;this._changing=false;return this},unset:function(a,b){return this.set(a,void 0,an.extend({},b,{unset:true}))},clear:function(b){var c={};for(var a in this.attributes){c[a]=void 0}return this.set(c,an.extend({},b,{unset:true}))},hasChanged:function(a){if(a==null){return !an.isEmpty(this.changed)}return an.has(this.changed,a)},changedAttributes:function(b){if(!b){return this.hasChanged()?an.clone(this.changed):false}var f,a=false;var d=this._changing?this._previousAttributes:this.attributes;for(var c in b){if(an.isEqual(d[c],f=b[c])){continue}(a||(a={}))[c]=f}return a},previous:function(a){if(a==null||!this._previousAttributes){return null}return this._previousAttributes[a]},previousAttributes:function(){return an.clone(this._previousAttributes)},fetch:function(b){b=b?an.clone(b):{};if(b.parse===void 0){b.parse=true}var c=this;var a=b.success;b.success=function(d){if(!c.set(c.parse(d,b),b)){return false}if(a){a(c,d,b)}c.trigger("sync",c,d,b)};D(this,b);return this.sync("read",this,b)},save:function(k,g,f){var b,l,d,h=this.attributes;if(k==null||typeof k==="object"){b=k;f=g}else{(b={})[k]=g}if(b&&(!f||!f.wait)&&!this.set(b,f)){return false}f=an.extend({validate:true},f);if(!this._validate(b,f)){return false}if(b&&f.wait){this.attributes=an.extend({},h,b)}if(f.parse===void 0){f.parse=true}var c=this;var j=f.success;f.success=function(a){c.attributes=h;var i=c.parse(a,f);if(f.wait){i=an.extend(b||{},i)}if(an.isObject(i)&&!c.set(i,f)){return false}if(j){j(c,a,f)}c.trigger("sync",c,a,f)};D(this,f);l=this.isNew()?"create":f.patch?"patch":"update";if(l==="patch"){f.attrs=b}d=this.sync(l,this,f);if(b&&f.wait){this.attributes=h}return d},destroy:function(b){b=b?an.clone(b):{};var f=this;var a=b.success;var d=function(){f.trigger("destroy",f,f.collection,b)};b.success=function(e){if(b.wait||f.isNew()){d()}if(a){a(f,e,b)}if(!f.isNew()){f.trigger("sync",f,e,b)}};if(this.isNew()){b.success();return false}D(this,b);var c=this.sync("delete",this,b);if(!b.wait){d()}return c},url:function(){var a=an.result(this,"urlRoot")||an.result(this.collection,"url")||q();if(this.isNew()){return a}return a+(a.charAt(a.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(a){return this._validate({},an.extend(a||{},{validate:true}))},_validate:function(b,c){if(!c.validate||!this.validate){return true}b=an.extend({},this.attributes,b);var a=this.validationError=this.validate(b,c)||null;if(!a){return true}this.trigger("invalid",this,a,an.extend(c||{},{validationError:a}));return false}});var aa=["keys","values","pairs","invert","pick","omit"];an.each(aa,function(a){ar.prototype[a]=function(){var b=ad.call(arguments);b.unshift(this.attributes);return an[a].apply(an,b)}});var ao=av.Collection=function(a,b){b||(b={});if(b.url){this.url=b.url}if(b.model){this.model=b.model}if(b.comparator!==void 0){this.comparator=b.comparator}this._reset();this.initialize.apply(this,arguments);if(a){this.reset(a,an.extend({silent:true},b))}};var ai={add:true,remove:true,merge:true};var X={add:true,merge:false,remove:false};an.extend(ao.prototype,ag,{model:ar,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return av.sync.apply(this,arguments)},add:function(a,b){return this.set(a,an.defaults(b||{},X))},remove:function(b,f){b=an.isArray(b)?b.slice():[b];f||(f={});var a,d,c,g;for(a=0,d=b.length;a<d;a++){g=this.get(b[a]);if(!g){continue}delete this._byId[g.id];delete this._byId[g.cid];c=this.indexOf(g);this.models.splice(c,1);this.length--;if(!f.silent){f.index=c;g.trigger("remove",g,this,f)}this._removeReference(g)}return this},set:function(E,r){r=an.defaults(r||{},ai);if(r.parse){E=this.parse(E,r)}if(!an.isArray(E)){E=E?[E]:[]}var k,H,y,h,C,j;var x=r.at;var n=this.comparator&&x==null&&r.sort!==false;var w=an.isString(this.comparator)?this.comparator:null;var b=[],A=[],m={};for(k=0,H=E.length;k<H;k++){if(!(y=this._prepareModel(E[k],r))){continue}if(C=this.get(y)){if(r.remove){m[C.cid]=true}if(r.merge){C.set(y.attributes,r);if(n&&!j&&C.hasChanged(w)){j=true}}}else{if(r.add){b.push(y);y.on("all",this._onModelEvent,this);this._byId[y.cid]=y;if(y.id!=null){this._byId[y.id]=y}}}}if(r.remove){for(k=0,H=this.length;k<H;++k){if(!m[(y=this.models[k]).cid]){A.push(y)}}if(A.length){this.remove(A,r)}}if(b.length){if(n){j=true}this.length+=b.length;if(x!=null){ah.apply(this.models,[x,0].concat(b))}else{ae.apply(this.models,b)}}if(j){this.sort({silent:true})}if(r.silent){return this}for(k=0,H=b.length;k<H;k++){(y=b[k]).trigger("add",y,this,r)}if(j){this.trigger("sort",this,r)}return this},reset:function(b,d){d||(d={});for(var a=0,c=this.models.length;a<c;a++){this._removeReference(this.models[a])}d.previousModels=this.models;this._reset();this.add(b,an.extend({silent:true},d));if(!d.silent){this.trigger("reset",this,d)}return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,an.extend({at:this.length},b));return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,an.extend({at:0},b));return a},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){if(a==null){return void 0}return this._byId[a.id!=null?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){if(an.isEmpty(a)){return b?void 0:[]}return this[b?"find":"filter"](function(d){for(var c in a){if(a[c]!==d.get(c)){return false}}return true})},findWhere:function(a){return this.where(a,true)},sort:function(a){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}a||(a={});if(an.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(an.bind(this.comparator,this))}if(!a.silent){this.trigger("sort",this,a)}return this},sortedIndex:function(b,d,a){d||(d=this.comparator);var c=an.isFunction(d)?d:function(e){return e.get(d)};return an.sortedIndex(this.models,b,c,a)},pluck:function(a){return an.invoke(this.models,"get",a)},fetch:function(b){b=b?an.clone(b):{};if(b.parse===void 0){b.parse=true}var c=b.success;var a=this;b.success=function(e){var d=b.reset?"reset":"set";a[d](e,b);if(c){c(a,e,b)}a.trigger("sync",a,e,b)};D(this,b);return this.sync("read",this,b)},create:function(b,d){d=d?an.clone(d):{};if(!(b=this._prepareModel(b,d))){return false}if(!d.wait){this.add(b,d)}var a=this;var c=d.success;d.success=function(e){if(d.wait){a.add(b,d)}if(c){c(b,e,d)}};b.save(null,d);return b},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(b,c){if(b instanceof ar){if(!b.collection){b.collection=this}return b}c||(c={});c.collection=this;var a=new this.model(b,c);if(!a._validate(b,c)){this.trigger("invalid",this,b,c);return false}return a},_removeReference:function(a){if(this===a.collection){delete a.collection}a.off("all",this._onModelEvent,this)},_onModelEvent:function(b,d,a,c){if((b==="add"||b==="remove")&&a!==this){return}if(b==="destroy"){this.remove(d,c)}if(d&&b==="change:"+d.idAttribute){delete this._byId[d.previous(d.idAttribute)];if(d.id!=null){this._byId[d.id]=d}}this.trigger.apply(this,arguments)}});var aw=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];an.each(aw,function(a){ao.prototype[a]=function(){var b=ad.call(arguments);b.unshift(this.models);return an[a].apply(an,b)}});var Z=["groupBy","countBy","sortBy"];an.each(Z,function(a){ao.prototype[a]=function(d,b){var c=an.isFunction(d)?d:function(e){return e.get(d)};return an[a](this.models,c,b)}});var au=av.View=function(a){this.cid=an.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var Y=/^(\S+)\s*(.*)$/;var M=["model","collection","el","id","attributes","className","tagName","events"];an.extend(au.prototype,ag,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,b){if(this.$el){this.undelegateEvents()}this.$el=a instanceof av.$?a:av.$(a);this.el=this.$el[0];if(b!==false){this.delegateEvents()}return this},delegateEvents:function(b){if(!(b||(b=an.result(this,"events")))){return this}this.undelegateEvents();for(var f in b){var a=b[f];if(!an.isFunction(a)){a=this[b[f]]}if(!a){continue}var d=f.match(Y);var c=d[1],g=d[2];a=an.bind(a,this);c+=".delegateEvents"+this.cid;if(g===""){this.$el.on(c,a)}else{this.$el.on(c,g,a)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(a){if(this.options){a=an.extend({},an.result(this,"options"),a)}an.extend(this,an.pick(a,M));this.options=a},_ensureElement:function(){if(!this.el){var a=an.extend({},an.result(this,"attributes"));if(this.id){a.id=an.result(this,"id")}if(this.className){a["class"]=an.result(this,"className")}var b=av.$("<"+an.result(this,"tagName")+">").attr(a);this.setElement(b,false)}else{this.setElement(an.result(this,"el"),false)}}});av.sync=function(b,f,a){var d=ak[b];an.defaults(a||(a={}),{emulateHTTP:av.emulateHTTP,emulateJSON:av.emulateJSON});var c={type:d,dataType:"json"};if(!a.url){c.url=an.result(f,"url")||q()}if(a.data==null&&f&&(b==="create"||b==="update"||b==="patch")){c.contentType="application/json";c.data=JSON.stringify(a.attrs||f.toJSON(a))}if(a.emulateJSON){c.contentType="application/x-www-form-urlencoded";c.data=c.data?{model:c.data}:{}}if(a.emulateHTTP&&(d==="PUT"||d==="DELETE"||d==="PATCH")){c.type="POST";if(a.emulateJSON){c.data._method=d}var h=a.beforeSend;a.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",d);if(h){return h.apply(this,arguments)}}}if(c.type!=="GET"&&!a.emulateJSON){c.processData=false}if(c.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){c.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var g=a.xhr=av.ajax(an.extend(c,a));f.trigger("request",f,g,a);return g};var ak={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};av.ajax=function(){return av.$.ajax.apply(av.$,arguments)};var B=av.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var W=/\((.*?)\)/g;var z=/(\(\?)?:\w+/g;var L=/\*\w+/g;var V=/[\-{}\[\]+?.,\\\^$|#\s]/g;an.extend(B.prototype,ag,{initialize:function(){},route:function(b,d,a){if(!an.isRegExp(b)){b=this._routeToRegExp(b)}if(an.isFunction(d)){a=d;d=""}if(!a){a=this[d]}var c=this;av.history.route(b,function(e){var f=c._extractParameters(b,e);a&&a.apply(c,f);c.trigger.apply(c,["route:"+d].concat(f));c.trigger("route",d,f);av.history.trigger("route",c,d,f)});return this},navigate:function(a,b){av.history.navigate(a,b);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=an.result(this,"routes");var a,b=an.keys(this.routes);while((a=b.pop())!=null){this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(V,"\\$&").replace(W,"(?:$1)?").replace(z,function(b,c){return c?b:"([^/]+)"}).replace(L,"(.*?)");return new RegExp("^"+a+"$")},_extractParameters:function(b,c){var a=b.exec(c).slice(1);return an.map(a,function(d){return d?decodeURIComponent(d):null})}});var K=av.History=function(){this.handlers=[];an.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var J=/^[#\/]|\s+$/g;var F=/^\/+|\/+$/g;var G=/msie [\w.]+/;var Q=/\/$/;K.started=false;an.extend(K.prototype,ag,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(b,c){if(b==null){if(this._hasPushState||!this._wantsHashChange||c){b=this.location.pathname;var a=this.root.replace(Q,"");if(!b.indexOf(a)){b=b.substr(a.length)}}else{b=this.getHash()}}return b.replace(J,"")},start:function(b){if(K.started){throw new Error("Backbone.history has already been started")}K.started=true;this.options=an.extend({},{root:"/"},this.options,b);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var f=this.getFragment();var a=document.documentMode;var d=G.exec(navigator.userAgent.toLowerCase())&&(!a||a<=7);this.root=("/"+this.root+"/").replace(F,"/");if(d&&this._wantsHashChange){this.iframe=av.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(f)}if(this._hasPushState){av.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&"onhashchange" in window&&!d){av.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=f;var c=this.location;var g=c.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&g&&c.hash){this.fragment=this.getHash().replace(J,"");this.history.replaceState({},document.title,this.root+this.fragment+c.search)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){av.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);K.started=false},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();if(b===this.fragment&&this.iframe){b=this.getFragment(this.getHash(this.iframe))}if(b===this.fragment){return false}if(this.iframe){this.navigate(b)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(b){var c=this.fragment=this.getFragment(b);var a=an.any(this.handlers,function(d){if(d.route.test(c)){d.callback(c);return true}});return a},navigate:function(b,c){if(!K.started){return false}if(!c||c===true){c={trigger:c}}b=this.getFragment(b||"");if(this.fragment===b){return}this.fragment=b;var a=this.root+b;if(this._hasPushState){this.history[c.replace?"replaceState":"pushState"]({},document.title,a)}else{if(this._wantsHashChange){this._updateHash(this.location,b,c.replace);if(this.iframe&&b!==this.getFragment(this.getHash(this.iframe))){if(!c.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,b,c.replace)}}else{return this.location.assign(a)}}if(c.trigger){this.loadUrl(b)}},_updateHash:function(b,d,a){if(a){var c=b.href.replace(/(javascript:|#).*$/,"");b.replace(c+"#"+d)}else{b.hash="#"+d}}});av.history=new K;var al=function(b,f){var a=this;var d;if(b&&an.has(b,"constructor")){d=b.constructor}else{d=function(){return a.apply(this,arguments)}}an.extend(d,a,f);var c=function(){this.constructor=d};c.prototype=a.prototype;d.prototype=new c;if(b){an.extend(d.prototype,b)}d.__super__=a.prototype;return d};ar.extend=ao.extend=B.extend=au.extend=K.extend=al;var q=function(){throw new Error('A "url" property or function must be specified')};var D=function(b,c){var a=c.error;c.error=function(d){if(a){a(b,d,c)}b.trigger("error",b,d,c)}}}).call(this);