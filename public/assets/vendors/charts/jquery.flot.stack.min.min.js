(function(b){function c(f){function d(j,h){var k=null;for(var i=0;i<h.length;++i){if(j==h[i]){break}h[i].stack==j.stack&&(k=h[i])}return k}function g(V,L,I){if(L.stack==null||L.stack===!1){return}var P=d(L,V.getData());if(!P){return}var G=I.pointsize,K=I.points,D=P.datapoints.pointsize,Z=P.datapoints.points,U=[],O,X,Q,J,W,B,M=L.lines.show,R=L.bars.horizontal,t=G>2&&(R?I.format[2].x:I.format[2].y),Y=M&&L.lines.steps,A=!0,F=R?1:0,k=R?0:1,z=0,j=0,q,H;for(;;){if(z>=K.length){break}q=U.length;if(K[z]==null){for(H=0;H<G;++H){U.push(K[z+H])}z+=G}else{if(j>=Z.length){if(!M){for(H=0;H<G;++H){U.push(K[z+H])}}z+=G}else{if(Z[j]==null){for(H=0;H<G;++H){U.push(null)}A=!0,j+=D}else{O=K[z+F],X=K[z+k],J=Z[j+F],W=Z[j+k],B=0;if(O==J){for(H=0;H<G;++H){U.push(K[z+H])}U[q+k]+=W,B=W,z+=G,j+=D}else{if(O>J){if(M&&z>0&&K[z-G]!=null){Q=X+(K[z-G+k]-X)*(J-O)/(K[z-G+F]-O),U.push(J),U.push(Q+W);for(H=2;H<G;++H){U.push(K[z+H])}B=W}j+=D}else{if(A&&M){z+=G;continue}for(H=0;H<G;++H){U.push(K[z+H])}M&&j>0&&Z[j-D]!=null&&(B=W+(Z[j-D+k]-W)*(O-J)/(Z[j-D+F]-J)),U[q+k]+=B,z+=G}}A=!1,q!=U.length&&t&&(U[q+2]+=B)}}}if(Y&&q!=U.length&&q>0&&U[q]!=null&&U[q]!=U[q-G]&&U[q+1]!=U[q-G+1]){for(H=0;H<G;++H){U[q+G+H]=U[q+H]}U[q+1]=U[q-G+1]}}I.points=U}f.hooks.processDatapoints.push(g)}var a={series:{stack:null}};b.plot.plugins.push({init:c,options:a,name:"stack",version:"1.2"})})(jQuery);