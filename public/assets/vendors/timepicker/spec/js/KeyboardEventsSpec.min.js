describe("Keyboard events feature",function(){var i,h,g,f,e,d,c,b,a;beforeEach(function(){loadFixtures("timepicker.html");i=$("#timepicker1");f=i.timepicker();c=f.data("timepicker");h=$("#timepicker2");e=h.timepicker({template:"modal",showSeconds:true,minuteStep:30,secondStep:30,defaultTime:false});b=e.data("timepicker");g=$("#timepicker3");d=g.timepicker({defaultTime:"23:15:20",showMeridian:false,showSeconds:true,template:false});a=d.data("timepicker")});afterEach(function(){i.data("timepicker").remove();h.data("timepicker").remove();g.data("timepicker").remove();i.remove();h.remove();g.remove()});it("should be able to set time via input",function(){i.trigger("focus");i.autotype("{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}9:45a{{tab}}");expect(c.highlightedUnit).not.toBe("minute");expect(c.getTime()).toBe("9:45 AM");expect(i.is(":focus")).toBe(false)});it("should be able to control element by the arrow keys",function(){c.setTime("11:30 AM");c.update();i.trigger("focus");if(c.highlightedUnit!=="hour"){c.highlightHour()}expect(c.highlightedUnit).toBe("hour","hour should be highlighted by default");i.trigger({type:"keydown",keyCode:38});expect(c.getTime()).toBe("12:30 PM","1");i.trigger({type:"keydown",keyCode:40});expect(c.getTime()).toBe("11:30 AM","2");expect(c.highlightedUnit).toBe("hour","hour should be highlighted");i.trigger({type:"keydown",keyCode:39});expect(c.highlightedUnit).toBe("minute","minute should be highlighted");i.trigger({type:"keydown",keyCode:38});expect(c.getTime()).toBe("11:45 AM","3");expect(c.highlightedUnit).toBe("minute","minute should be highlighted 1");i.trigger({type:"keydown",keyCode:40});expect(c.getTime()).toBe("11:30 AM","4");expect(c.highlightedUnit).toBe("minute","minute should be highlighted 2");i.trigger({type:"keydown",keyCode:39});expect(c.highlightedUnit).toBe("meridian","meridian should be highlighted");i.trigger({type:"keydown",keyCode:38});expect(c.getTime()).toBe("11:30 PM","5");expect(c.highlightedUnit).toBe("meridian","meridian should be highlighted");i.trigger({type:"keydown",keyCode:40});expect(c.getTime()).toBe("11:30 AM","6");expect(c.highlightedUnit).toBe("meridian","meridian should be highlighted");i.trigger({type:"keydown",keyCode:37});expect(c.highlightedUnit).toBe("minute","minutes should be highlighted");i.trigger({type:"keydown",keyCode:40});expect(c.getTime()).toBe("11:15 AM","7");i.trigger({type:"keydown",keyCode:37});expect(c.highlightedUnit).toBe("hour","hours should be highlighted");i.trigger({type:"keydown",keyCode:40});expect(c.getTime()).toBe("10:15 AM","8");i.trigger({type:"keydown",keyCode:37});expect(c.highlightedUnit).toBe("meridian","meridian should be highlighted");i.trigger({type:"keydown",keyCode:40});expect(c.getTime()).toBe("10:15 PM","9")});it("should be able to change time via widget inputs in a dropdown",function(){var k=c.$widget.find("input.bootstrap-timepicker-hour"),j=c.$widget.find("input.bootstrap-timepicker-minute"),l=c.$widget.find("input.bootstrap-timepicker-meridian"),n=0,m;c.setTime("9:30 AM");i.parents("div").find(".add-on").click();i.timepicker().on("changeTime.timepicker",function(o){n++;m=o.time.value});expect(c.isOpen).toBe(true,"dropdown should be open");expect(c.getTime()).toBe("9:30 AM","should be default time");k.trigger("focus");expect(n).toBe(0,"event count should be 0");k.autotype("{{back}}{{back}}11{{tab}}");expect(c.getTime()).toBe("11:30 AM");expect(n).toBe(4,"incorrect update events thrown");expect(m).toBe("11:30 AM","event throwing wrong time");j.autotype("{{back}}{{back}}45{{tab}}");expect(c.minute).toBe(45);expect(n).toBe(8,"incorrect update events thrown");expect(m).toBe("11:45 AM");l.autotype("{{back}}{{back}}pm{{tab}}");expect(c.meridian).toBe("PM");expect(n).toBe(12,"incorrect update events thrown");expect(m).toBe("11:45 PM")});it("should still be empty if input is empty",function(){i.autotype("{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}{{tab}}");expect(i.val()).toBe("")});it("should allow time to be changed via widget inputs in a modal",function(){b.setTime("9:30 AM");b.update();h.parents("div").find(".add-on").click();var k=$("body").find("input.bootstrap-timepicker-hour"),j=$("body").find("input.bootstrap-timepicker-minute"),m=$("body").find("input.bootstrap-timepicker-second"),l=$("body").find("input.bootstrap-timepicker-meridian");k.autotype("{{back}}{{back}}2{{tab}}");expect(b.getTime()).toBe("2:30:00 AM");j.autotype("{{back}}{{back}}0{{tab}}");expect(b.getTime()).toBe("2:00:00 AM");m.autotype("{{back}}{{back}}30{{tab}}");expect(b.getTime()).toBe("2:00:30 AM");l.autotype("{{back}}{{back}}p{{tab}}");expect(b.getTime()).toBe("2:00:30 PM")});it("should be 12:00 AM if 00:00 AM is entered",function(){i.autotype("{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}0:0 AM{{tab}}");expect(c.getTime()).toBe("1:00 AM")});it("should validate input",function(){var k=c.$widget.find("input.bootstrap-timepicker-hour"),j=c.$widget.find("input.bootstrap-timepicker-minute"),m=c.$widget.find("input.bootstrap-timepicker-meridian"),l=a.$element;c.setTime("11:30 AM");c.update();k.autotype("{{back}}{{back}}10{{tab}}");expect(c.getTime()).toBe("10:30 AM");j.autotype("{{back}}{{back}}60{{tab}}");expect(c.getTime()).toBe("10:59 AM");m.autotype("{{back}}{{back}}dk{{tab}}");expect(c.getTime()).toBe("10:59 AM");m.autotype("{{back}}{{back}}p{{tab}}");expect(c.getTime()).toBe("10:59 PM");l.autotype("{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}{{back}}25:60:60{{tab}}");expect(a.getTime()).toBe("23:59:59")})});