window.parent.frames.left.highlightCollection(currentCollection,currentRecordsCount);function r_pad_zero(d,c){if(typeof(c)=="undefined"){c=2}var e=""+d;var a=e.length;if(a<c){for(var b=0;b<c-a;b++){e="0"+e}}return e}function showOperationButtons(b){var a=$("#object_"+b);a.css("background-color","#eeefff")}function hideOperationButtons(b){var a=$("#object_"+b);a.css("background-color","#fff");a.css("border","0")}function expandText(b){var a=$("#text_"+b);if(a.attr("expand")=="true"){a.css("height","");a.css("max-height",150);a.attr("expand","false");$("#expand_"+b).html("Expand")}else{a.css("height",a[0].scrollHeight);a.css("max-height",a[0].scrollHeight);a.attr("expand","true");$("#expand_"+b).html("Collapse")}}function changeCommand(a){var b=a.value;if(b=="modify"){$("#newobjInput").show()}else{$("#newobjInput").hide()}if(b=="findAll"){$("#limitLabel").show();$("#pageSetLabel").show();$("#fieldsAndHints").show()}else{$("#limitLabel").hide();$("#pageSetLabel").hide();$("#fieldsAndHints").hide()}}function changeText(c){var a=$("#text_"+c);var b=$("#field_"+c);if(a.is(":visible")){a.hide();b.show()}else{a.show();b.hide()}}function explainQuery(a){var b=$(a).serialize().replace(/\baction=[\w\.]+/,"");jQuery.ajax({data:b,success:function(d,e,c){$("#records").html(d)},url:explainURL,type:"POST"})}function showMoreMenus(a){var b=$(a);setManualPosition(".menu",b.position().left,b.position().top+b.height()+4)}function setManualPosition(c,a,d){if($(c).is(":visible")){$(c).hide()}else{var b='$("'+c+'").show().css("left", '+a+" - 2)";if(d){b+='.css("top", '+d+")"}window.setTimeout(b,100);$(c).find("a").click(function(){hideMenus()})}}function hideMenus(){$(".menu").hide()}function showQueryFields(b){var a=$("#query_fields_list");a.show();a.css("left",$(b).position().left);a.css("top",$(b).position().top+$(b).height()+3)}function closeQueryFields(){$("#query_fields_list").hide();$("#query_fields_count").html(countChecked("query_fields[]"))}function showQueryHints(b){var a=$("#query_hints_list");a.show();a.css("left",$(b).position().left);a.css("top",$(b).position().top+$(b).height()+3)}function closeQueryHints(){$("#query_hints_list").hide();$("#query_hints_count").html($(".query_hints:checked").length)}function countChecked(a){var c=document.getElementsByName(a);var d=0;for(var b=0;b<c.length;b++){if(c[b].checked){d++}}return d}function showFieldOperations(c,e){var c=$(c);var f=$("#field_menu");setManualPosition("#field_menu",c.position().left,c.position().top+c.height());var b=c.parent();while(!b.is(".record_row")){b=b.parent()}if(e=="_id"){f.children().hide();f.find(".field_op_query").show();f.find(".field_op_query span").show();f.find(".field_op_indexes").show();f.find(".field_op_sort").show()}else{f.children().show();var d=$("[name='query_fields[]']");d.each(function(){var g=$(this);if(g.val()==e){if(g.is(":checked")){f.find(".field_op_show").hide()}else{f.find(".field_op_show").show()}return false}});f.find(".field_op_hide_show_seperator").show();f.find(".field_op_hide").show()}var a=f.find("a");a.attr("record_id",b.attr("record_id"));a.attr("field",e);a.attr("record_index",b.attr("record_index"))}function initFieldMenu(){$(".record_row font").dblclick(function(){return false});$(".record_row span").dblclick(function(){return false});$(".record_row span.field").click(function(){$(".menu_arrow").remove();$(".record_row span.field").css("background-color","");var a=$(this);a.css("background-color","#ccc");a.after('<a href="#" style="font-size:11px;" title="Field Operations" onclick="showFieldOperations(this,\''+a.attr("field")+'\');return false" class="menu_arrow">▼</a>')})}function initDataMenu(){$(".string_var").click(function(){var a=$(this);var c=a.text();var b;if(b=c.match(/^"(\w+:\/\/.+)"$/)){a.next("a").remove();a.after('<a href="#" style="font-size:11px;" title="View AS" onclick="showDataMenu(this,\''+escape(b[1])+'\');return false" class="menu_arrow">▼</a>')}else{if(b=c.match(/^"([\w\._]+@[\w\.-]+)"$/)){a.after('<a href="#" style="font-size:11px;" title="View AS" onclick="showDataMenu(this,\''+escape(b[1])+'\');return false" class="menu_arrow">▼</a>')}}});$(".no_string_var").click(function(){var a=$(this);var b=a.text();if(b.match(/^[\d\.]+$/)){a.next("a").remove();a.after('<a href="#" style="font-size:11px;" title="View AS" onclick="showDataMenu(this,\''+escape(b)+'\');return false" class="menu_arrow">▼</a>')}})}function showDataMenu(h,j){var h=$(h);var j=unescape(j);var c=[];var b=100;if(j.match(/^[\d\.]+$/)){var d=parseFloat(j);c.push("ToK: "+(Math.round(d/1024*100)/100)+"K");c.push("ToM: "+(Math.round(d/1024/1024*100)/100)+"M");c.push("ToG: "+(Math.round(d/1024/1024/1024*100)/100)+"G");if(j.length>=10){var f=new Date();if(j.length>=13){f.setTime(d*1)}else{f.setTime(d*1000)}c.push("ToDate: "+f.getFullYear()+"-"+r_pad_zero(f.getMonth()+1,2)+"-"+r_pad_zero(f.getDate(),2)+" "+r_pad_zero(f.getHours(),2)+":"+r_pad_zero(f.getMinutes(),2)+":"+r_pad_zero(f.getSeconds(),2));b=200}}if(j.match(/^\w+:\/\/.+$/)){c.push('<a href="'+j+'" target="_blank">Go to URI</a>');if(j.match(/\.(gif|jpg|png)$/i)){c.push('<br/><a href="'+j+'" target="_blank"><img src="'+j+'" style="width:100px"/></a>')}}if(j.match(/^([\w\._]+@[\w\.-]+)$/)){c.push('<a href="mailto:'+j+'" target="_blank">Send Mail</a>')}if(c.length>0){$("#data_menu").remove();var a='<div class="menu" id="data_menu">';for(var g=0;g<c.length;g++){a+=c[g]+"<br/>"}a+="</div>";$(document.body).append(a)[0];var e=$("#data_menu");e.css("left",h.position().left+10);e.css("top",h.position().top);e.css("width",b);e.css("overflow","auto");setTimeout(function(){$("#data_menu").show()},100)}}$(function(){$(document).click(function(a){hideMenus();$("#field_menu").hide();if(a.target.tagName=="DIV"||a.target.tagName=="P"){closeQueryFields();closeQueryHints()}});$(".field_orders").find("input[name='field[]']").autocomplete({source:currentFields,delay:100});initFieldMenu();initDataMenu()});function refreshRecord(g,a){var f=$("#text_"+a);var d=$("#field_"+a);f.text("loading ...");var e={id:g,db:currentDb,collection:currentCollection,format:currentFormat};var c=$("input[name='query_fields[]']:checked");for(var b=0;b<c.length;b++){e["query_fields["+b+"]"]=$(c[b]).val()}jQuery.ajax({type:"POST",url:"index.php?action=collection.record",data:e,success:function(h){if(h.code==200){f.html(h.html);d.find("textarea").val(h.data);initFieldMenu();initDataMenu()}else{f.text(h.message)}},dataType:"json"})}function switchDataType(b,a){b.find("[name='data_type']").val(a);b.find("select[name='format']").hide();b.find(".value").hide();b.find(".bool_value").hide();b.find(".double_value").hide();b.find(".integer_value").hide();b.find(".long_value").hide();b.find(".mixed_value").hide();switch(a){case"integer":b.find(".integer_value").show();break;case"long":b.find(".long_value").show();break;case"float":case"double":b.find(".double_value").show();break;case"string":b.find(".value").show();break;case"boolean":b.find(".bool_value").show();break;case"null":break;case"mixed":b.find("select[name='format']").show();b.find(".mixed_value").show();break}}function setValueWithData(d,c){var a=c.type;var b=c.value;switch(a){case"integer":d.find("[name='integer_value']").val(b);break;case"long":d.find("[name='long_value']").val(b);break;case"float":case"double":d.find("[name='double_value']").val(b);break;case"string":d.find("[name='value']").val(b);break;case"boolean":d.find("[name='bool_value']").val(b?"true":"false");break;case"null":break;case"mixed":d.find("[name='mixed_value']").val(c.represent);break}}function switchDataTypes(b){var b=$(b);var a=b.find("[name='data_type']");switchDataType(b,a.val());a.change(function(){switchDataType(b,this.value)})}function escapeRegexp(a){a=a.replace(/\./,"\\.");return a}function fieldOpHide(c){var c=$(c);var d=c.attr("field");var b=0;$("[name='query_fields[]']").each(function(){var e=$(this);if(e.is(":checked")){b++}});var a=new RegExp("^"+escapeRegexp(d)+".");if(b==0){$("[name='query_fields[]']").each(function(){var e=$(this);if(e.val()!=d&&!e.val().match(a)){e.attr("checked","checked")}})}else{$("[name='query_fields[]']").each(function(){var e=$(this);if(e.val()==d||e.val().match(a)){e.attr("checked","")}})}closeQueryFields();$("#query_form").submit()}function fieldOpShow(a){var a=$(a);var b=a.attr("field");$("[name='query_fields[]']").each(function(){var c=$(this);if(c.val()==b){c.attr("checked","checked")}});closeQueryFields();$("#query_form").submit()}function fieldOpQuery(a){var a=$(a);var c=a.attr("record_id");var b=a.attr("field");fieldOpLoad(b,c,function(e){var d={};var g=$("#field_dialog_query");var f=e.format;if(f=="json"){g.find("[name='field_criteria']").val('{\n\t"'+b+'": '+e.represent+"\n}")}else{g.find("[name='field_criteria']").val('array(\n\t"'+b+'" => '+e.represent+",\n);")}d.Query=function(){$("textarea[name='criteria']").val(g.find("[name='field_criteria']").val());$("#query_form").find("input[name='format']").val(g.find("select[name='format']").val());$("#query_form").submit();$(this).dialog("close")};d.Cancel=function(){$(this).dialog("close")};g.dialog({modal:true,title:'Query on field "'+b+'"',buttons:d,width:420,open:function(){$(".ui-widget-overlay").unbind("click").click(function(){if($(this).closest(".ui-dialog").length==0){g.dialog("close")}})}})})}function fieldOpNew(c,f,d,a){if(c){var c=$(c);var f=c.attr("record_id");var d=c.attr("field");var a=c.attr("record_index")}var b={};var e=$("#field_dialog_new");switchDataTypes(e);if(typeof(d)!="undefined"&&d.length>0){e.find("input[name='newname']").val(d+".")}else{e.find("input[name='newname']").val("")}if(f){b.Apply=function(){jQuery.ajax({data:{id:f,db:currentDb,collection:currentCollection,newname:e.find("input[name='newname']").val(),keep:e.find("input[name='keep']:checked").val(),data_type:e.find("[name='data_type']").val(),value:e.find("[name='value']").val(),integer_value:e.find("[name='integer_value']").val(),long_value:e.find("[name='long_value']").val(),double_value:e.find("[name='double_value']").val(),bool_value:e.find("[name='bool_value']").val(),mixed_value:e.find("[name='mixed_value']").val(),format:e.find("[name='format']").val()},success:function(h,i,g){if(h.code!=200){alert(h.message)}else{e.dialog("close");if(typeof(a)!="undefined"){refreshRecord(f,a)}else{window.location.reload()}}},url:"index.php?action=field.new",type:"POST",dataType:"json"})}}b["Apply to all"]=function(){if(!window.confirm("The changes will be applied to all records")){return}jQuery.ajax({data:{id:"",db:currentDb,collection:currentCollection,newname:e.find("input[name='newname']").val(),keep:e.find("input[name='keep']:checked").val(),data_type:e.find("[name='data_type']").val(),value:e.find("[name='value']").val(),integer_value:e.find("[name='integer_value']").val(),long_value:e.find("[name='long_value']").val(),double_value:e.find("[name='double_value']").val(),bool_value:e.find("[name='bool_value']").val(),mixed_value:e.find("[name='mixed_value']").val(),format:e.find("[name='format']").val()},success:function(h,i,g){if(h.code!=200){alert(h.message)}else{e.dialog("close");window.location.reload()}},url:"index.php?action=field.new",type:"POST",dataType:"json"})};b.Cancel=function(){$(this).dialog("close")};e.dialog({modal:true,title:"Add new field",buttons:b,width:450,open:function(){$(".ui-widget-overlay").unbind("click").click(function(){if($(this).closest(".ui-dialog").length==0){e.dialog("close")}})}})}function fieldOpLoad(b,c,a){jQuery.ajax({data:{id:c,db:currentDb,collection:currentCollection,field:b},success:function(e,f,d){if(e.code!=200){alert(e.message)}else{a(e)}},url:"index.php?action=field.load",type:"POST",dataType:"json"})}function fieldOpUpdate(b,d,c,a){if(b){var b=$(b);var d=b.attr("record_id");var c=b.attr("field");var a=b.attr("record_index")}fieldOpLoad(c,d,function(f){var e={};var g=$("#field_dialog_update");switchDataTypes(g);switchDataType(g,f.type);setValueWithData(g,f);g.find("input[name='newname']").val(c);if(d){e.Apply=function(){jQuery.ajax({data:{id:d,db:currentDb,collection:currentCollection,newname:g.find("input[name='newname']").val(),data_type:g.find("[name='data_type']").val(),value:g.find("[name='value']").val(),integer_value:g.find("[name='integer_value']").val(),long_value:g.find("[name='long_value']").val(),double_value:g.find("[name='double_value']").val(),bool_value:g.find("[name='bool_value']").val(),mixed_value:g.find("[name='mixed_value']").val(),format:g.find("[name='format']").val()},success:function(i,j,h){if(i.code!=200){alert(i.message)}else{g.dialog("close");if(typeof(a)!="undefined"){refreshRecord(d,a)}else{window.location.reload()}}},url:"index.php?action=field.update",type:"POST",dataType:"json"})}}e["Apply to all"]=function(){if(!window.confirm("The changes will be applied to all records")){return}jQuery.ajax({data:{id:"",db:currentDb,collection:currentCollection,newname:g.find("input[name='newname']").val(),data_type:g.find("[name='data_type']").val(),value:g.find("[name='value']").val(),integer_value:g.find("[name='integer_value']").val(),long_value:g.find("[name='long_value']").val(),double_value:g.find("[name='double_value']").val(),bool_value:g.find("[name='bool_value']").val(),mixed_value:g.find("[name='mixed_value']").val(),format:g.find("[name='format']").val()},success:function(i,j,h){if(i.code!=200){alert(i.message)}else{g.dialog("close");window.location.reload()}},url:"index.php?action=field.update",type:"POST",dataType:"json"})};e.Cancel=function(){$(this).dialog("close")};g.dialog({modal:true,title:'Modify field "'+c+'" value',buttons:e,width:450,open:function(){$(".ui-widget-overlay").unbind("click").click(function(){if($(this).closest(".ui-dialog").length==0){g.dialog("close")}})}})})}function fieldOpRename(c){var c=$(c);var d=c.attr("field");var f=c.attr("record_id");var a=c.attr("record_index");$(".dialog_field").html(d);var e=$("#field_dialog_rename");var b={};if(f){b.Apply=function(){jQuery.ajax({data:{id:f,field:d,db:currentDb,collection:currentCollection,newname:e.find("input[name='newname']").val(),keep:e.find("input[name='keep']:checked").val()},success:function(h,i,g){if(h.code!=200){alert(h.message)}else{e.dialog("close");if(typeof(a)!="undefined"){refreshRecord(f,a)}else{window.location.reload()}}},url:"index.php?action=field.rename",type:"POST",dataType:"json"})}}b["Apply to all"]=function(){if(!window.confirm("The changes will be applied to all records")){return}jQuery.ajax({data:{id:"",field:d,db:currentDb,collection:currentCollection,newname:e.find("input[name='newname']").val(),keep:e.find("input[name='keep']:checked").val()},success:function(h,i,g){if(h.code!=200){alert(h.message)}else{e.dialog("close");window.location.reload()}},url:"index.php?action=field.rename",type:"POST",dataType:"json"})};b.Cancel=function(){$(this).dialog("close")};e.dialog({modal:true,title:'Rename field "'+d+'"',buttons:b,width:420,open:function(){$(".ui-widget-overlay").unbind("click").click(function(){if($(this).closest(".ui-dialog").length==0){e.dialog("close")}})}})}function fieldOpRemove(c){var c=$(c);var d=c.attr("field");var f=c.attr("record_id");var a=c.attr("record_index");var e=$("#field_dialog_remove");$(".dialog_field").html(d);var b={};if(f){b.Apply=function(){jQuery.ajax({data:{id:f,field:d,db:currentDb,collection:currentCollection},success:function(h,i,g){e.dialog("close");if(typeof(a)!="undefined"){refreshRecord(f,a)}else{window.location.reload()}},url:"index.php?action=field.remove",type:"POST"})}}b["Apply to all"]=function(){if(!window.confirm("The changes will be applied to all records")){return}jQuery.ajax({data:{id:"",field:d,db:currentDb,collection:currentCollection},success:function(h,i,g){e.dialog("close");window.location.reload()},url:"index.php?action=field.remove",type:"POST"})};b.Cancel=function(){$(this).dialog("close")};e.dialog({modal:true,title:'Remove field "'+d+'"',buttons:b,width:420,open:function(){$(".ui-widget-overlay").unbind("click").click(function(){if($(this).closest(".ui-dialog").length==0){e.dialog("close")}})}})}function fieldOpClear(c){var c=$(c);var d=c.attr("field");var f=c.attr("record_id");var a=c.attr("record_index");var e=$("#field_dialog_clear");$(".dialog_field").html(d);var b={};if(f){b.Apply=function(){jQuery.ajax({data:{id:f,field:d,db:currentDb,collection:currentCollection},success:function(h,i,g){e.dialog("close");if(typeof(a)!="undefined"){refreshRecord(f,a)}else{window.location.reload()}},url:"index.php?action=field.clear",type:"POST"})}}b["Apply to all"]=function(){if(!window.confirm("The changes will be applied to all records")){return}jQuery.ajax({data:{id:"",field:d,db:currentDb,collection:currentCollection},success:function(h,i,g){e.dialog("close");window.location.reload()},url:"index.php?action=field.clear",type:"POST"})};b.Cancel=function(){$(this).dialog("close")};e.dialog({modal:true,title:'Clear field "'+d+'"',buttons:b,width:420,open:function(){$(".ui-widget-overlay").unbind("click").click(function(){if($(this).closest(".ui-dialog").length==0){e.dialog("close")}})}})}function fieldOpIndexes(a){var a=$(a);var b=a.attr("field");var c=$("#field_dialog_indexes");c.find(".dialog_field").html(b);c.find(".first_field").val(b);c.find("#fields").html("");c.find("[name='name']").val(b);c.find("[name='field[]']").autocomplete({source:currentFields,delay:100});jQuery.ajax({data:{field:b,db:currentDb,collection:currentCollection},success:function(j,k,h){var f=c.find(".indexes");f.html("");if(j.indexes.length==0){c.find(".indexes_table").hide()}else{c.find(".indexes_table").show();for(var e in j.indexes){var d=j.indexes[e];f.append('<tr bgcolor="#ffffff"><td valign="top">'+d.name+'</td><td valign="top">'+d.key+"</td></tr>")}}var g={};g.Create=function(){var o={};o.db=currentDb;o.collection=currentCollection;o.name=c.find("[name='name']").val();o.is_unique=c.find("[name='is_unique']:checked").val();o.drop_duplicate=c.find("[name='drop_duplicate']:checked").val();var l=c.find("[name='field[]']");for(var m=0;m<l.length;m++){o["field["+m+"]"]=$(l[m]).val()}var n=c.find("[name='order[]']");for(var m=0;m<n.length;m++){o["order["+m+"]"]=$(n[m]).val()}jQuery.ajax({url:"index.php?action=field.createIndex",type:"POST",dataType:"json",data:o,success:function(i){if(i.code!=200){alert(i.message)}else{setTimeout(function(){fieldOpIndexes(a)},300)}}})};g.Cancel=function(){$(this).dialog("close")};c.dialog({modal:true,title:'Indexes on field "'+b+'"',buttons:g,width:450,open:function(){$(".ui-widget-overlay").unbind("click").click(function(){if($(this).closest(".ui-dialog").length==0){c.dialog("close")}})}})},url:"index.php?action=field.indexes",type:"POST",dataType:"json"})}function fieldOpMore(a,b){fieldOpUpdate(null,b,a)}function fieldOpSort(k,e){var k=$(k);var l=k.attr("field");var a=window.location.toString();var d=a.split("?",2);if(d.length==1){window.location=a+"&field[]="+l+"&order[]="+e}else{var f=d[1].split("&");var n="";var m=0;var b=0;var j=0;for(var g in f){var c=f[g];var h=c.split("=",2);if(h.length==2){if(decodeURI(h[0]).match(new RegExp("^field\\[\\d*\\]$"))){m++;if(h[1]!=l){n+="&field[]="+h[1]}else{j=m}}else{if(decodeURI(h[0]).match(new RegExp("^order\\[\\d*\\]$"))){b++;if(b!=j){n+="&order[]="+h[1]}}else{n+="&"+c}}}}window.location=d[0]+"?field[]="+l+"&order[]="+e+n}}function addNewField(){$("#fields").append('<p style="margin:0;padding:0"><input type="text" name="field[]"/> <select name="order[]"><option value="asc">ASC</option><option value="desc">DESC</option></select> <input type="button" value="+" onclick="addNewField()"/><input type="button" value="-" onclick="removeNewField(this)"/></p>');$("#fields").find("[name='field[]']").autocomplete({source:currentFields,delay:100})}function removeNewField(a){$(a).parent().remove()}function clickUniqueKey(a){if(a.checked){$("#duplicate_tr").show()}else{$("#duplicate_tr").hide()}}function showQueryHistory(){var b=$("#field_dialog_history");var a={Clear:function(){if(window.confirm("Are you sure to clear all the query history?")){jQuery.ajax({data:{db:currentDb,collection:currentCollection},dataType:"json",url:"index.php?action=collection.clearQueryHistory",success:function(c){if(c.code==200){b.find(".no_history").show();b.find(".has_history").hide()}else{alert('Fail to clear query history. Please check directory "$rockmongo/logs/" permission.')}}})}},Close:function(){$(this).dialog("close")}};jQuery.ajax({data:{db:currentDb,collection:currentCollection},dataType:"html",url:"index.php?action=collection.queryHistory",success:function(c){b.html(c);b.dialog({modal:true,title:"Query History",buttons:a,width:450,open:function(d,e){$("button").blur();$(".ui-widget-overlay").unbind("click").click(function(){if($(this).closest(".ui-dialog").length==0){b.dialog("close")}})}})}})}function switchDataFormat(b,a){$.ajax({data:{data:$(b).val(),format:a.value},url:"index.php?action=collection.switchFormat&db="+currentDb+"&collection="+currentCollection,type:"POST",dataType:"json",success:function(c){$(b).val(c.data)}})}function showMoreDocMenus(c,b){var e=$(c);var d=".doc_menu_"+b;var a=e.position().left;var f=e.position().top+e.height()+4;if($(d).is(":visible")){$(d).hide()}else{window.setTimeout(function(){$(".doc_menu").hide();$(d).show();$(d).css("left",a);$(d).css("top",f)},100);$(d).find("a").click(function(){showMoreDocMenus(c,b)})}}$(function(){$(document).click(function(){$(".doc_menu").hide()})});